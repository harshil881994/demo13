2023-11-16 08:59:18.268 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 206ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:18.268 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.319 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [50, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1179652 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1179652), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1179652 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{2486345}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1179652 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:18.320 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 52ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:18.320 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1179652 
2023-11-16 08:59:18.320 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.391 DEBUG 1 --- [_103335_1126057] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.394 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 396917
2023-11-16 08:59:18.404 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [83, with SITE_IDS as ( select unnest('{2486345}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1179652 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:18.406 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1179652
2023-11-16 08:59:18.407 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 86ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:18.433 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 396917
2023-11-16 08:59:18.434 DEBUG 1 --- [_103335_1126057] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (1154965)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:18.435 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 44ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:18.435  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 396917
2023-11-16 08:59:18.435 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 396917 
2023-11-16 08:59:18.441 DEBUG 1 --- [_103335_1126057] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1126057
2023-11-16 08:59:18.441 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 5ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1126057
2023-11-16 08:59:18.441 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:18.441 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 396917 
2023-11-16 08:59:18.441  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 396917
2023-11-16 08:59:18.442 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 396917 
2023-11-16 08:59:18.442 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 396917 
2023-11-16 08:59:18.442 DEBUG 1 --- [6_103335_396917] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.445 DEBUG 1 --- [_103335_1126057] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1126057
2023-11-16 08:59:18.446 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1126057
2023-11-16 08:59:18.451 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 5ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:18.479 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with SITE_IDS as(select unnest('{32749,69853,85939,104865,1204813,1233762,1233772,1233775,4727785,4728572,5369115,5690442,52395825,52396211,62727979}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[396917] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:18.480 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 38ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:18.480 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 396917
2023-11-16 08:59:18.543 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1179652, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:18.543 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868303 and EventDetID : 99446 
2023-11-16 08:59:18.543 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1179652
2023-11-16 08:59:18.550 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868303
2023-11-16 08:59:18.550 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 7ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:18.550 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868303 and Event_Details ID : 99446 
2023-11-16 08:59:18.550 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:18.551 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:18.551 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:18.554 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1179652 -- Resulted rows -- [1]
2023-11-16 08:59:18.554 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:18.555 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1179652 : false : false : 19868303 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1179652
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1179652
2023-11-16 08:59:18.557  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1179652
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1179652 
2023-11-16 08:59:18.557 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1179652 
2023-11-16 08:59:18.558 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.660 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [102, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1179652,545839) and event_details_id = 99446] 
2023-11-16 08:59:18.666 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1179652
2023-11-16 08:59:18.666 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1179652
2023-11-16 08:59:18.666 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 108ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:18.666  INFO 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1179652]
2023-11-16 08:59:18.667  INFO 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1179652]
2023-11-16 08:59:18.668 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1179652 
2023-11-16 08:59:18.668 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1179652 
2023-11-16 08:59:18.668 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.676  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 1126057
2023-11-16 08:59:18.676 DEBUG 1 --- [_103335_1126057] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.694 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1179652 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (2486345)] 
2023-11-16 08:59:18.695 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1179652
2023-11-16 08:59:18.695 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 27ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:18.703 DEBUG 1 --- [_103335_1126057] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (1154965) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:18.707 DEBUG 1 --- [_103335_1126057] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_1126057
2023-11-16 08:59:18.708 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 31ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:18.710 DEBUG 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:18.740 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_396917
2023-11-16 08:59:18.740 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_396917
2023-11-16 08:59:18.740 DEBUG 1 --- [6_103335_396917] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.765 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 1126057
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1126057] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1126057, Took : 3s
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1038173 
2023-11-16 08:59:18.787  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:18.795 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, WITH SITE_IDS AS( SELECT UNNEST('{2486345}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1179652] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1179652 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:18.795 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 30ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:18.795 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1179652 
2023-11-16 08:59:18.800 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 11ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:18.806 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [65, with SITEID as( select * from ( select unnest(array[104865,4727785,5369115,52396211,32749,52395825,1233762,85939,4728572,62727979,69853,5690442,1233775,1233772,1204813]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:18.806 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 66ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:18.809 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_396917
2023-11-16 08:59:18.810 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 69ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_396917
2023-11-16 08:59:18.818 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_396917
2023-11-16 08:59:18.818 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 8ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:18.818 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 396917 
2023-11-16 08:59:18.818  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 396917
2023-11-16 08:59:18.822 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 22ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:18.822 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.864 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1038173 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1038173), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1038173 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{2218425}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1038173 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:18.865 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 43ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:18.865 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1038173 
2023-11-16 08:59:18.865 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.891 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, with SITE_IDS as ( select unnest('{2218425}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1038173 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:18.892 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 396917 
2023-11-16 08:59:18.893 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1038173
2023-11-16 08:59:18.893 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 27ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:18.897 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:18.897 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 396917 
2023-11-16 08:59:18.906 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 396917
2023-11-16 08:59:18.934 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1179652
2023-11-16 08:59:18.934 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 138ms : for accumlator : {}
2023-11-16 08:59:18.934 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1179652 
2023-11-16 08:59:18.938 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1179652
2023-11-16 08:59:18.938 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1179652
2023-11-16 08:59:18.938 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:18.974 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1179652 and total_cpns != '{}' and site_private_id = any('{85506344}')] 
2023-11-16 08:59:18.977 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1179652
2023-11-16 08:59:18.978 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 39ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:18.978 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.007 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, with SITEID as( select * from ( select unnest(array[85506344]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:19.008 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 30ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:19.011 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1179652
2023-11-16 08:59:19.011 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 33ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1179652
2023-11-16 08:59:19.022 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1179652
2023-11-16 08:59:19.022 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:19.022 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1179652
2023-11-16 08:59:19.030 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1179652 
2023-11-16 08:59:19.030 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1179652 
2023-11-16 08:59:19.030 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1179652 
2023-11-16 08:59:19.030 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1038173, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868305 and EventDetID : 99446 
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1038173
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868305
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868305 and Event_Details ID : 99446 
2023-11-16 08:59:19.068 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:19.069 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:19.069 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868303 and tenant_id = 1179652] 
2023-11-16 08:59:19.069 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:19.069 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 39ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:19.072 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1038173 -- Resulted rows -- [1]
2023-11-16 08:59:19.073 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:19.073 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1038173 : false : false : 19868305 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:19.076 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:19.076 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:19.076 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1038173
2023-11-16 08:59:19.077 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1038173
2023-11-16 08:59:19.077  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1038173
2023-11-16 08:59:19.077 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1038173 
2023-11-16 08:59:19.077 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1038173 
2023-11-16 08:59:19.077 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.104 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1038173,814575) and event_details_id = 99446] 
2023-11-16 08:59:19.108 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1038173
2023-11-16 08:59:19.108 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1038173
2023-11-16 08:59:19.108 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 30ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:19.108  INFO 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1038173]
2023-11-16 08:59:19.108  INFO 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1038173]
2023-11-16 08:59:19.109 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1038173 
2023-11-16 08:59:19.109 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1038173 
2023-11-16 08:59:19.109 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.158 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1038173 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (2218425)] 
2023-11-16 08:59:19.159 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1038173
2023-11-16 08:59:19.159 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 50ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:19.214 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.225 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1179652
2023-11-16 08:59:19.225 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1179652
2023-11-16 08:59:19.237 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1179652
2023-11-16 08:59:19.237 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:19.247 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:19.249 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1179652 
2023-11-16 08:59:19.261 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, WITH SITE_IDS AS( SELECT UNNEST('{2218425}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1038173] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1038173 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:19.262 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 47ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:19.262 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1038173 
2023-11-16 08:59:19.395 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1038173
2023-11-16 08:59:19.395 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 132ms : for accumlator : {}
2023-11-16 08:59:19.395 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1038173 
2023-11-16 08:59:19.399 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1038173
2023-11-16 08:59:19.399 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1038173
2023-11-16 08:59:19.399 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.426 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1038173 and total_cpns != '{}' and site_private_id = any('{69799238}')] 
2023-11-16 08:59:19.431 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1038173
2023-11-16 08:59:19.431 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 31ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:19.431 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.481 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [50, with SITEID as( select * from ( select unnest(array[69799238]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:19.482 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 50ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:19.486 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1038173
2023-11-16 08:59:19.486 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 55ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1038173
2023-11-16 08:59:19.499 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1038173
2023-11-16 08:59:19.499 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 13ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:19.499 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1038173
2023-11-16 08:59:19.507 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1038173 
2023-11-16 08:59:19.507 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1038173 
2023-11-16 08:59:19.508 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1038173 
2023-11-16 08:59:19.508 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.540 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868305 and tenant_id = 1038173] 
2023-11-16 08:59:19.541 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 33ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:19.564 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 396917
2023-11-16 08:59:19.565  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 396917
2023-11-16 08:59:19.565 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 396917 
2023-11-16 08:59:19.565 DEBUG 1 --- [6_103335_396917] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.611 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 396917 and es.event_id = 19868304 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:19.611 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 45ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:19.615 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_396917
2023-11-16 08:59:19.615 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_396917
2023-11-16 08:59:19.618 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:19.618 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 396917 
2023-11-16 08:59:19.709 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1038173
2023-11-16 08:59:19.709 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1038173
2023-11-16 08:59:19.718  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 396917
2023-11-16 08:59:19.718 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 396917 
2023-11-16 08:59:19.721 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1038173
2023-11-16 08:59:19.721 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:19.722 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 396917 
2023-11-16 08:59:19.722  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:19.722 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 396917 
2023-11-16 08:59:19.722 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 396917
2023-11-16 08:59:19.730 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:19.732 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1038173 
2023-11-16 08:59:19.759 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[289092, 206286, 384, 182265, 289095, 289097, 6743, 101797, 289102, 289100, 71631, 289098, 250019]
2023-11-16 08:59:19.759 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 37ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:19.760 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 13 for customer 396917
2023-11-16 08:59:19.760 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[289092, 206286, 384, 182265, 289095, 289097, 6743, 101797, 289102, 289100, 71631, 289098, 250019]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}396917
2023-11-16 08:59:19.776 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[289092, 206286, 384, 182265, 289095, 289097, 6743, 101797, 289102, 289100, 71631, 289098, 250019]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}396917
2023-11-16 08:59:19.776 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 16ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:19.776 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 396917 99446 user with No pref [289092, 206286, 384, 182265, 289095, 289097, 6743, 101797, 289102, 289100, 71631, 289098, 250019]
2023-11-16 08:59:19.778 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:19.778 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 396917 99446 [5357, 289099, 289103]
2023-11-16 08:59:19.780 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  396917 99446 
2023-11-16 08:59:19.780 DEBUG 1 --- [     Thread-357] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 396917 99446 [5357, 289099, 289103]
2023-11-16 08:59:19.783 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  396917 99446 
2023-11-16 08:59:19.783 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:19.783 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 396917 99446 [289103, 5357, 289099]
2023-11-16 08:59:19.784 DEBUG 1 --- [     Thread-357] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 396917 99446 [5357, 289099, 289103]
2023-11-16 08:59:19.784 DEBUG 1 --- [     Thread-357] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 3ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:19.785 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 396917 99446 [289103, 5357, 289099]
2023-11-16 08:59:19.785 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:19.785 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 396917 99446 [289103, 5357, 289099]
2023-11-16 08:59:19.789 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 396917 99446 [289103, 5357, 289099]
2023-11-16 08:59:19.789 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 4ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:19.789 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 396917 99446 [289103, 5357, 289099]
2023-11-16 08:59:19.791 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 396917 99446 [289103, 5357]
2023-11-16 08:59:19.791 DEBUG 1 --- [     Thread-356] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 1ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:19.792 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 396917 and eventId 99446 and userIds [289099, 289103, 5357]
2023-11-16 08:59:19.792 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 396917 and eventId : 99446 
2023-11-16 08:59:19.792 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:19.796 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 3
2023-11-16 08:59:19.797 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 4ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:19.797 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 396917 99446
2023-11-16 08:59:19.797 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 396917
2023-11-16 08:59:19.797  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 396917
2023-11-16 08:59:19.797 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:19.797 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [396917] 
2023-11-16 08:59:19.805 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:19.805 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 8ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:19.805  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 396917, isUpdateAlert : true
2023-11-16 08:59:19.806  INFO 1 --- [6_103335_396917] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:19.806 DEBUG 1 --- [6_103335_396917] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:19.807  INFO 1 --- [6_103335_396917] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:19.807 DEBUG 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"7d42633b-090a-488f-884a-fa90da583884","eventId":19868304,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:19.810 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"7d42633b-090a-488f-884a-fa90da583884","eventId":19868304,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41762
2023-11-16 08:59:19.810  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868304, tenantId : 396917
2023-11-16 08:59:19.811  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:19.811  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:19.811  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:19.811  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:19.812  INFO 1 --- [6_103335_396917] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 396917, Took : 3s
2023-11-16 08:59:19.812  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 130009 
2023-11-16 08:59:19.812  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:19.813 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:19.860 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:19.900 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:19.902  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1179652
2023-11-16 08:59:19.902 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1179652 
2023-11-16 08:59:19.906 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:19.907 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1179652 
2023-11-16 08:59:19.907  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1179652
2023-11-16 08:59:19.907 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1179652 
2023-11-16 08:59:19.907 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1179652 
2023-11-16 08:59:19.907 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:19.945 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with SITE_IDS as(select unnest('{85507628}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[1179652] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:19.946 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 39ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:19.946 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 1179652
2023-11-16 08:59:20.182 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 369ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:20.183 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.210 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 130009 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 130009), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =130009 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{470950,772407,773748,983634,983876,983877,983878,985995,985996,985997,985998,985999,986000,986001,986002,986003,986004}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 130009 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:20.211 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 28ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:20.211 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 130009 
2023-11-16 08:59:20.212 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.241 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, with SITE_IDS as ( select unnest('{470950,772407,773748,983634,983876,983877,983878,985995,985996,985997,985998,985999,986000,986001,986002,986003,986004}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 130009 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:20.242 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 130009
2023-11-16 08:59:20.243 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 30ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:20.333 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[196639, 114068, 132958, 161981, 213290, 184718, 262822, 213291, 177475, 173508, 240394, 168925, 114066, 161241, 213288, 6743, 76051, 92382, 100101, 151760, 155526, 79662, 132627, 79634, 224514, 112992, 302299, 213289]
2023-11-16 08:59:20.333 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 14921ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:20.333 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 28 for customer 25
2023-11-16 08:59:20.333 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[196639, 114068, 132958, 161981, 213290, 184718, 262822, 213291, 177475, 173508, 240394, 168925, 114066, 161241, 213288, 6743, 76051, 92382, 100101, 151760, 155526, 79662, 132627, 79634, 224514, 112992, 302299, 213289]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}25
2023-11-16 08:59:20.351 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[196639, 114068, 132958, 161981, 213290, 184718, 262822, 213291, 177475, 173508, 240394, 168925, 114066, 161241, 213288, 6743, 76051, 92382, 100101, 151760, 155526, 79662, 132627, 79634, 224514, 112992, 302299, 213289]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}25
2023-11-16 08:59:20.351 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 17ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:20.351 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 25 99446 user with No pref [196639, 114068, 132958, 161981, 213290, 184718, 262822, 213291, 177475, 173508, 240394, 168925, 114066, 161241, 213288, 6743, 76051, 92382, 100101, 151760, 155526, 79662, 132627, 79634, 224514, 112992, 302299, 213289]
2023-11-16 08:59:20.354 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:20.354 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 25 99446 [132533, 230409]
2023-11-16 08:59:20.354 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  25 99446 
2023-11-16 08:59:20.354 DEBUG 1 --- [     Thread-359] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 25 99446 [132533, 230409]
2023-11-16 08:59:20.356 DEBUG 1 --- [     Thread-359] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 25 99446 [132533, 230409]
2023-11-16 08:59:20.356 DEBUG 1 --- [     Thread-359] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:20.357 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  25 99446 
2023-11-16 08:59:20.357 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:20.357 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 25 99446 [132533, 230409]
2023-11-16 08:59:20.359 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_1179652
2023-11-16 08:59:20.359 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 25 99446 [132533, 230409]
2023-11-16 08:59:20.359 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:20.359 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_1179652
2023-11-16 08:59:20.359 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 25 99446 [132533, 230409]
2023-11-16 08:59:20.359 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.395 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, with SITEID as( select * from ( select unnest(array[85507628]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:20.395 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 36ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:20.398 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1179652
2023-11-16 08:59:20.398 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 39ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1179652
2023-11-16 08:59:20.409 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_1179652
2023-11-16 08:59:20.409 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 10ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:20.409 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 1179652 
2023-11-16 08:59:20.409  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 1179652
2023-11-16 08:59:20.410 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:20.457 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 130009, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:20.457 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868306 and EventDetID : 99446 
2023-11-16 08:59:20.457 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 130009
2023-11-16 08:59:20.457 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868306
2023-11-16 08:59:20.458 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:20.458 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868306 and Event_Details ID : 99446 
2023-11-16 08:59:20.458 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:20.458 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:20.458 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:20.460 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:20.461  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1038173
2023-11-16 08:59:20.461 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 130009 -- Resulted rows -- [1]
2023-11-16 08:59:20.461 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1038173 
2023-11-16 08:59:20.461 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:20.461 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 130009 : false : false : 19868306 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 130009
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 130009
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 130009
2023-11-16 08:59:20.464  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 130009
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 130009 
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 130009 
2023-11-16 08:59:20.464 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.466 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:20.466 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1038173 
2023-11-16 08:59:20.466  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1038173
2023-11-16 08:59:20.466 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1038173 
2023-11-16 08:59:20.466 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1038173 
2023-11-16 08:59:20.466 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.470 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 1179652 
2023-11-16 08:59:20.474 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:20.474 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 1179652 
2023-11-16 08:59:20.482 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:20.496 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (130009,293,237104,237,1099,178745,251179,396202,438195,438402,438635,438829,439501,440213) and event_details_id = 99446] 
2023-11-16 08:59:20.500 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_130009
2023-11-16 08:59:20.500 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 130009
2023-11-16 08:59:20.500 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 36ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:20.500  INFO 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [130009]
2023-11-16 08:59:20.502  INFO 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [130009]
2023-11-16 08:59:20.502 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 130009 
2023-11-16 08:59:20.502 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 130009 
2023-11-16 08:59:20.502 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.505 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with SITE_IDS as(select unnest('{64636627}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[1038173] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:20.505 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 39ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:20.505 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 1038173
2023-11-16 08:59:20.538 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 130009 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (470950,772407,773748,983634,983876,983877,983878,985995,985996,985997,985998,985999,986000,986001,986002,986003,986004)] 
2023-11-16 08:59:20.539 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [?:?] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 130009
2023-11-16 08:59:20.540 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 37ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:20.623 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.676 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, WITH SITE_IDS AS( SELECT UNNEST('{470950,772407,773748,983634,983876,983877,983878,985995,985996,985997,985998,985999,986000,986001,986002,986003,986004}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[130009] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 130009 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:20.677 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 53ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:20.677 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 130009 
2023-11-16 08:59:20.811 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_1038173
2023-11-16 08:59:20.812 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_1038173
2023-11-16 08:59:20.812 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.844 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with SITEID as( select * from ( select unnest(array[64636627]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:20.844 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 32ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:20.848 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1038173
2023-11-16 08:59:20.848 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 36ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1038173
2023-11-16 08:59:20.858 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_1038173
2023-11-16 08:59:20.858 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:20.858 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 1038173 
2023-11-16 08:59:20.858  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 1038173
2023-11-16 08:59:20.873 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 130009
2023-11-16 08:59:20.874 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 196ms : for accumlator : {}
2023-11-16 08:59:20.874 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 130009 
2023-11-16 08:59:20.878 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_130009
2023-11-16 08:59:20.879 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_130009
2023-11-16 08:59:20.879 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.914 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 130009 and total_cpns != '{}' and site_private_id = any('{7110775,7113437,12398847,12400937,12400938,12400939,12404247,12404248,12404249,12404250,12404251,12404252,12404253,12404254,12404255,12404256,33209071}')] 
2023-11-16 08:59:20.918 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_130009
2023-11-16 08:59:20.918 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 39ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:20.918 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:20.946 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 1038173 
2023-11-16 08:59:20.951 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:20.951 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 1038173 
2023-11-16 08:59:20.956 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with SITEID as( select * from ( select unnest(array[12404253,12404252,12398847,12404255,12404254,12404249,12404248,12404251,12404250,12404247,7113437,12400937,33209071,12400939,12400938,7110775,12404256]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:20.956 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 38ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:20.960 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_130009
2023-11-16 08:59:20.960 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 42ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_130009
2023-11-16 08:59:20.961 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:20.974 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_130009
2023-11-16 08:59:20.974 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 13ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:20.974 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 130009
2023-11-16 08:59:20.983 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 130009 
2023-11-16 08:59:20.983 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 130009 
2023-11-16 08:59:20.983 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 130009 
2023-11-16 08:59:20.983 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.022 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868306 and tenant_id = 130009] 
2023-11-16 08:59:21.023 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 39ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:21.032 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:21.033  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 1179652
2023-11-16 08:59:21.033 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 1179652 
2023-11-16 08:59:21.033 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.056 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [23, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 1179652 and es.event_id = 19868303 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:21.056 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 23ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:21.061 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_1179652
2023-11-16 08:59:21.061 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 4ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_1179652
2023-11-16 08:59:21.065 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:21.066 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 1179652 
2023-11-16 08:59:21.104 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_130009
2023-11-16 08:59:21.104 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 11ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_130009
2023-11-16 08:59:21.116 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_130009
2023-11-16 08:59:21.116 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:21.127 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 10ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:21.128 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 130009 
2023-11-16 08:59:21.135  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 1179652
2023-11-16 08:59:21.136 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1179652 
2023-11-16 08:59:21.142 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1179652 
2023-11-16 08:59:21.143  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:21.143 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 1179652 
2023-11-16 08:59:21.143 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 1179652
2023-11-16 08:59:21.305 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[280645, 280629, 285007, 280637, 285003, 280625, 280626, 280653, 285016, 280644, 205317, 285013, 285006, 280633, 166105, 285010, 280642, 280753, 286177, 280643, 269258, 274259, 280636, 285012, 285008, 285002, 280607, 280635, 280638, 285015, 285001, 280628, 285011, 280632, 285005, 280655, 285014, 285009, 280630, 280640, 280654, 285004, 293724, 280623]
2023-11-16 08:59:21.305 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 162ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:21.305 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 44 for customer 1179652
2023-11-16 08:59:21.306 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[280645, 280629, 285007, 280637, 285003, 280625, 280626, 280653, 285016, 280644, 205317, 285013, 285006, 280633, 166105, 285010, 280642, 280753, 286177, 280643, 269258, 274259, 280636, 285012, 285008, 285002, 280607, 280635, 280638, 285015, 285001, 280628, 285011, 280632, 285005, 280655, 285014, 285009, 280630, 280640, 280654, 285004, 293724, 280623]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1179652
2023-11-16 08:59:21.324 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[280645, 280629, 285007, 280637, 285003, 280625, 280626, 280653, 285016, 280644, 205317, 285013, 285006, 280633, 166105, 285010, 280642, 280753, 286177, 280643, 269258, 274259, 280636, 285012, 285008, 285002, 280607, 280635, 280638, 285015, 285001, 280628, 285011, 280632, 285005, 280655, 285014, 285009, 280630, 280640, 280654, 285004, 293724, 280623]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1179652
2023-11-16 08:59:21.324 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 18ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:21.324 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 1179652 99446 user with No pref [280645, 280629, 285007, 280637, 285003, 280625, 280626, 280653, 285016, 280644, 205317, 285013, 285006, 280633, 166105, 285010, 280642, 280753, 286177, 280643, 269258, 274259, 280636, 285012, 285008, 285002, 280607, 280635, 280638, 285015, 285001, 280628, 285011, 280632, 285005, 280655, 285014, 285009, 280630, 280640, 280654, 285004, 293724, 280623]
2023-11-16 08:59:21.326 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:21.326 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 1179652 99446 [277909, 279834, 279835, 280627, 280634, 280641, 280656, 280754, 285018, 296693]
2023-11-16 08:59:21.327 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  1179652 99446 
2023-11-16 08:59:21.327 DEBUG 1 --- [     Thread-361] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 1179652 99446 [277909, 279834, 279835, 280627, 280634, 280641, 280656, 280754, 285018, 296693]
2023-11-16 08:59:21.330 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  1179652 99446 
2023-11-16 08:59:21.330 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:21.330 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 1179652 99446 [277909, 296693, 280656, 280641, 280754, 280627, 279834, 280634, 279835]
2023-11-16 08:59:21.331 DEBUG 1 --- [     Thread-361] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 1179652 99446 [277909, 279834, 279835, 280627, 280634, 280641, 280656, 280754, 285018, 296693]
2023-11-16 08:59:21.331 DEBUG 1 --- [     Thread-361] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 4ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:21.333 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 1179652 99446 [277909, 296693, 280656, 280641, 280754, 280627, 279834, 279835]
2023-11-16 08:59:21.333 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 2ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:21.333 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 1179652 99446 [277909, 296693, 280656, 280641, 280754, 280627, 279834, 279835]
2023-11-16 08:59:21.366 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 1179652 99446 [277909, 279834, 279835]
2023-11-16 08:59:21.366 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 33ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:21.366 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 1179652 99446 [277909, 279834, 279835]
2023-11-16 08:59:21.371 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 1179652 99446 [277909, 279834, 279835]
2023-11-16 08:59:21.371 DEBUG 1 --- [     Thread-360] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 5ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:21.372 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 1179652 and eventId 99446 and userIds [277909, 279834, 279835]
2023-11-16 08:59:21.372 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 1179652 and eventId : 99446 
2023-11-16 08:59:21.372 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:21.374 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [?:?] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 3
2023-11-16 08:59:21.374 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 2ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:21.374 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 1179652 99446
2023-11-16 08:59:21.375 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 1179652
2023-11-16 08:59:21.375  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 1179652
2023-11-16 08:59:21.375 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:21.375 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1179652] 
2023-11-16 08:59:21.377 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:21.377 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:21.377  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 1179652, isUpdateAlert : true
2023-11-16 08:59:21.377  INFO 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:21.378 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:21.378  INFO 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:21.378 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"94b1d6a6-0088-4477-a774-a6ea9c0c0f58","eventId":19868303,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:21.380  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868303, tenantId : 1179652
2023-11-16 08:59:21.380 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"94b1d6a6-0088-4477-a774-a6ea9c0c0f58","eventId":19868303,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41763
2023-11-16 08:59:21.380  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:21.380  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [545839] 
2023-11-16 08:59:21.381 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.440 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [59, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (545839)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:21.441 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 60ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:21.491 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:21.493  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 1038173
2023-11-16 08:59:21.493 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 1038173 
2023-11-16 08:59:21.493 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.498 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.534 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 1038173 and es.event_id = 19868305 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:21.535 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 42ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:21.538 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (545839)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:21.539 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 40ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:21.539 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_1038173
2023-11-16 08:59:21.539 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 4ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_1038173
2023-11-16 08:59:21.543 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1179652
2023-11-16 08:59:21.543 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 4ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1179652
2023-11-16 08:59:21.543 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:21.543 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 1038173 
2023-11-16 08:59:21.547 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1179652
2023-11-16 08:59:21.547 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1179652
2023-11-16 08:59:21.552 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:21.657  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 1038173
2023-11-16 08:59:21.657 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1038173 
2023-11-16 08:59:21.662 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1038173 
2023-11-16 08:59:21.662  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:21.662 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 1038173 
2023-11-16 08:59:21.662 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 1038173
2023-11-16 08:59:21.724 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[288579, 288571, 288592, 288574, 288588, 288568, 288575, 288562, 88018, 288578, 288567, 188701, 288573, 288600, 91747, 289353, 288582, 288559, 288565, 288589, 288599, 288586, 288570, 288595, 166301, 288564, 288597, 288598, 288558, 288566, 288800, 251886, 237084, 288572, 288596, 289354, 288584, 288563, 288561, 288590, 288591, 288593, 288557, 288585, 288555, 288583, 288577]
2023-11-16 08:59:21.724 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 61ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:21.724 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 47 for customer 1038173
2023-11-16 08:59:21.725 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[288579, 288571, 288592, 288574, 288588, 288568, 288575, 288562, 88018, 288578, 288567, 188701, 288573, 288600, 91747, 289353, 288582, 288559, 288565, 288589, 288599, 288586, 288570, 288595, 166301, 288564, 288597, 288598, 288558, 288566, 288800, 251886, 237084, 288572, 288596, 289354, 288584, 288563, 288561, 288590, 288591, 288593, 288557, 288585, 288555, 288583, 288577]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1038173
2023-11-16 08:59:21.735 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[288579, 288571, 288592, 288574, 288588, 288568, 288575, 288562, 88018, 288578, 288567, 188701, 288573, 288600, 91747, 289353, 288582, 288559, 288565, 288589, 288599, 288586, 288570, 288595, 166301, 288564, 288597, 288598, 288558, 288566, 288800, 251886, 237084, 288572, 288596, 289354, 288584, 288563, 288561, 288590, 288591, 288593, 288557, 288585, 288555, 288583, 288577]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1038173
2023-11-16 08:59:21.735 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 10ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:21.735 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 1038173 99446 user with No pref [288579, 288571, 288592, 288574, 288588, 288568, 288575, 288562, 88018, 288578, 288567, 188701, 288573, 288600, 91747, 289353, 288582, 288559, 288565, 288589, 288599, 288586, 288570, 288595, 166301, 288564, 288597, 288598, 288558, 288566, 288800, 251886, 237084, 288572, 288596, 289354, 288584, 288563, 288561, 288590, 288591, 288593, 288557, 288585, 288555, 288583, 288577]
2023-11-16 08:59:21.737 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:21.737 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 1038173 99446 [154990, 288556, 288576, 288580, 288581, 288587, 288594, 288799]
2023-11-16 08:59:21.737 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  1038173 99446 
2023-11-16 08:59:21.738 DEBUG 1 --- [     Thread-363] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 1038173 99446 [154990, 288556, 288576, 288580, 288581, 288587, 288594, 288799]
2023-11-16 08:59:21.740 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  1038173 99446 
2023-11-16 08:59:21.740 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:21.740 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 1038173 99446 [288580, 288581, 288576, 288594, 288556, 288799, 154990, 288587]
2023-11-16 08:59:21.742 DEBUG 1 --- [     Thread-363] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 1038173 99446 [154990, 288556, 288576, 288580, 288581, 288587, 288594, 288799]
2023-11-16 08:59:21.742 DEBUG 1 --- [     Thread-363] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 4ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:21.742 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 1038173 99446 [288580, 288576, 288594, 288799, 154990, 288587]
2023-11-16 08:59:21.742 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:21.742 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 1038173 99446 [288580, 288576, 288594, 288799, 154990, 288587]
2023-11-16 08:59:21.750 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 1038173 99446 [288580, 154990]
2023-11-16 08:59:21.751 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 8ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:21.751 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 1038173 99446 [288580, 154990]
2023-11-16 08:59:21.756 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 1038173 99446 [288580, 154990]
2023-11-16 08:59:21.756 DEBUG 1 --- [     Thread-362] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 5ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:21.756 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 1038173 and eventId 99446 and userIds [288580, 154990]
2023-11-16 08:59:21.756 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 1038173 and eventId : 99446 
2023-11-16 08:59:21.756 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 2
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 2ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 1038173 99446
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 1038173
2023-11-16 08:59:21.759  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 1038173
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:21.759 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1038173] 
2023-11-16 08:59:21.762 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:21.762 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:21.762  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 1038173, isUpdateAlert : true
2023-11-16 08:59:21.762  INFO 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:21.763 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:21.763  INFO 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:21.763 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"3948b86e-4049-4424-8166-abf1a3f85fea","eventId":19868305,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:21.765  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868305, tenantId : 1038173
2023-11-16 08:59:21.765 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"3948b86e-4049-4424-8166-abf1a3f85fea","eventId":19868305,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41764
2023-11-16 08:59:21.765  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:21.765  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [814575] 
2023-11-16 08:59:21.765 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.786  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 1179652
2023-11-16 08:59:21.786 DEBUG 1 --- [_103335_1179652] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.818 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [53, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (814575)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:21.819 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 53ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:21.824 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (545839) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:21.828 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_1179652
2023-11-16 08:59:21.828 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 42ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:21.831 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:21.896 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:21.921 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 130009
2023-11-16 08:59:21.932 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (814575)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:21.933 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 36ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:21.936 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1038173
2023-11-16 08:59:21.937 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1038173
2023-11-16 08:59:21.940 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1038173
2023-11-16 08:59:21.940 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1038173
2023-11-16 08:59:21.945 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:22.005 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 130009
2023-11-16 08:59:22.007  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 130009
2023-11-16 08:59:22.007 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 130009 
2023-11-16 08:59:22.012 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:22.012 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 130009 
2023-11-16 08:59:22.012  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 130009
2023-11-16 08:59:22.012 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 130009 
2023-11-16 08:59:22.012 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 130009 
2023-11-16 08:59:22.012 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.055 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, with SITE_IDS as(select unnest('{2748705,7113720,7116352,12404687,12405613,12405614,12405615,12407376,12408770,12408919,12408971,12408972,12409073,12409250,12409349,12409716,12410099}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[130009] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:22.056 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 43ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:22.056 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 130009
2023-11-16 08:59:22.111 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 192ms : for accumulator : {}
2023-11-16 08:59:22.111 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:22.122 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 25 99446 [132533, 230409]
2023-11-16 08:59:22.122 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 1763ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:22.122 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 25 99446 [132533, 230409]
2023-11-16 08:59:22.124 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 25 99446 [132533, 230409]
2023-11-16 08:59:22.124 DEBUG 1 --- [     Thread-358] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 2ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:22.124 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 25 and eventId 99446 and userIds [132533, 230409]
2023-11-16 08:59:22.124 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 25 and eventId : 99446 
2023-11-16 08:59:22.124 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 2
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 2ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 25 99446
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 25
2023-11-16 08:59:22.127  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 25
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:22.127 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [25] 
2023-11-16 08:59:22.131 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:22.131 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 4ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:22.131  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 25, isUpdateAlert : true
2023-11-16 08:59:22.132  INFO 1 --- [99446_103335_25] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:22.136 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [4, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:22.136  INFO 1 --- [99446_103335_25] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:22.136 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"45cbd686-984c-4a9d-a027-9ccf6b7bf46f","eventId":19868288,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:22.138  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868288, tenantId : 25
2023-11-16 08:59:22.138 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"45cbd686-984c-4a9d-a027-9ccf6b7bf46f","eventId":19868288,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41765
2023-11-16 08:59:22.138  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:22.138  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [13865, 7866, 27599, 146418, 17020, 30804, 30810, 177735] 
2023-11-16 08:59:22.139 DEBUG 1 --- [99446_103335_25] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.149 DEBUG 1 --- [_103335_1179652] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 1179652
2023-11-16 08:59:22.150  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 1179652
2023-11-16 08:59:22.150  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:22.150 DEBUG 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[545839],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:22.151  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [545839]
2023-11-16 08:59:22.151 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[545839],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22835
2023-11-16 08:59:22.152  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:22.152  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:22.152  INFO 1 --- [_103335_1179652] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1179652, Took : 4s
2023-11-16 08:59:22.152  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1037376 
2023-11-16 08:59:22.152  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:22.153 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:22.161  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 1038173
2023-11-16 08:59:22.161 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [22, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (13865,7866,27599,146418,17020,30804,30810,177735)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:22.161 DEBUG 1 --- [_103335_1038173] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.161 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 22ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:22.208 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (814575) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:22.213 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_1038173
2023-11-16 08:59:22.213 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 52ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:22.216 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:22.283 DEBUG 1 --- [99446_103335_25] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.328 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_130009
2023-11-16 08:59:22.328 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_130009
2023-11-16 08:59:22.328 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.338 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [55, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (13865,7866,27599,146418,17020,30804,30810,177735)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:22.338 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 55ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:22.341 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_25
2023-11-16 08:59:22.341 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_25
2023-11-16 08:59:22.344 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_25
2023-11-16 08:59:22.344 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_25
2023-11-16 08:59:22.349 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:22.366 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with SITEID as( select * from ( select unnest(array[2748705,12409716,12408919,7116352,12409073,12407376,12410099,12405613,12408972,12404687,12405615,12405614,7113720,12408971,12409349,12408770,12409250]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:22.366 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 38ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:22.370 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_130009
2023-11-16 08:59:22.370 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 42ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_130009
2023-11-16 08:59:22.379 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_130009
2023-11-16 08:59:22.379 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:22.379 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 130009 
2023-11-16 08:59:22.379  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 130009
2023-11-16 08:59:22.438 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 63ms : for accumulator : {}
2023-11-16 08:59:22.438 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:22.443 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 290ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:22.443 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.467 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 130009 
2023-11-16 08:59:22.468 DEBUG 1 --- [_103335_1038173] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 1038173
2023-11-16 08:59:22.469  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 1038173
2023-11-16 08:59:22.469  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:22.469 DEBUG 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[814575],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [814575]
2023-11-16 08:59:22.471 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[814575],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22836
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1038173] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1038173, Took : 3s
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1221314 
2023-11-16 08:59:22.471  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:22.471 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:22.472 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 130009 
2023-11-16 08:59:22.473 DEBUG 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:22.477 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1037376 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1037376), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1037376 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{37163,45227,46086,300111,300113,300114,322705,366560,654800,722040,732853,1076447,1657571,1657954,1658551,2397553,2397554}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1037376 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:22.478 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 35ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:22.479 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1037376 
2023-11-16 08:59:22.479 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.480 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 130009
2023-11-16 08:59:22.483 DEBUG 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 10ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1221314, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1221314
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868307
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:22.484 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:22.485 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.485 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:22.488 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1221314 -- Resulted rows -- [1]
2023-11-16 08:59:22.488 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:22.488 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1221314 : null : null : 19868307 : Update published
2023-11-16 08:59:22.494 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1221314
2023-11-16 08:59:22.494 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 5ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:22.494 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1221314
2023-11-16 08:59:22.494  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1221314
2023-11-16 08:59:22.494  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1221314 
2023-11-16 08:59:22.494 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:22.494 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1221314] 
2023-11-16 08:59:22.500 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:22.501 DEBUG 1 --- [_103335_1221314] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 6ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:22.501 DEBUG 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1221314 
2023-11-16 08:59:22.501 DEBUG 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1221314 
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1221314] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1221314, Took : 0s
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1076844 
2023-11-16 08:59:22.501  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:22.502 DEBUG 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:22.505 DEBUG 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 2ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:22.505 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1076844, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:22.505 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:22.505 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1076844
2023-11-16 08:59:22.506 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868308
2023-11-16 08:59:22.506 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.506 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:22.506 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:22.506 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.507 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:22.509 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1076844 -- Resulted rows -- [1]
2023-11-16 08:59:22.509 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:22.509 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1076844 : null : null : 19868308 : Update published
2023-11-16 08:59:22.511 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1076844
2023-11-16 08:59:22.511 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:22.511 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1076844
2023-11-16 08:59:22.512  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1076844
2023-11-16 08:59:22.512  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1076844 
2023-11-16 08:59:22.512 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:22.512 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1076844] 
2023-11-16 08:59:22.513  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 25
2023-11-16 08:59:22.513 DEBUG 1 --- [99446_103335_25] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.524 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:22.524 DEBUG 1 --- [_103335_1076844] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 11ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:22.524 DEBUG 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1076844 
2023-11-16 08:59:22.524 DEBUG 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1076844 
2023-11-16 08:59:22.524  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:22.524  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:22.524  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:22.524  INFO 1 --- [_103335_1076844] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1076844, Took : 0s
2023-11-16 08:59:22.524  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 495643 
2023-11-16 08:59:22.524  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:22.526 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:22.529 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [50, with SITE_IDS as ( select unnest('{37163,45227,46086,300111,300113,300114,322705,366560,654800,722040,732853,1076447,1657571,1657954,1658551,2397553,2397554}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1037376 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:22.530 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1037376
2023-11-16 08:59:22.530 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 51ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:22.535 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 8ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:22.535 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.541 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (13865,7866,27599,146418,17020,30804,30810,177735) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:22.545 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_25
2023-11-16 08:59:22.545 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 31ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:22.548 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:22.572 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 495643 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 495643), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =495643 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1677,29048,45989,46086,49301,300111,300113,300114,322697,322705,366560,428271,534966,534974,534975,536856,654391,654800,722040,732853,743408,1069830,2423561}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 495643 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:22.574 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 38ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:22.574 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 495643 
2023-11-16 08:59:22.574 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.607 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITE_IDS as ( select unnest('{1677,29048,45989,46086,49301,300111,300113,300114,322697,322705,366560,428271,534966,534974,534975,536856,654391,654800,722040,732853,743408,1069830,2423561}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 495643 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:22.609 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 495643
2023-11-16 08:59:22.609 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 34ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:22.682 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1037376, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:22.682 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868309 and EventDetID : 99446 
2023-11-16 08:59:22.682 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1037376
2023-11-16 08:59:22.683 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868309
2023-11-16 08:59:22.683 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.683 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868309 and Event_Details ID : 99446 
2023-11-16 08:59:22.683 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:22.683 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.684 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:22.687 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1037376 -- Resulted rows -- [1]
2023-11-16 08:59:22.687 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:22.687 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1037376 : false : false : 19868309 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:22.690 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1037376
2023-11-16 08:59:22.690 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:22.690 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1037376
2023-11-16 08:59:22.690 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1037376
2023-11-16 08:59:22.691  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1037376
2023-11-16 08:59:22.691 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1037376 
2023-11-16 08:59:22.691 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1037376 
2023-11-16 08:59:22.691 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.724 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1037376,1375,1449,1572,324,1385,10202,1366) and event_details_id = 99446] 
2023-11-16 08:59:22.728 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1037376
2023-11-16 08:59:22.728 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1037376
2023-11-16 08:59:22.728 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 36ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:22.728  INFO 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1037376]
2023-11-16 08:59:22.729  INFO 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1037376]
2023-11-16 08:59:22.729 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1037376 
2023-11-16 08:59:22.729 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1037376 
2023-11-16 08:59:22.729 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.742 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 495643, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:22.742 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868310 and EventDetID : 99446 
2023-11-16 08:59:22.742 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 495643
2023-11-16 08:59:22.742 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868310
2023-11-16 08:59:22.742 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.743 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868310 and Event_Details ID : 99446 
2023-11-16 08:59:22.743 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:22.743 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:22.743 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:22.750 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 495643 -- Resulted rows -- [1]
2023-11-16 08:59:22.751 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 7ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:22.751 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 495643 : false : false : 19868310 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 495643
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 495643
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 495643
2023-11-16 08:59:22.753  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 495643
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 495643 
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 495643 
2023-11-16 08:59:22.753 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.764 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1037376 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (37163,46086,366560,722040,1076447,1657954,1658551,2397553,2397554,300111,300113,300114,322705,654800,732853,1657571)] 
2023-11-16 08:59:22.765 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1037376
2023-11-16 08:59:22.765 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 36ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:22.793 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (495643,90,1405) and event_details_id = 99446] 
2023-11-16 08:59:22.797 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_495643
2023-11-16 08:59:22.797 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 495643
2023-11-16 08:59:22.797 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 44ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:22.797  INFO 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [495643]
2023-11-16 08:59:22.798  INFO 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [495643]
2023-11-16 08:59:22.798 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 495643 
2023-11-16 08:59:22.798 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 495643 
2023-11-16 08:59:22.798 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.805 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.824 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 495643 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (534966,534974,534975,2423561)] 
2023-11-16 08:59:22.825 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 495643
2023-11-16 08:59:22.825 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 27ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:22.851 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:?] : Time taken(ms) for query: [46, WITH SITE_IDS AS( SELECT UNNEST('{37163,46086,300111,300113,300114,322705,366560,654800,722040,732853,1076447,1657571,1657954,1658551,2397553,2397554}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1037376] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1037376 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:22.852 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 46ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:22.852 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1037376 
2023-11-16 08:59:22.881 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 130009
2023-11-16 08:59:22.882  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 130009
2023-11-16 08:59:22.883 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 130009 
2023-11-16 08:59:22.883 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.885 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 108ms : for accumulator : {}
2023-11-16 08:59:22.885 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 25
2023-11-16 08:59:22.896 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.930 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 130009 and es.event_id = 19868306 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:22.930 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 47ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:22.930 DEBUG 1 --- [99446_103335_25] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 25
2023-11-16 08:59:22.931  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 25
2023-11-16 08:59:22.931  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:22.932 DEBUG 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[17020,7866,13865,27599,146418],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:22.933  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [17020, 7866, 13865, 27599, 146418]
2023-11-16 08:59:22.933 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[17020,7866,13865,27599,146418],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22837
2023-11-16 08:59:22.934  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:22.934  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:22.934  INFO 1 --- [99446_103335_25] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 25, Took : 21s
2023-11-16 08:59:22.934  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 158312 
2023-11-16 08:59:22.934  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:22.934 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_130009
2023-11-16 08:59:22.934 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_130009
2023-11-16 08:59:22.936 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:22.937 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:22.937 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 130009 
2023-11-16 08:59:22.958 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [62, WITH SITE_IDS AS( SELECT UNNEST('{534966,534966,534974,534974,534975,534975,2423561,2423561,2423561}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[495643] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 495643 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:22.958 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 62ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:22.958 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 495643 
2023-11-16 08:59:22.961 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1037376
2023-11-16 08:59:22.961 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 108ms : for accumlator : {}
2023-11-16 08:59:22.961 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1037376 
2023-11-16 08:59:22.965 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1037376
2023-11-16 08:59:22.965 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1037376
2023-11-16 08:59:22.965 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:22.986 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [21, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1037376 and total_cpns != '{}' and site_private_id = any('{69809918,69855850,69855851,69855852,69855853,69856219,69856270,69856539,69856560,69856868,69857107,69857687,69858055,77034111,77034207,77034208}')] 
2023-11-16 08:59:22.989 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1037376
2023-11-16 08:59:22.989 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 24ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:22.989 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:23.003  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 130009
2023-11-16 08:59:23.003 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 130009 
2023-11-16 08:59:23.006 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 130009 
2023-11-16 08:59:23.007  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:23.007 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 130009 
2023-11-16 08:59:23.007 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 130009
2023-11-16 08:59:23.035 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, with SITEID as( select * from ( select unnest(array[69855851,69855850,69855853,69855852,69856270,77034111,77034207,69856868,69858055,69856219,69856539,69809918,77034208,69856560,69857107,69857687]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:23.035 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 45ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:23.039 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1037376
2023-11-16 08:59:23.039 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 49ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1037376
2023-11-16 08:59:23.050 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1037376
2023-11-16 08:59:23.050 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:23.050 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1037376
2023-11-16 08:59:23.056 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1037376 
2023-11-16 08:59:23.056 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1037376 
2023-11-16 08:59:23.056 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1037376 
2023-11-16 08:59:23.056 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:23.067 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 495643
2023-11-16 08:59:23.067 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 107ms : for accumlator : {}
2023-11-16 08:59:23.067 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 495643 
2023-11-16 08:59:23.070 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_495643
2023-11-16 08:59:23.071 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_495643
2023-11-16 08:59:23.071 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:23.095 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868309 and tenant_id = 1037376] 
2023-11-16 08:59:23.095 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 38ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:23.107 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 495643 and total_cpns != '{}' and site_private_id = any('{50776798,50776799,50776800,79178029}')] 
2023-11-16 08:59:23.110 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_495643
2023-11-16 08:59:23.110 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 39ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:23.111 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:23.136 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, with SITEID as( select * from ( select unnest(array[79178029,50776800,50776798,50776799]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:23.137 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 26ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:23.141 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_495643
2023-11-16 08:59:23.141 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 30ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_495643
2023-11-16 08:59:23.155 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_495643
2023-11-16 08:59:23.155 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 13ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:23.155 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 495643
2023-11-16 08:59:23.161 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1037376
2023-11-16 08:59:23.161 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1037376
2023-11-16 08:59:23.162 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 495643 
2023-11-16 08:59:23.162 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 495643 
2023-11-16 08:59:23.162 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 495643 
2023-11-16 08:59:23.163 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:23.171 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1037376
2023-11-16 08:59:23.172 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:23.181 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:23.182 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1037376 
2023-11-16 08:59:23.198 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[104284, 177442, 178158, 80961, 88191, 135732, 78746, 213078, 151972, 90740, 177441, 246513, 203931, 187084, 78742, 101797, 286785, 203932, 177448, 285047]
2023-11-16 08:59:23.199 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 191ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:23.199 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 20 for customer 130009
2023-11-16 08:59:23.199 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[104284, 177442, 178158, 80961, 88191, 135732, 78746, 213078, 151972, 90740, 177441, 246513, 203931, 187084, 78742, 101797, 286785, 203932, 177448, 285047]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}130009
2023-11-16 08:59:23.201 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868310 and tenant_id = 495643] 
2023-11-16 08:59:23.202 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 39ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:23.212 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[104284, 177442, 178158, 80961, 88191, 135732, 78746, 213078, 151972, 90740, 177441, 246513, 203931, 187084, 78742, 101797, 286785, 203932, 177448, 285047]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}130009
2023-11-16 08:59:23.212 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 13ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:23.212 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 130009 99446 user with No pref [104284, 177442, 178158, 80961, 88191, 135732, 78746, 213078, 151972, 90740, 177441, 246513, 203931, 187084, 78742, 101797, 286785, 203932, 177448, 285047]
2023-11-16 08:59:23.216 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 4ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:23.217 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 130009 99446 [123707, 166028, 166029, 166030, 166031, 166033, 185280, 231428, 239483]
2023-11-16 08:59:23.217 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  130009 99446 
2023-11-16 08:59:23.217 DEBUG 1 --- [     Thread-365] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 130009 99446 [123707, 166028, 166029, 166030, 166031, 166033, 185280, 231428, 239483]
2023-11-16 08:59:23.219 DEBUG 1 --- [     Thread-365] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 130009 99446 [123707, 166028, 166029, 166030, 166031, 166033, 185280, 231428, 239483]
2023-11-16 08:59:23.219 DEBUG 1 --- [     Thread-365] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:23.219 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  130009 99446 
2023-11-16 08:59:23.219 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:23.219 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 130009 99446 [185280, 166033, 231428, 123707, 166030, 166031, 166028, 166029]
2023-11-16 08:59:23.221 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 130009 99446 [185280, 166033, 231428, 123707, 166030, 166031, 166028, 166029]
2023-11-16 08:59:23.221 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:23.221 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 130009 99446 [185280, 166033, 231428, 123707, 166030, 166031, 166028, 166029]
2023-11-16 08:59:23.285 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_495643
2023-11-16 08:59:23.285 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_495643
2023-11-16 08:59:23.297 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_495643
2023-11-16 08:59:23.298 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 12ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:23.307 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:23.308 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 495643 
2023-11-16 08:59:24.008 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1037376
2023-11-16 08:59:24.118 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1037376
2023-11-16 08:59:24.120  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1037376
2023-11-16 08:59:24.120 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1037376 
2023-11-16 08:59:24.125 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:24.125 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1037376 
2023-11-16 08:59:24.125  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1037376
2023-11-16 08:59:24.125 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1037376 
2023-11-16 08:59:24.125 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1037376 
2023-11-16 08:59:24.125 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.178 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, with SITE_IDS as(select unnest('{32749,69853,2493241,5370067,23881660,52396211,52396809,77034027,77034028}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[1037376] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:24.178 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 53ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:24.178 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 1037376
2023-11-16 08:59:24.193 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 1256ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:24.193 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.220 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 495643
2023-11-16 08:59:24.232 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 158312 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 158312), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =158312 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1677,29048,30144,37163,45425,46086,49301,55741,96362,96949,291017,300111,300113,300114,322705,366560,428271,443659,448489,534966,534974,534975,536498,536856,654800,721088,722040,731078,732853,924351,974076,1076447,1189136,1638163,1657571,1657954,1937757,2020370,2397553,2397554,2423549,2423551,2423554,2423560,2423561,2423563,2537159}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158312 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:24.234 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 41ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:24.234 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 158312 
2023-11-16 08:59:24.234 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.263 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 495643
2023-11-16 08:59:24.264  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 495643
2023-11-16 08:59:24.264 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 495643 
2023-11-16 08:59:24.269 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:24.269 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 495643 
2023-11-16 08:59:24.269  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 495643
2023-11-16 08:59:24.269 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 495643 
2023-11-16 08:59:24.269 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 495643 
2023-11-16 08:59:24.269 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.271 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, with SITE_IDS as ( select unnest('{1677,29048,30144,37163,45425,46086,49301,55741,96362,96949,291017,300111,300113,300114,322705,366560,428271,443659,448489,534966,534974,534975,536498,536856,654800,721088,722040,731078,732853,924351,974076,1076447,1189136,1638163,1657571,1657954,1937757,2020370,2397553,2397554,2423549,2423551,2423554,2423560,2423561,2423563,2537159}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158312 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:24.272 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 158312
2023-11-16 08:59:24.273 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 37ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:24.316 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, with SITE_IDS as(select unnest('{3614160,3614168,3614169,79124157}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[495643] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:24.316 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 47ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:24.316 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 495643
2023-11-16 08:59:24.432 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_1037376
2023-11-16 08:59:24.433 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_1037376
2023-11-16 08:59:24.433 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.506 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [73, with SITEID as( select * from ( select unnest(array[23881660,5370067,52396809,77034028,69853,52396211,77034027,32749,2493241]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:24.506 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 73ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:24.509 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1037376
2023-11-16 08:59:24.509 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 76ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1037376
2023-11-16 08:59:24.518 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_1037376
2023-11-16 08:59:24.518 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 8ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:24.518 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 1037376 
2023-11-16 08:59:24.519  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 1037376
2023-11-16 08:59:24.549 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_495643
2023-11-16 08:59:24.549 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_495643
2023-11-16 08:59:24.549 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.578 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, with SITEID as( select * from ( select unnest(array[3614160,79124157,3614169,3614168]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:24.578 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 28ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:24.581 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_495643
2023-11-16 08:59:24.581 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 31ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_495643
2023-11-16 08:59:24.586 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 130009 99446 [185280, 166033, 231428, 123707, 166030, 166031, 166028]
2023-11-16 08:59:24.587 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 1365ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:24.587 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 130009 99446 [185280, 166033, 231428, 123707, 166030, 166031, 166028]
2023-11-16 08:59:24.590 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_495643
2023-11-16 08:59:24.590 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:24.591 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 495643 
2023-11-16 08:59:24.591  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 495643
2023-11-16 08:59:24.594 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 1037376 
2023-11-16 08:59:24.594 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 158312, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:24.594 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868311 and EventDetID : 99446 
2023-11-16 08:59:24.594 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 158312
2023-11-16 08:59:24.595 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868311
2023-11-16 08:59:24.595 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 1ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:24.595 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868311 and Event_Details ID : 99446 
2023-11-16 08:59:24.595 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:24.596 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:24.599 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:24.600 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 1037376 
2023-11-16 08:59:24.605 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:24.608 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 1037376
2023-11-16 08:59:24.609 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 158312 -- Resulted rows -- [1]
2023-11-16 08:59:24.609 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:24.609 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 158312 : false : false : 19868311 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 158312
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 4ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 158312
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 158312
2023-11-16 08:59:24.614  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 158312
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 158312 
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 158312 
2023-11-16 08:59:24.614 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.651 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 495643 
2023-11-16 08:59:24.657 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:24.657 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 495643 
2023-11-16 08:59:24.666 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 495643
2023-11-16 08:59:24.667 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (158312,2177,75784,75804,3248,1375,7837,292,1449,1788,1388,327,273,293,1404,1572,90,22682,2281,1573,1166,324,4473,152723,45992,144203,1369,1385,832,1366,1405,1402,1587,7297,154273) and event_details_id = 99446] 
2023-11-16 08:59:24.670 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_158312
2023-11-16 08:59:24.670 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 158312
2023-11-16 08:59:24.670 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 56ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:24.671  INFO 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [158312]
2023-11-16 08:59:24.673  INFO 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [158312]
2023-11-16 08:59:24.673 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158312 
2023-11-16 08:59:24.673 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158312 
2023-11-16 08:59:24.673 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.690 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 130009 99446 [185280, 166033, 231428, 166030, 166031, 166028]
2023-11-16 08:59:24.690 DEBUG 1 --- [     Thread-364] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 103ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:24.690 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 130009 and eventId 99446 and userIds [123707, 185280, 166033, 231428, 166030, 166031, 166028]
2023-11-16 08:59:24.691 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 130009 and eventId : 99446 
2023-11-16 08:59:24.691 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:24.701 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 7
2023-11-16 08:59:24.701 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 10ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:24.702 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 130009 99446
2023-11-16 08:59:24.702 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 130009
2023-11-16 08:59:24.702  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 130009
2023-11-16 08:59:24.702 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:24.702 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [130009] 
2023-11-16 08:59:24.704 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:24.704 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 1ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:24.704  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 130009, isUpdateAlert : true
2023-11-16 08:59:24.704  INFO 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:24.704 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:24.704  INFO 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:24.705 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"4fb397ba-c6b7-4d19-9cd4-048cd8fa282e","eventId":19868306,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:24.706  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868306, tenantId : 130009
2023-11-16 08:59:24.706  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:24.706  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [178745, 251179, 396202, 438195, 438402, 438635, 438829, 439501] 
2023-11-16 08:59:24.706 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"4fb397ba-c6b7-4d19-9cd4-048cd8fa282e","eventId":19868306,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41766
2023-11-16 08:59:24.706 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.707 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 158312 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1677,29048,30144,37163,45425,46086,49301,55741,96362,96949,291017,300111,300113,300114,322705,366560,428271,443659,448489,534966,534974,534975,536498,536856,654800,721088,722040,732853,924351,974076,1076447,1189136,1638163,1657571,1657954,1937757,2020370,2397553,2397554,2423549,2423551,2423554,2423560,2423561,2423563,2537159)] 
2023-11-16 08:59:24.709 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158312
2023-11-16 08:59:24.709 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 36ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:24.760 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.762 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [56, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (178745,251179,396202,438195,438402,438635,438829,439501)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:24.763 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 56ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:24.814 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [54, WITH SITE_IDS AS( SELECT UNNEST('{1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,1677,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,29048,30144,30144,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,45425,45425,45425,45425,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,55741,55741,55741,55741,96362,96949,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,291017,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,366560,366560,366560,366560,366560,366560,366560,428271,428271,428271,428271,428271,443659,443659,448489,448489,448489,448489,448489,448489,448489,448489,448489,448489,448489,448489,448489,534966,534966,534966,534966,534966,534974,534974,534974,534974,534974,534975,534975,534975,534975,534975,536498,536498,536498,536498,536856,536856,654800,654800,654800,654800,654800,654800,654800,654800,654800,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,732853,732853,732853,732853,732853,732853,732853,732853,924351,974076,974076,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1076447,1189136,1189136,1638163,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2020370,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397553,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2397554,2423549,2423549,2423549,2423549,2423549,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423551,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423554,2423560,2423560,2423560,2423560,2423560,2423560,2423560,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2423563,2537159,2537159}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[158312] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 158312 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:24.815 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 55ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:24.815 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 158312 
2023-11-16 08:59:24.850 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.895 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (178745,251179,396202,438195,438402,438635,438829,439501)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:24.895 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 45ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:24.900 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_130009
2023-11-16 08:59:24.900 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 4ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_130009
2023-11-16 08:59:24.903 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_130009
2023-11-16 08:59:24.903 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_130009
2023-11-16 08:59:24.908 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:24.952 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 1037376
2023-11-16 08:59:24.954  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 1037376
2023-11-16 08:59:24.954 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 1037376 
2023-11-16 08:59:24.954 DEBUG 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:24.979 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 1037376 and es.event_id = 19868309 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:24.979 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 25ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:24.983 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_1037376
2023-11-16 08:59:24.983 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_1037376
2023-11-16 08:59:24.986 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:24.987 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 1037376 
2023-11-16 08:59:25.031 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 495643
2023-11-16 08:59:25.032  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 495643
2023-11-16 08:59:25.032 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 495643 
2023-11-16 08:59:25.032 DEBUG 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.045  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 1037376
2023-11-16 08:59:25.045 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1037376 
2023-11-16 08:59:25.048 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1037376 
2023-11-16 08:59:25.048  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): false, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:25.048 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 1037376 
2023-11-16 08:59:25.048 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 1037376
2023-11-16 08:59:25.049 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 158312
2023-11-16 08:59:25.049 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 233ms : for accumlator : {}
2023-11-16 08:59:25.049 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 158312 
2023-11-16 08:59:25.053 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_158312
2023-11-16 08:59:25.054 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_158312
2023-11-16 08:59:25.054 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.087  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 130009
2023-11-16 08:59:25.087 DEBUG 1 --- [6_103335_130009] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.098 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [65, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 495643 and es.event_id = 19868310 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:25.098 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 66ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:25.099 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 158312 and total_cpns != '{}' and site_private_id = any('{52050133,52050401,52051066,52051195,52051287,52052733,52052734,52052735,52052960,52054010,52054194,52054375,52055178,52055295,52056082,52056187,52056521,52056522,52056658,53737818,54991508,58574420,67851955,73663035,73665405,73672869,73673099,73674839,73675374,76438076,76438077,76438078,76438079,85574400,87876704,87876833,87876975,87877060,87877098,87877118,87877152,87877179,88010904,88011623,88011624,88011963}')] 
2023-11-16 08:59:25.102 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_495643
2023-11-16 08:59:25.102 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_158312
2023-11-16 08:59:25.102 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_495643
2023-11-16 08:59:25.102 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 48ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:25.102 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.105 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:25.105 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 495643 
2023-11-16 08:59:25.125 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[185834, 6249, 248649, 168581, 239239, 248648]
2023-11-16 08:59:25.125 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 77ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:25.125 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 6 for customer 1037376
2023-11-16 08:59:25.125 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[185834, 6249, 248649, 168581, 239239, 248648]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1037376
2023-11-16 08:59:25.140 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[185834, 6249, 248649, 168581, 239239, 248648]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1037376
2023-11-16 08:59:25.140 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 14ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:25.140 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 1037376 99446 user with No pref [185834, 6249, 248649, 168581, 239239, 248648]
2023-11-16 08:59:25.142 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:25.143 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 1037376 99446 [256234]
2023-11-16 08:59:25.143 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  1037376 99446 
2023-11-16 08:59:25.143 DEBUG 1 --- [     Thread-367] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 1037376 99446 [256234]
2023-11-16 08:59:25.144 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [57, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (178745,251179,396202,438195,438402,438635,438829,439501) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:25.145 DEBUG 1 --- [     Thread-367] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 1037376 99446 [256234]
2023-11-16 08:59:25.145 DEBUG 1 --- [     Thread-367] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:25.146 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  1037376 99446 
2023-11-16 08:59:25.146 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:25.146 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 1037376 99446 []
2023-11-16 08:59:25.146 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 1037376 99446 []
2023-11-16 08:59:25.146 DEBUG 1 --- [     Thread-366] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 1037376 99446 []
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 1037376 and eventId 99446 and userIds []
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 1037376 and eventId : 99446 
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 1037376 99446
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 1037376
2023-11-16 08:59:25.146  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 1037376
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:25.146 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1037376] 
2023-11-16 08:59:25.147 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, with SITEID as( select * from ( select unnest(array[73672869,87877118,88011963,87877179,52056082,52056658,73675374,52051287,52050133,52055178,52056522,52056521,54991508,87876975,87877098,88011624,73665405,85574400,88011623,87876704,87877152,87876833,73663035,52051066,52054010,52051195,52056187,52052734,52052735,52055295,88010904,52052733,52054194,53737818,58574420,73673099,76438078,76438079,76438076,73674839,76438077,67851955,87877060,52052960,52050401,52054375]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:25.148 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 45ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:25.150 DEBUG 1 --- [6_103335_130009] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_130009
2023-11-16 08:59:25.150 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 63ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:25.151 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_158312
2023-11-16 08:59:25.152 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 49ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_158312
2023-11-16 08:59:25.153 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:25.153 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:?] : [updateEventShareable:2234]: Time taken : 6ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:25.153  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 1037376, isUpdateAlert : true
2023-11-16 08:59:25.153  INFO 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:25.153 DEBUG 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:25.154 DEBUG 1 --- [_103335_1037376] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:25.154  INFO 1 --- [_103335_1037376] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:25.154 DEBUG 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"ae6f97bf-2dca-4447-b2dd-fbf793f1bf92","eventId":19868309,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:25.155  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868309, tenantId : 1037376
2023-11-16 08:59:25.155  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:25.155  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:25.155 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"ae6f97bf-2dca-4447-b2dd-fbf793f1bf92","eventId":19868309,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41767
2023-11-16 08:59:25.156  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:25.156  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:25.156  INFO 1 --- [_103335_1037376] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1037376, Took : 3s
2023-11-16 08:59:25.156  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1007397 
2023-11-16 08:59:25.156  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:25.157 DEBUG 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:25.163  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 495643
2023-11-16 08:59:25.163 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 495643 
2023-11-16 08:59:25.164 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_158312
2023-11-16 08:59:25.165 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 12ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:25.165 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 158312
2023-11-16 08:59:25.167 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 495643 
2023-11-16 08:59:25.167  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:25.167 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 495643 
2023-11-16 08:59:25.167 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 495643
2023-11-16 08:59:25.173 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158312 
2023-11-16 08:59:25.173 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 158312 
2023-11-16 08:59:25.173 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 158312 
2023-11-16 08:59:25.173 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.174 DEBUG 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 16ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:25.174 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1007397, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:25.174 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:25.174 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1007397
2023-11-16 08:59:25.175 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868312
2023-11-16 08:59:25.176 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 1ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.176 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:25.176 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:25.177 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 1ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.178 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:25.183 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1007397 -- Resulted rows -- [1]
2023-11-16 08:59:25.183 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 5ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:25.183 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1007397 : null : null : 19868312 : Update published
2023-11-16 08:59:25.186 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1007397
2023-11-16 08:59:25.186 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:25.187 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1007397
2023-11-16 08:59:25.187  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1007397
2023-11-16 08:59:25.187  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1007397 
2023-11-16 08:59:25.187 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:25.187 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1007397] 
2023-11-16 08:59:25.190 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:25.190 DEBUG 1 --- [_103335_1007397] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:25.190 DEBUG 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1007397 
2023-11-16 08:59:25.190 DEBUG 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1007397 
2023-11-16 08:59:25.191  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:25.191  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:25.191  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:25.191  INFO 1 --- [_103335_1007397] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1007397, Took : 0s
2023-11-16 08:59:25.191  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 988061 
2023-11-16 08:59:25.191  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:25.191 DEBUG 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:25.215 DEBUG 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 23ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:25.215 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 988061, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:25.215 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:25.215 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 988061
2023-11-16 08:59:25.216 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868313
2023-11-16 08:59:25.216 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.216 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:25.216 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:25.217 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 1ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.218 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:25.223 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868311 and tenant_id = 158312] 
2023-11-16 08:59:25.223 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 50ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:25.224 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 988061 -- Resulted rows -- [1]
2023-11-16 08:59:25.224 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 6ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:25.225 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 988061 : null : null : 19868313 : Update published
2023-11-16 08:59:25.229 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 988061
2023-11-16 08:59:25.229 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 4ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:25.229 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 988061
2023-11-16 08:59:25.229  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 988061
2023-11-16 08:59:25.229  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 988061 
2023-11-16 08:59:25.229 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:25.229 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [988061] 
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_988061] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 988061 
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[213456, 5357, 235757, 132982, 106799, 101797, 235756]
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 988061 
2023-11-16 08:59:25.232 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 65ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:25.232  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:25.233 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 7 for customer 495643
2023-11-16 08:59:25.233 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[213456, 5357, 235757, 132982, 106799, 101797, 235756]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}495643
2023-11-16 08:59:25.233  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:25.233  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:25.233  INFO 1 --- [6_103335_988061] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 988061, Took : 0s
2023-11-16 08:59:25.233  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 815176 
2023-11-16 08:59:25.233  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:25.234 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:25.247  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 130009
2023-11-16 08:59:25.247  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:25.247  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:25.248  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:25.248  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:25.248  INFO 1 --- [6_103335_130009] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 130009, Took : 5s
2023-11-16 08:59:25.248  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 480856 
2023-11-16 08:59:25.248  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:25.248 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[213456, 5357, 235757, 132982, 106799, 101797, 235756]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}495643
2023-11-16 08:59:25.249 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 15ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:25.249 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 495643 99446 user with No pref [213456, 5357, 235757, 132982, 106799, 101797, 235756]
2023-11-16 08:59:25.249 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:25.251 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:25.251 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 495643 99446 [182265]
2023-11-16 08:59:25.251 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  495643 99446 
2023-11-16 08:59:25.251 DEBUG 1 --- [     Thread-369] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 495643 99446 [182265]
2023-11-16 08:59:25.253 DEBUG 1 --- [     Thread-369] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 495643 99446 [182265]
2023-11-16 08:59:25.253 DEBUG 1 --- [     Thread-369] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:25.254 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  495643 99446 
2023-11-16 08:59:25.254 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:25.254 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 495643 99446 [182265]
2023-11-16 08:59:25.256 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 21ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:25.256 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.258 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 495643 99446 [182265]
2023-11-16 08:59:25.259 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithCountry:1206]: Time taken : 3ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:25.259 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 495643 99446 [182265]
2023-11-16 08:59:25.266 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 495643 99446 [182265]
2023-11-16 08:59:25.266 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 7ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:25.266 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 495643 99446 [182265]
2023-11-16 08:59:25.268 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 495643 99446 [182265]
2023-11-16 08:59:25.268 DEBUG 1 --- [     Thread-368] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 1ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:25.268 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 495643 and eventId 99446 and userIds [182265]
2023-11-16 08:59:25.268 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 495643 and eventId : 99446 
2023-11-16 08:59:25.268 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:25.271 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 1
2023-11-16 08:59:25.271 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 3ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:25.271 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 495643 99446
2023-11-16 08:59:25.271 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 495643
2023-11-16 08:59:25.271  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 495643
2023-11-16 08:59:25.271 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:25.272 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [495643] 
2023-11-16 08:59:25.275 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:25.275 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:25.275  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 495643, isUpdateAlert : true
2023-11-16 08:59:25.275  INFO 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:25.277 DEBUG 1 --- [6_103335_495643] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [1, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:25.277  INFO 1 --- [6_103335_495643] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:25.278 DEBUG 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"b9b62da5-1cf3-4597-acb9-4e62bc9f2a73","eventId":19868310,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868310, tenantId : 495643
2023-11-16 08:59:25.279 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"b9b62da5-1cf3-4597-acb9-4e62bc9f2a73","eventId":19868310,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41768
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:25.279  INFO 1 --- [6_103335_495643] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 495643, Took : 2s
2023-11-16 08:59:25.280  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1003059 
2023-11-16 08:59:25.280  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:25.282 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 2ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:25.302 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_158312
2023-11-16 08:59:25.303 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_158312
2023-11-16 08:59:25.313 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_158312
2023-11-16 08:59:25.313 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:25.318 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [62, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 815176 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 815176), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =815176 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{2547667,2549707,2552940,2554367,2555101,2555555,2555921,2556252}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 815176 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:25.320 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 64ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:25.320 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 815176 
2023-11-16 08:59:25.321 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.322 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:25.323 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 158312 
2023-11-16 08:59:25.348 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, with SITE_IDS as ( select unnest('{2547667,2549707,2552940,2554367,2555101,2555555,2555921,2556252}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 815176 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:25.350 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 815176
2023-11-16 08:59:25.351 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 29ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:25.635 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 815176, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:25.635 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868315 and EventDetID : 99446 
2023-11-16 08:59:25.635 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 815176
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868315
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868315 and Event_Details ID : 99446 
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.636 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:25.642 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 815176 -- Resulted rows -- [1]
2023-11-16 08:59:25.642 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 5ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:25.642 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 815176 : false : false : 19868315 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 815176
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 815176
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 815176
2023-11-16 08:59:25.645  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 815176
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 815176 
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 815176 
2023-11-16 08:59:25.645 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.648 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 366ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:25.648 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.686 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (815176,1208535,1243447,469597,1228355,1234705,1247948,29084) and event_details_id = 99446] 
2023-11-16 08:59:25.689 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_815176
2023-11-16 08:59:25.689 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 815176
2023-11-16 08:59:25.690 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 44ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:25.690  INFO 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [815176]
2023-11-16 08:59:25.697  INFO 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [815176]
2023-11-16 08:59:25.697 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 815176 
2023-11-16 08:59:25.698 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 815176 
2023-11-16 08:59:25.698 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.700 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1003059 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1003059), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1003059 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{300111,300113,300114,322705,731078,977159}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1003059 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:25.701 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 52ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:25.701 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1003059 
2023-11-16 08:59:25.701 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.726 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, with SITE_IDS as ( select unnest('{300111,300113,300114,322705,731078,977159}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1003059 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:25.728 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1003059
2023-11-16 08:59:25.728 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 26ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:25.728 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 815176 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (2547667,2549707,2552940,2554367,2555101,2555555,2555921,2556252)] 
2023-11-16 08:59:25.730 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 815176
2023-11-16 08:59:25.730 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 32ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:25.844 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.928 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1003059, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:25.929 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868314 and EventDetID : 99446 
2023-11-16 08:59:25.929 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1003059
2023-11-16 08:59:25.929 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868314
2023-11-16 08:59:25.929 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.929 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868314 and Event_Details ID : 99446 
2023-11-16 08:59:25.930 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:25.930 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:25.931 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [?:?] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:25.940 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1003059 -- Resulted rows -- [1]
2023-11-16 08:59:25.940 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 8ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:25.940 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1003059 : false : false : 19868314 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:25.943 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1003059
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1003059
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1003059
2023-11-16 08:59:25.944  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1003059
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1003059 
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1003059 
2023-11-16 08:59:25.944 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:25.954 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [109, WITH SITE_IDS AS( SELECT UNNEST('{2547667,2549707,2552940,2554367,2555101,2555555,2555921,2556252}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[815176] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 815176 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:25.955 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 110ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:25.955 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 815176 
2023-11-16 08:59:25.996 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1003059) and event_details_id = 99446] 
2023-11-16 08:59:26.001 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1003059
2023-11-16 08:59:26.001 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1003059
2023-11-16 08:59:26.001 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 56ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:26.001  INFO 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1003059]
2023-11-16 08:59:26.001 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1003059 
2023-11-16 08:59:26.002 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1003059 
2023-11-16 08:59:26.002 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.046 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1003059 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (300114,977159,322705,300111,731078,300113)] 
2023-11-16 08:59:26.047 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1003059
2023-11-16 08:59:26.047 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 45ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:26.099 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 815176
2023-11-16 08:59:26.099 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 143ms : for accumlator : {}
2023-11-16 08:59:26.099 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 815176 
2023-11-16 08:59:26.105 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_815176
2023-11-16 08:59:26.105 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 5ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_815176
2023-11-16 08:59:26.105 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.110 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.145 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 815176 and total_cpns != '{}' and site_private_id = any('{88248213,88250233,88253464,88254891,88255625,88256079,88256445,88256776}')] 
2023-11-16 08:59:26.150 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_815176
2023-11-16 08:59:26.150 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 45ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:26.150 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.158 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, WITH SITE_IDS AS( SELECT UNNEST('{300111,300113,300114,322705,731078,977159}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1003059] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1003059 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:26.159 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 48ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:26.159 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1003059 
2023-11-16 08:59:26.206 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [55, with SITEID as( select * from ( select unnest(array[88248213,88254891,88253464,88256776,88250233,88255625,88256079,88256445]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:26.206 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 56ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:26.210 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_815176
2023-11-16 08:59:26.210 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 59ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_815176
2023-11-16 08:59:26.222 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_815176
2023-11-16 08:59:26.223 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 12ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:26.223 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 815176
2023-11-16 08:59:26.230 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 815176 
2023-11-16 08:59:26.230 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 815176 
2023-11-16 08:59:26.230 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 815176 
2023-11-16 08:59:26.230 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.232 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 158312
2023-11-16 08:59:26.294 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1003059
2023-11-16 08:59:26.294 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 135ms : for accumlator : {}
2023-11-16 08:59:26.294 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1003059 
2023-11-16 08:59:26.295 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [65, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868315 and tenant_id = 815176] 
2023-11-16 08:59:26.296 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 65ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:26.296 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 158312
2023-11-16 08:59:26.296  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 158312
2023-11-16 08:59:26.296 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 158312 
2023-11-16 08:59:26.299 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1003059
2023-11-16 08:59:26.299 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1003059
2023-11-16 08:59:26.299 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.301 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:26.302 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 158312 
2023-11-16 08:59:26.302  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 158312
2023-11-16 08:59:26.302 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 158312 
2023-11-16 08:59:26.302 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 158312 
2023-11-16 08:59:26.302 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.336 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1003059 and total_cpns != '{}' and site_private_id = any('{64552331,64577174,64577721,64577722,64577723,64577724}')] 
2023-11-16 08:59:26.341 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1003059
2023-11-16 08:59:26.341 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 42ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:26.341 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.353 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with SITE_IDS as(select unnest('{13979,14741,20145,24570,32749,44573,63635,69853,85939,104865,1204813,1233762,1233772,1233775,1881386,2288516,2381972,2493241,3614160,3614168,3614169,3615692,3616050,4727785,4728572,5369115,5370067,5690442,10182907,12026033,23881660,26110573,52062549,52395825,52396211,60450749,62727695,77034027,77034028,79124157,79124684,79125735,79127310,79127447,79127543,87877191}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[158312] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:26.354 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 51ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:26.354 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 158312
2023-11-16 08:59:26.361 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_815176
2023-11-16 08:59:26.361 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 3ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_815176
2023-11-16 08:59:26.374 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with SITEID as( select * from ( select unnest(array[64577721,64577723,64552331,64577722,64577724,64577174]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:26.374 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 32ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:26.375 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_815176
2023-11-16 08:59:26.375 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 13ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:26.378 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1003059
2023-11-16 08:59:26.378 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 36ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1003059
2023-11-16 08:59:26.386 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 11ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:26.387 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 815176 
2023-11-16 08:59:26.389 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1003059
2023-11-16 08:59:26.390 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 11ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:26.390 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1003059
2023-11-16 08:59:26.397 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1003059 
2023-11-16 08:59:26.397 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1003059 
2023-11-16 08:59:26.397 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1003059 
2023-11-16 08:59:26.397 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.445 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868314 and tenant_id = 1003059] 
2023-11-16 08:59:26.445 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 48ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:26.527 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1003059
2023-11-16 08:59:26.527 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 5ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1003059
2023-11-16 08:59:26.540 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1003059
2023-11-16 08:59:26.541 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 13ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:26.552 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 10ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:26.555 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1003059 
2023-11-16 08:59:26.586 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_158312
2023-11-16 08:59:26.586 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_158312
2023-11-16 08:59:26.586 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:26.632 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, with SITEID as( select * from ( select unnest(array[79127543,5370067,3616050,12026033,5369115,79124157,52062549,23881660,79125735,63635,14741,13979,69853,5690442,44573,1204813,2493241,104865,10182907,79127447,4727785,26110573,2288516,3614160,60450749,52396211,32749,3614169,52395825,3614168,1233762,2381972,20145,85939,62727695,4728572,1881386,79127310,24570,3615692,77034028,79124684,87877191,77034027,1233775,1233772]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:26.633 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 46ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:26.637 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158312
2023-11-16 08:59:26.637 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 50ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158312
2023-11-16 08:59:26.647 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_158312
2023-11-16 08:59:26.647 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 10ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:26.647 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 158312 
2023-11-16 08:59:26.647  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 158312
2023-11-16 08:59:26.748 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 158312 
2023-11-16 08:59:26.753 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:26.753 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 158312 
2023-11-16 08:59:26.764 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 158312
2023-11-16 08:59:27.088 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 1838ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:27.088 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.135 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 480856 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 480856), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =480856 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1677,20974,29048,37163,45227,45425,46065,46086,46830,49301,55741,65507,300111,300113,300114,322705,428271,534966,534974,534975,536856,654391,654800,660111,660112,722040,723410,732853,1222008,1621936,1657571,1657954,1937757,2020370,2020655,2272461,2337752,2373503,2377273,2397554,2423547,2423549,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423560,2423561,2423562,2423563}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 480856 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:27.136 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 48ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:27.136 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 480856 
2023-11-16 08:59:27.136 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.181 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, with SITE_IDS as ( select unnest('{1677,20974,29048,37163,45227,45425,46065,46086,46830,49301,55741,65507,300111,300113,300114,322705,428271,534966,534974,534975,536856,654391,654800,660111,660112,722040,723410,732853,1222008,1621936,1657571,1657954,1937757,2020370,2020655,2272461,2337752,2373503,2377273,2397554,2423547,2423549,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423560,2423561,2423562,2423563}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 480856 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:27.183 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 480856
2023-11-16 08:59:27.184 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 46ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:27.358 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 815176
2023-11-16 08:59:27.427 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 815176
2023-11-16 08:59:27.429  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 815176
2023-11-16 08:59:27.429 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 815176 
2023-11-16 08:59:27.434 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:27.434 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 815176 
2023-11-16 08:59:27.434  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 815176
2023-11-16 08:59:27.434 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 815176 
2023-11-16 08:59:27.434 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 815176 
2023-11-16 08:59:27.434 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.481 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, with SITE_IDS as(select unnest('{88258458,88259606,88260946,88262008,88262680,88263728,88264093,88265671}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[815176] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:27.482 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 47ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:27.482 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 815176
2023-11-16 08:59:27.589 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 480856, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:27.590 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868316 and EventDetID : 99446 
2023-11-16 08:59:27.590 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 480856
2023-11-16 08:59:27.591 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868316
2023-11-16 08:59:27.591 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 1ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:27.591 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868316 and Event_Details ID : 99446 
2023-11-16 08:59:27.591 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:27.592 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:27.592 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:27.598 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 480856 -- Resulted rows -- [1]
2023-11-16 08:59:27.598 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 5ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:27.598 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 480856 : false : false : 19868316 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 480856
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 480856
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 480856
2023-11-16 08:59:27.600  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 480856
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 480856 
2023-11-16 08:59:27.600 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 480856 
2023-11-16 08:59:27.601 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.604 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1003059
2023-11-16 08:59:27.641 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (480856,1388,29622,1375,1449,1788,327,273,90,1573,4473,561172,1369,1385,1404,832,6437,585596,1366,1382,1405,732,1402,1587) and event_details_id = 99446] 
2023-11-16 08:59:27.644 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_480856
2023-11-16 08:59:27.644 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 480856
2023-11-16 08:59:27.644 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 43ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:27.644  INFO 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [480856]
2023-11-16 08:59:27.646  INFO 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [480856]
2023-11-16 08:59:27.646 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 480856 
2023-11-16 08:59:27.646 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 480856 
2023-11-16 08:59:27.646 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.667 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1003059
2023-11-16 08:59:27.668  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1003059
2023-11-16 08:59:27.668 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1003059 
2023-11-16 08:59:27.672 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:27.673 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1003059 
2023-11-16 08:59:27.673  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1003059
2023-11-16 08:59:27.673 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1003059 
2023-11-16 08:59:27.673  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : false for this customer : 99446 and event : 1003059
2023-11-16 08:59:27.673 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 1003059
2023-11-16 08:59:27.689 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 480856 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1677,29048,37163,45227,46086,65507,300111,300113,300114,322705,428271,534966,534974,534975,654391,654800,660111,660112,732853,1621936,1657571,1657954,1937757,2020370,2020655,2272461,2337752,2397554,2423549,2423551,2423552,2423553,2423556,2423560,2423561,20974,45425,46065,46830,49301,55741,536856,722040,723410,1222008,2373503,2377273,2423547,2423554,2423555,2423557,2423562,2423563)] 
2023-11-16 08:59:27.691 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 480856
2023-11-16 08:59:27.691 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 44ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:27.734 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 158312
2023-11-16 08:59:27.734  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 158312
2023-11-16 08:59:27.734 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 158312 
2023-11-16 08:59:27.734 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.765 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 158312 and es.event_id = 19868311 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:27.766 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 31ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:27.770 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_158312
2023-11-16 08:59:27.770 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_158312
2023-11-16 08:59:27.773 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:27.774 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 158312 
2023-11-16 08:59:27.779 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.822 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, WITH SITE_IDS AS( SELECT UNNEST('{1677,20974,29048,37163,45227,45425,46065,46086,46830,49301,55741,65507,300111,300113,300114,322705,428271,534966,534974,534975,536856,654391,654800,660111,660112,722040,723410,732853,1222008,1621936,1657571,1657954,1937757,2020370,2020655,2272461,2337752,2373503,2377273,2397554,2423547,2423549,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423560,2423561,2423562,2423563}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[480856] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 480856 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:27.823 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 43ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:27.823 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 480856 
2023-11-16 08:59:27.827 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_815176
2023-11-16 08:59:27.827 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_815176
2023-11-16 08:59:27.827 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.842 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 1003059
2023-11-16 08:59:27.842  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 1003059
2023-11-16 08:59:27.842 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 1003059 
2023-11-16 08:59:27.842 DEBUG 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:27.845  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 158312
2023-11-16 08:59:27.845 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 158312 
2023-11-16 08:59:27.848 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 158312 
2023-11-16 08:59:27.848  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:27.848 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 158312 
2023-11-16 08:59:27.848 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 158312
2023-11-16 08:59:27.873 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, with SITEID as( select * from ( select unnest(array[88260946,88263728,88259606,88265671,88258458,88262008,88262680,88264093]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:27.874 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 46ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:27.878 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_815176
2023-11-16 08:59:27.878 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 51ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_815176
2023-11-16 08:59:27.890 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_815176
2023-11-16 08:59:27.890 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 11ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:27.890 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 815176 
2023-11-16 08:59:27.890  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 815176
2023-11-16 08:59:27.897 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [54, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 1003059 and es.event_id = 19868314 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:27.897 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 55ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:27.906 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_1003059
2023-11-16 08:59:27.906 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 8ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_1003059
2023-11-16 08:59:27.915 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 8ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:27.915 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 1003059 
2023-11-16 08:59:27.923 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[106799, 384, 182265, 205408, 231360, 166105, 213456, 231358, 5357, 214246, 216469, 258878, 258879, 6743, 101797, 302487]
2023-11-16 08:59:27.923 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 75ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:27.923 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 16 for customer 158312
2023-11-16 08:59:27.926 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[106799, 384, 182265, 205408, 231360, 166105, 213456, 231358, 5357, 214246, 216469, 258878, 258879, 6743, 101797, 302487]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158312
2023-11-16 08:59:27.945 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[106799, 384, 182265, 205408, 231360, 166105, 213456, 231358, 5357, 214246, 216469, 258878, 258879, 6743, 101797, 302487]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158312
2023-11-16 08:59:27.945 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 19ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:27.946 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 158312 99446 user with No pref [106799, 384, 182265, 205408, 231360, 166105, 213456, 231358, 5357, 214246, 216469, 258878, 258879, 6743, 101797, 302487]
2023-11-16 08:59:27.948 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:27.948 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 158312 99446 [192878]
2023-11-16 08:59:27.949 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  158312 99446 
2023-11-16 08:59:27.949 DEBUG 1 --- [     Thread-371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 158312 99446 [192878]
2023-11-16 08:59:27.958 DEBUG 1 --- [     Thread-371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 158312 99446 [192878]
2023-11-16 08:59:27.958 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  158312 99446 
2023-11-16 08:59:27.958 DEBUG 1 --- [     Thread-371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 8ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:27.958 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 9ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:27.958 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 158312 99446 [192878]
2023-11-16 08:59:27.962 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 158312 99446 [192878]
2023-11-16 08:59:27.962 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 3ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:27.962 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 158312 99446 [192878]
2023-11-16 08:59:27.972 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 815176 
2023-11-16 08:59:27.979 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 7ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:27.979 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 815176 
2023-11-16 08:59:27.990 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 815176
2023-11-16 08:59:27.997  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 1003059
2023-11-16 08:59:27.998 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1003059 
2023-11-16 08:59:28.000 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1003059 
2023-11-16 08:59:28.000  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): false, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:28.001 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 1003059 
2023-11-16 08:59:28.001 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 1003059
2023-11-16 08:59:28.019 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 480856
2023-11-16 08:59:28.019 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 195ms : for accumlator : {}
2023-11-16 08:59:28.019 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 480856 
2023-11-16 08:59:28.023 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_480856
2023-11-16 08:59:28.024 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_480856
2023-11-16 08:59:28.024 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.073 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[249036, 185834, 277855, 112046, 132982, 300629, 286170, 168581, 135732, 91747, 111757, 224514, 90740]
2023-11-16 08:59:28.073 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 72ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:28.073 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 13 for customer 1003059
2023-11-16 08:59:28.073 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[249036, 185834, 277855, 112046, 132982, 300629, 286170, 168581, 135732, 91747, 111757, 224514, 90740]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1003059
2023-11-16 08:59:28.083 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[249036, 185834, 277855, 112046, 132982, 300629, 286170, 168581, 135732, 91747, 111757, 224514, 90740]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1003059
2023-11-16 08:59:28.083 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 10ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:28.083 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 1003059 99446 user with No pref [249036, 185834, 277855, 112046, 132982, 300629, 286170, 168581, 135732, 91747, 111757, 224514, 90740]
2023-11-16 08:59:28.085 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:28.085 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 1003059 99446 [242493, 242494]
2023-11-16 08:59:28.085 DEBUG 1 --- [     Thread-373] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 1003059 99446 [242493, 242494]
2023-11-16 08:59:28.085 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  1003059 99446 
2023-11-16 08:59:28.088 DEBUG 1 --- [     Thread-373] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 1003059 99446 [242493, 242494]
2023-11-16 08:59:28.089 DEBUG 1 --- [     Thread-373] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 3ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:28.089 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  1003059 99446 
2023-11-16 08:59:28.089 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:28.089 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.092 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.092 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 3ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:28.092 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.095 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [71, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 480856 and total_cpns != '{}' and site_private_id = any('{51489202,69534182,69534183,69534184,69534185,69534186,69534187,69714691,87691333,87691733,87691734,87691735,87692101,87692393,87794248,87794945,87795324,87795677,87795995,87796135,87796178,87796540,87796931,87799186,87799698,87799706,87799707,87799938,87800452,87800839,87800882,87800983,87801801,87802306,87802489,87802756,87802767,87803160,87803283,87803520,87804749,87804750,87804751,87804752,87804753,87804754,87804755,87804756,87804757,87804758,87804759,87804760,87804761}')] 
2023-11-16 08:59:28.098 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_480856
2023-11-16 08:59:28.098 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 74ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:28.098 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.148 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, with SITEID as( select * from ( select unnest(array[87796540,87800882,87796135,87795995,87799707,87799706,51489202,87803160,69714691,87803283,87799186,87799698,87800983,87802767,87799938,87794945,87803520,87800839,87800452,87802756,69534183,87802489,69534182,87795324,69534185,69534184,69534187,69534186,87692393,87804761,87804760,87795677,87804755,87796178,87804754,87804753,87804752,87691734,87804759,87691735,87804758,87804757,87691733,87804756,87801801,87794248,87804751,87804750,87804749,87796931,87802306,87691333,87692101]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:28.148 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 49ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:28.152 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_480856
2023-11-16 08:59:28.153 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 54ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_480856
2023-11-16 08:59:28.163 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_480856
2023-11-16 08:59:28.164 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 11ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:28.164 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 480856
2023-11-16 08:59:28.171 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 480856 
2023-11-16 08:59:28.171 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 480856 
2023-11-16 08:59:28.171 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 480856 
2023-11-16 08:59:28.171 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.185 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.186 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 93ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:28.186 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.190 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 1003059 99446 [242494, 242493]
2023-11-16 08:59:28.190 DEBUG 1 --- [     Thread-372] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 3ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:28.190 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 1003059 and eventId 99446 and userIds [242494, 242493]
2023-11-16 08:59:28.190 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 1003059 and eventId : 99446 
2023-11-16 08:59:28.190 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:28.194 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 2
2023-11-16 08:59:28.195 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 4ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:28.195 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 1003059 99446
2023-11-16 08:59:28.195 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 1003059
2023-11-16 08:59:28.195  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 1003059
2023-11-16 08:59:28.195 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:28.195 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1003059] 
2023-11-16 08:59:28.198 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:28.198 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:28.198  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 1003059, isUpdateAlert : true
2023-11-16 08:59:28.199  INFO 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.199 DEBUG 1 --- [_103335_1003059] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:28.199  INFO 1 --- [_103335_1003059] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.200 DEBUG 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"910f9133-0b54-4fcb-86df-e9077a33127f","eventId":19868314,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:28.201  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868314, tenantId : 1003059
2023-11-16 08:59:28.201 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"910f9133-0b54-4fcb-86df-e9077a33127f","eventId":19868314,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41769
2023-11-16 08:59:28.201  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): false, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:28.201  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:28.202  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:28.202  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:28.202  INFO 1 --- [_103335_1003059] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1003059, Took : 2s
2023-11-16 08:59:28.202  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1053500 
2023-11-16 08:59:28.202  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:28.203 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:28.204 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868316 and tenant_id = 480856] 
2023-11-16 08:59:28.205 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 33ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:28.263 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_480856
2023-11-16 08:59:28.263 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_480856
2023-11-16 08:59:28.273 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_480856
2023-11-16 08:59:28.274 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:28.283 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:28.284 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 480856 
2023-11-16 08:59:28.356 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 815176
2023-11-16 08:59:28.357  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 815176
2023-11-16 08:59:28.357 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 815176 
2023-11-16 08:59:28.357 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.427 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [70, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 815176 and es.event_id = 19868315 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:28.428 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 70ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:28.431 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_815176
2023-11-16 08:59:28.431 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_815176
2023-11-16 08:59:28.434 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:28.435 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 815176 
2023-11-16 08:59:28.501  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 815176
2023-11-16 08:59:28.501 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 815176 
2023-11-16 08:59:28.504 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 815176 
2023-11-16 08:59:28.504  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:28.504 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 815176 
2023-11-16 08:59:28.504 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 815176
2023-11-16 08:59:28.649 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 158312 99446 [192878]
2023-11-16 08:59:28.649 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 687ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:28.649 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 158312 99446 [192878]
2023-11-16 08:59:28.668 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 158312 99446 [192878]
2023-11-16 08:59:28.668 DEBUG 1 --- [     Thread-370] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 18ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:28.668 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 158312 and eventId 99446 and userIds [192878]
2023-11-16 08:59:28.668 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 158312 and eventId : 99446 
2023-11-16 08:59:28.668 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 1
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 3ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 158312 99446
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 158312
2023-11-16 08:59:28.672  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 158312
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:28.672 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [158312] 
2023-11-16 08:59:28.676 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:28.676 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:28.676  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 158312, isUpdateAlert : true
2023-11-16 08:59:28.676  INFO 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.677 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:28.677  INFO 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.678 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"13a5750c-ba37-43b8-acb7-d6e3711c2ed9","eventId":19868311,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:28.679  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868311, tenantId : 158312
2023-11-16 08:59:28.679  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:28.679 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"13a5750c-ba37-43b8-acb7-d6e3711c2ed9","eventId":19868311,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41770
2023-11-16 08:59:28.679  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [154273] 
2023-11-16 08:59:28.680 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.712 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[274259, 265965, 265963, 91747, 265967, 219805, 278676, 265971]
2023-11-16 08:59:28.712 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 207ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:28.712 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 8 for customer 815176
2023-11-16 08:59:28.712 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[274259, 265965, 265963, 91747, 265967, 219805, 278676, 265971]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}815176
2023-11-16 08:59:28.721 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [?:?] : <[274259, 265965, 265963, 91747, 265967, 219805, 278676, 265971]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}815176
2023-11-16 08:59:28.722 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 9ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:28.723 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 815176 99446 user with No pref [274259, 265965, 265963, 91747, 265967, 219805, 278676, 265971]
2023-11-16 08:59:28.725 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:28.725 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 815176 99446 [265969]
2023-11-16 08:59:28.726 DEBUG 1 --- [     Thread-375] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 815176 99446 [265969]
2023-11-16 08:59:28.726 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  815176 99446 
2023-11-16 08:59:28.727 DEBUG 1 --- [     Thread-375] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 815176 99446 [265969]
2023-11-16 08:59:28.727 DEBUG 1 --- [     Thread-375] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:28.730 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  815176 99446 
2023-11-16 08:59:28.731 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 5ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:28.731 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 815176 99446 [265969]
2023-11-16 08:59:28.734 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 815176 99446 []
2023-11-16 08:59:28.734 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 3ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:28.734 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 815176 99446 []
2023-11-16 08:59:28.734 DEBUG 1 --- [     Thread-374] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 815176 99446 []
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 815176 and eventId 99446 and userIds []
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 815176 and eventId : 99446 
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 815176 99446
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 815176
2023-11-16 08:59:28.734  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 815176
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:28.734 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [815176] 
2023-11-16 08:59:28.738 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:28.738 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:28.738  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 815176, isUpdateAlert : true
2023-11-16 08:59:28.738  INFO 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.739 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:28.739  INFO 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:28.740 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"84a8c131-0624-4f7a-ab67-226335e41305","eventId":19868315,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:28.741  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868315, tenantId : 815176
2023-11-16 08:59:28.741  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:28.741 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"84a8c131-0624-4f7a-ab67-226335e41305","eventId":19868315,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41771
2023-11-16 08:59:28.741  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [1208535, 1243447, 469597, 1228355, 1234705, 1247948, 29084] 
2023-11-16 08:59:28.741 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.753 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [73, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (154273)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:28.753 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 73ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:28.787 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (1208535,1243447,469597,1228355,1234705,1247948,29084)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:28.788 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 46ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:28.813 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.841 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (154273)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:28.841 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 27ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:28.845 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158312
2023-11-16 08:59:28.845 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158312
2023-11-16 08:59:28.848 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158312
2023-11-16 08:59:28.849 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158312
2023-11-16 08:59:28.853 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:28.856 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:28.895 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (1208535,1243447,469597,1228355,1234705,1247948,29084)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:28.896 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 39ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:28.899 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_815176
2023-11-16 08:59:28.899 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_815176
2023-11-16 08:59:28.902 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_815176
2023-11-16 08:59:28.902 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 2ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_815176
2023-11-16 08:59:28.906 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:28.971  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 158312
2023-11-16 08:59:28.972 DEBUG 1 --- [6_103335_158312] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.013 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (154273) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:29.018 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_158312
2023-11-16 08:59:29.019 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 47ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:29.022 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:29.042  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 815176
2023-11-16 08:59:29.042 DEBUG 1 --- [6_103335_815176] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.068 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (1208535,1243447,469597,1228355,1234705,1247948,29084) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:29.072 DEBUG 1 --- [6_103335_815176] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_815176
2023-11-16 08:59:29.072 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 29ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:29.075 DEBUG 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:29.087 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 480856
2023-11-16 08:59:29.195 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 480856
2023-11-16 08:59:29.196  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [?:?] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 480856
2023-11-16 08:59:29.196 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 480856 
2023-11-16 08:59:29.202 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:29.202 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 480856 
2023-11-16 08:59:29.202  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 480856
2023-11-16 08:59:29.202 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 480856 
2023-11-16 08:59:29.202 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 480856 
2023-11-16 08:59:29.202 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.241 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 139ms : for accumulator : {}
2023-11-16 08:59:29.241 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 158312
2023-11-16 08:59:29.244 DEBUG 1 --- [     Thread-342] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 249321 99446 [132552, 132553]
2023-11-16 08:59:29.244 DEBUG 1 --- [     Thread-342] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 30990ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:29.244 DEBUG 1 --- [     Thread-342] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 249321 99446 [132552, 132553]
2023-11-16 08:59:29.254  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 815176
2023-11-16 08:59:29.254  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:29.255  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:29.255  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:29.255  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:29.255  INFO 1 --- [6_103335_815176] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 815176, Took : 4s
2023-11-16 08:59:29.255  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1145806 
2023-11-16 08:59:29.255  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:29.256 DEBUG 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:29.258 DEBUG 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 2ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:29.258 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1145806, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:29.258 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:29.258 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1145806
2023-11-16 08:59:29.259 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868317
2023-11-16 08:59:29.259 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.259 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:29.259 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:29.259 DEBUG 1 --- [     Thread-342] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 249321 99446 [132552, 132553]
2023-11-16 08:59:29.259 DEBUG 1 --- [     Thread-342] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 15ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:29.259 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 249321 and eventId 99446 and userIds [132552, 132553]
2023-11-16 08:59:29.259 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 249321 and eventId : 99446 
2023-11-16 08:59:29.260 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:29.260 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.260 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:29.266 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 2
2023-11-16 08:59:29.266 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [?:?] : [insertEventUserPrefWithCustomer:1100]: Time taken : 6ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:29.266 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [63, with SITE_IDS as(select unnest('{11208,25025,32749,69853,85939,104865,1233762,1233772,1233775,1881386,3614160,3614168,3614169,4727785,4728163,4728572,4810327,4810328,5690442,51494376,52395825,52396211,60450749,62727695,62727979,65889660,69729777,77034028,79123886,79124157,79124684,79124886,79125735,79127271,79127310}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[480856] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:29.266 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 249321 99446
2023-11-16 08:59:29.267 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 249321
2023-11-16 08:59:29.267  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 249321
2023-11-16 08:59:29.267 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:29.267 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [249321] 
2023-11-16 08:59:29.267 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 64ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:29.267 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 480856
2023-11-16 08:59:29.268 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1145806 -- Resulted rows -- [1]
2023-11-16 08:59:29.268 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 7ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:29.268 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1145806 : null : null : 19868317 : Update published
2023-11-16 08:59:29.269 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:29.269 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:29.269  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 249321, isUpdateAlert : true
2023-11-16 08:59:29.269  INFO 1 --- [6_103335_249321] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:29.270 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:29.270  INFO 1 --- [6_103335_249321] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:29.270 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1145806
2023-11-16 08:59:29.270 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 1ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:29.270 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1145806
2023-11-16 08:59:29.270  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1145806
2023-11-16 08:59:29.270  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1145806 
2023-11-16 08:59:29.270 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:29.270 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1145806] 
2023-11-16 08:59:29.270 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"b460498e-c3ec-4bbf-811e-13f958c5a6fb","eventId":19868272,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:29.272  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868272, tenantId : 249321
2023-11-16 08:59:29.272 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"b460498e-c3ec-4bbf-811e-13f958c5a6fb","eventId":19868272,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41772
2023-11-16 08:59:29.272  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:29.272  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [241706, 295239, 298375, 299735, 274135, 295565, 299836, 297419, 15689, 297406, 151899, 298426, 292932, 293693, 229466, 311807, 313555, 313571, 315347, 317190, 317456, 319994, 327090, 330213, 331795, 336029, 336617, 341712, 342317, 346118, 346580, 349645, 351394, 351548, 352410, 353226, 356857, 358461, 360158, 361864, 227639, 252794, 280745, 281741, 283267, 283269, 283271, 283273, 283275, 283279, 283281, 283328, 284030, 284936, 287406, 287749, 287907, 289404, 289465, 290165, 290952, 290989, 291427, 336729, 337047, 338923, 339091, 340905, 346483, 347962, 347966, 349688, 351875, 353202, 357058, 359306, 360790, 361626, 362051, 363467, 363525, 363555, 363890, 364395, 364834, 365157, 365304, 306341, 309309, 311367, 314092, 316103, 318650, 318683, 318709, 323417, 324280, 324438, 325168, 325490, 257287, 268839, 269185, 271098, 277237, 278229, 278384, 278466, 384327, 382419, 390199, 391902, 370396, 374430, 378259, 382388, 382423, 382649, 383656, 392211, 392215, 392217, 392218, 392220, 392223, 392227, 392228, 392230, 392232, 392233, 392236, 392237, 392238, 392307, 392997, 393059, 394690, 394762, 394924, 395015, 503033, 343863, 534961, 420930, 525103, 426680, 525145, 525127, 528383, 425157, 529919, 424082, 525112, 483609, 529549, 525365, 424837, 498885, 525136, 525636, 525118, 424084, 525121, 511314, 527644, 525302, 482396, 279906, 534631, 529069, 421831, 525115, 527825, 398558, 507407, 526415, 425126, 286870, 150401, 398645, 447122, 507130, 422572, 525077, 499189, 499167, 422261, 528500, 535186, 535761, 419898, 422918, 525209, 525203, 506938, 499241, 398158, 398625, 499266, 526596, 527243, 525162, 519744, 535358, 520358, 535910, 525151, 535763, 398725, 398415, 525988, 525091, 531351, 425225, 446335, 686466, 499251, 531858, 525100, 525172, 711954, 447384, 525050, 481184, 686472, 677519, 525236, 526503, 534630, 296584, 483696, 527033, 525082, 526321, 708539, 525284, 481258, 747822, 525305, 525148, 525245, 481482, 484597, 525130, 678539, 700872, 525320, 448291, 727078, 526505, 276439, 525176, 446443, 525194, 525644, 710450, 704265, 445742, 525059, 531886, 686475, 448067, 694753, 686368, 708766, 525212, 526002, 525053, 525071, 526682, 528423, 686463, 746845, 532728, 525218, 258354, 527846, 528995, 447987, 690275, 526589, 762839, 525371, 525308, 711607, 722753, 525179, 446441, 534693, 526300, 775280, 531789, 525106, 520106, 530038, 703455, 525157, 686309, 445938, 448086, 525139, 729102, 681171, 747845, 686470, 525062, 525248, 358630, 305488, 678251, 677591, 821051, 820794, 821244, 820826, 821329, 821961, 47005, 917131, 871308, 747796, 878117, 916416, 903953, 893052, 311817, 709134, 917064, 908740, 855143, 914047, 853391, 839059, 870506, 699790, 528636, 916277, 869643, 914553, 850354, 854869, 910475, 870305, 914327, 515841, 916545, 857476, 424091, 891146, 868205, 895517, 904050, 525233, 902137, 902058, 839293, 747791, 916576, 528902, 861210, 916574, 870448, 916153, 686233, 902135, 676987, 334774, 887073, 900537, 917133, 920450, 353419, 930650, 850407, 869790, 850775, 525951, 868204, 838844, 524342, 839089, 916959, 909603, 915876, 902134, 859312, 916219, 839219, 254543, 525185, 237104, 889940, 398337, 916128, 912798, 253549, 916276, 871587, 930773, 426775, 855662, 893932, 891145, 914356, 481812, 862335, 728859, 871773, 858759, 708675, 909905, 702425, 895064, 912303, 921352, 911857, 699979, 910472, 934606, 856882, 230287, 916156, 525272, 930578, 888107, 322863, 851615, 290697, 912298, 912115, 902136, 858863, 891287, 525142, 871588] 
2023-11-16 08:59:29.272 DEBUG 1 --- [6_103335_249321] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.273 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:29.273 DEBUG 1 --- [_103335_1145806] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:29.273 DEBUG 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1145806 
2023-11-16 08:59:29.273 DEBUG 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1145806 
2023-11-16 08:59:29.273  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:29.273  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:29.273  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:29.273  INFO 1 --- [_103335_1145806] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1145806, Took : 0s
2023-11-16 08:59:29.273  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 957039 
2023-11-16 08:59:29.274  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:29.275 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:29.285 DEBUG 1 --- [6_103335_158312] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 158312
2023-11-16 08:59:29.286  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 158312
2023-11-16 08:59:29.286  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:29.286 DEBUG 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[154273],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [154273]
2023-11-16 08:59:29.287 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[154273],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22838
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_158312] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 158312, Took : 6s
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 952338 
2023-11-16 08:59:29.287  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:29.289 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:29.290 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 15ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:29.291 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.312 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (241706,295239,298375,299735,274135,295565,299836,297419,15689,297406,151899,298426,292932,293693,229466,311807,313555,313571,315347,317190,317456,319994,327090,330213,331795,336029,336617,341712,342317,346118,346580,349645,351394,351548,352410,353226,356857,358461,360158,361864,227639,252794,280745,281741,283267,283269,283271,283273,283275,283279,283281,283328,284030,284936,287406,287749,287907,289404,289465,290165,290952,290989,291427,336729,337047,338923,339091,340905,346483,347962,347966,349688,351875,353202,357058,359306,360790,361626,362051,363467,363525,363555,363890,364395,364834,365157,365304,306341,309309,311367,314092,316103,318650,318683,318709,323417,324280,324438,325168,325490,257287,268839,269185,271098,277237,278229,278384,278466,384327,382419,390199,391902,370396,374430,378259,382388,382423,382649,383656,392211,392215,392217,392218,392220,392223,392227,392228,392230,392232,392233,392236,392237,392238,392307,392997,393059,394690,394762,394924,395015,503033,343863,534961,420930,525103,426680,525145,525127,528383,425157,529919,424082,525112,483609,529549,525365,424837,498885,525136,525636,525118,424084,525121,511314,527644,525302,482396,279906,534631,529069,421831,525115,527825,398558,507407,526415,425126,286870,150401,398645,447122,507130,422572,525077,499189,499167,422261,528500,535186,535761,419898,422918,525209,525203,506938,499241,398158,398625,499266,526596,527243,525162,519744,535358,520358,535910,525151,535763,398725,398415,525988,525091,531351,425225,446335,686466,499251,531858,525100,525172,711954,447384,525050,481184,686472,677519,525236,526503,534630,296584,483696,527033,525082,526321,708539,525284,481258,747822,525305,525148,525245,481482,484597,525130,678539,700872,525320,448291,727078,526505,276439,525176,446443,525194,525644,710450,704265,445742,525059,531886,686475,448067,694753,686368,708766,525212,526002,525053,525071,526682,528423,686463,746845,532728,525218,258354,527846,528995,447987,690275,526589,762839,525371,525308,711607,722753,525179,446441,534693,526300,775280,531789,525106,520106,530038,703455,525157,686309,445938,448086,525139,729102,681171,747845,686470,525062,525248,358630,305488,678251,677591,821051,820794,821244,820826,821329,821961,47005,917131,871308,747796,878117,916416,903953,893052,311817,709134,917064,908740,855143,914047,853391,839059,870506,699790,528636,916277,869643,914553,850354,854869,910475,870305,914327,515841,916545,857476,424091,891146,868205,895517,904050,525233,902137,902058,839293,747791,916576,528902,861210,916574,870448,916153,686233,902135,676987,334774,887073,900537,917133,920450,353419,930650,850407,869790,850775,525951,868204,838844,524342,839089,916959,909603,915876,902134,859312,916219,839219,254543,525185,237104,889940,398337,916128,912798,253549,916276,871587,930773,426775,855662,893932,891145,914356,481812,862335,728859,871773,858759,708675,909905,702425,895064,912303,921352,911857,699979,910472,934606,856882,230287,916156,525272,930578,888107,322863,851615,290697,912298,912115,902136,858863,891287,525142,871588)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:29.313 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 40ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:29.327 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 957039 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 957039), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =957039 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1935975}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 957039 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:29.330 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 39ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:29.330 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 957039 
2023-11-16 08:59:29.330 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.362 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, with SITE_IDS as ( select unnest('{1935975}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 957039 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:29.364 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 957039
2023-11-16 08:59:29.364 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 33ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:29.383 DEBUG 1 --- [6_103335_249321] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.499 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [115, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (241706,295239,298375,299735,274135,295565,299836,297419,15689,297406,151899,298426,292932,293693,229466,311807,313555,313571,315347,317190,317456,319994,327090,330213,331795,336029,336617,341712,342317,346118,346580,349645,351394,351548,352410,353226,356857,358461,360158,361864,227639,252794,280745,281741,283267,283269,283271,283273,283275,283279,283281,283328,284030,284936,287406,287749,287907,289404,289465,290165,290952,290989,291427,336729,337047,338923,339091,340905,346483,347962,347966,349688,351875,353202,357058,359306,360790,361626,362051,363467,363525,363555,363890,364395,364834,365157,365304,306341,309309,311367,314092,316103,318650,318683,318709,323417,324280,324438,325168,325490,257287,268839,269185,271098,277237,278229,278384,278466,384327,382419,390199,391902,370396,374430,378259,382388,382423,382649,383656,392211,392215,392217,392218,392220,392223,392227,392228,392230,392232,392233,392236,392237,392238,392307,392997,393059,394690,394762,394924,395015,503033,343863,534961,420930,525103,426680,525145,525127,528383,425157,529919,424082,525112,483609,529549,525365,424837,498885,525136,525636,525118,424084,525121,511314,527644,525302,482396,279906,534631,529069,421831,525115,527825,398558,507407,526415,425126,286870,150401,398645,447122,507130,422572,525077,499189,499167,422261,528500,535186,535761,419898,422918,525209,525203,506938,499241,398158,398625,499266,526596,527243,525162,519744,535358,520358,535910,525151,535763,398725,398415,525988,525091,531351,425225,446335,686466,499251,531858,525100,525172,711954,447384,525050,481184,686472,677519,525236,526503,534630,296584,483696,527033,525082,526321,708539,525284,481258,747822,525305,525148,525245,481482,484597,525130,678539,700872,525320,448291,727078,526505,276439,525176,446443,525194,525644,710450,704265,445742,525059,531886,686475,448067,694753,686368,708766,525212,526002,525053,525071,526682,528423,686463,746845,532728,525218,258354,527846,528995,447987,690275,526589,762839,525371,525308,711607,722753,525179,446441,534693,526300,775280,531789,525106,520106,530038,703455,525157,686309,445938,448086,525139,729102,681171,747845,686470,525062,525248,358630,305488,678251,677591,821051,820794,821244,820826,821329,821961,47005,917131,871308,747796,878117,916416,903953,893052,311817,709134,917064,908740,855143,914047,853391,839059,870506,699790,528636,916277,869643,914553,850354,854869,910475,870305,914327,515841,916545,857476,424091,891146,868205,895517,904050,525233,902137,902058,839293,747791,916576,528902,861210,916574,870448,916153,686233,902135,676987,334774,887073,900537,917133,920450,353419,930650,850407,869790,850775,525951,868204,838844,524342,839089,916959,909603,915876,902134,859312,916219,839219,254543,525185,237104,889940,398337,916128,912798,253549,916276,871587,930773,426775,855662,893932,891145,914356,481812,862335,728859,871773,858759,708675,909905,702425,895064,912303,921352,911857,699979,910472,934606,856882,230287,916156,525272,930578,888107,322863,851615,290697,912298,912115,902136,858863,891287,525142,871588)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:29.499 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 116ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:29.503 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_249321
2023-11-16 08:59:29.503 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_249321
2023-11-16 08:59:29.506 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_249321
2023-11-16 08:59:29.506 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_249321
2023-11-16 08:59:29.511 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:29.552 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 957039, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868318 and EventDetID : 99446 
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 957039
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868318
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868318 and Event_Details ID : 99446 
2023-11-16 08:59:29.553 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:29.554 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.554 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_480856
2023-11-16 08:59:29.554 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_480856
2023-11-16 08:59:29.554 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:29.554 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.560 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 957039 -- Resulted rows -- [1]
2023-11-16 08:59:29.561 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 6ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:29.561 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 957039 : false : false : 19868318 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:29.562 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 957039
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 1ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 957039
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 957039
2023-11-16 08:59:29.563  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 957039
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 957039 
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 957039 
2023-11-16 08:59:29.563 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.587 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with SITEID as( select * from ( select unnest(array[25025,11208,79124157,79125735,79127271,4810328,65889660,62727979,69729777,79123886,69853,5690442,4810327,104865,4727785,79124886,3614160,60450749,4728163,52396211,32749,3614169,52395825,3614168,1233762,85939,62727695,4728572,1881386,51494376,79127310,77034028,79124684,1233775,1233772]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:29.587 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 32ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:29.591 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_480856
2023-11-16 08:59:29.591 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 36ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_480856
2023-11-16 08:59:29.595 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (957039,203537) and event_details_id = 99446] 
2023-11-16 08:59:29.599 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_957039
2023-11-16 08:59:29.599 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 957039
2023-11-16 08:59:29.599 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 35ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:29.599  INFO 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [957039]
2023-11-16 08:59:29.600  INFO 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [957039]
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 957039 
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 957039 
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_480856
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:29.600 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 480856 
2023-11-16 08:59:29.601  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 480856
2023-11-16 08:59:29.627 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 1423ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:29.627 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.640 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 957039 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1935975)] 
2023-11-16 08:59:29.642 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 957039
2023-11-16 08:59:29.642 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 42ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:29.652 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1053500 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1053500), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1053500 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1677,29048,30144,37163,43610,46065,46086,49301,50521,50580,55741,300111,300113,300114,322697,322705,366560,428271,443659,532614,533762,534974,534975,536498,536515,536856,538237,654800,720815,721088,722040,723410,731078,732853,977159,1189136,1657144,1657571,1657954,1658551,1937757,2001267,2020370,2020604,2020655,2348890,2348891}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1053500 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:29.653 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 26ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:29.653 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1053500 
2023-11-16 08:59:29.654 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.674 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 385ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:29.675 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.680 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, with SITE_IDS as ( select unnest('{1677,29048,30144,37163,43610,46065,46086,49301,50521,50580,55741,300111,300113,300114,322697,322705,366560,428271,443659,532614,533762,534974,534975,536498,536515,536856,538237,654800,720815,721088,722040,723410,731078,732853,977159,1189136,1657144,1657571,1657954,1658551,1937757,2001267,2020370,2020604,2020655,2348890,2348891}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1053500 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:29.682 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1053500
2023-11-16 08:59:29.682 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 28ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:29.687 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 480856 
2023-11-16 08:59:29.692 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:29.692 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 480856 
2023-11-16 08:59:29.694 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.701 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 480856
2023-11-16 08:59:29.726 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 952338 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 952338), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =952338 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{736254}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 952338 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:29.728 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 53ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:29.728 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 952338 
2023-11-16 08:59:29.728 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.749 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [54, WITH SITE_IDS AS( SELECT UNNEST('{1935975}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[957039] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 957039 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:29.749 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 55ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:29.749 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 957039 
2023-11-16 08:59:29.764 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, with SITE_IDS as ( select unnest('{736254}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 952338 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:29.766 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 952338
2023-11-16 08:59:29.766 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 37ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:29.851 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1053500, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:29.851 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868319 and EventDetID : 99446 
2023-11-16 08:59:29.851 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1053500
2023-11-16 08:59:29.851 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868319
2023-11-16 08:59:29.851 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.852 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868319 and Event_Details ID : 99446 
2023-11-16 08:59:29.852 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:29.852 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.852 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:29.859 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1053500 -- Resulted rows -- [1]
2023-11-16 08:59:29.859 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 6ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:29.859 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1053500 : false : false : 19868319 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:29.863 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 957039
2023-11-16 08:59:29.863 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 113ms : for accumlator : {}
2023-11-16 08:59:29.863 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 957039 
2023-11-16 08:59:29.864 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:29.864 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 5ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:29.864 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1053500
2023-11-16 08:59:29.865 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1053500
2023-11-16 08:59:29.865  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1053500
2023-11-16 08:59:29.865 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1053500 
2023-11-16 08:59:29.865 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1053500 
2023-11-16 08:59:29.865 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.867 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_957039
2023-11-16 08:59:29.867 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_957039
2023-11-16 08:59:29.867 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.896 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1053500,742,3248,1375,7837,292,1449,1788,11669,327,2177,273,293,1572,111,150001,90,22682,592,2281,270,1573,1388,1166,324,2156,102,4473,11464,144203,11765,1369,1385,10202,1404,832,3807,6437,156946,983495) and event_details_id = 99446] 
2023-11-16 08:59:29.899 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1053500
2023-11-16 08:59:29.899 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1053500
2023-11-16 08:59:29.900 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 34ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:29.900  INFO 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1053500]
2023-11-16 08:59:29.901  INFO 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1053500]
2023-11-16 08:59:29.901 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1053500 
2023-11-16 08:59:29.901 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1053500 
2023-11-16 08:59:29.901 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.914 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 957039 and total_cpns != '{}' and site_private_id = any('{60362740}')] 
2023-11-16 08:59:29.918 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_957039
2023-11-16 08:59:29.918 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 50ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:29.918 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.940 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1053500 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1677,29048,30144,37163,43610,46065,46086,49301,50521,50580,55741,300111,300113,300114,322697,322705,366560,428271,443659,532614,533762,534974,534975,536498,536515,536856,538237,654800,720815,721088,722040,723410,731078,732853,977159,1189136,1657144,1657571,1657954,1658551,1937757,2001267,2020370,2020604,2020655,2348890,2348891)] 
2023-11-16 08:59:29.942 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1053500
2023-11-16 08:59:29.942 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 41ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:29.959 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 952338, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:29.960 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868320 and EventDetID : 99446 
2023-11-16 08:59:29.960 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 952338
2023-11-16 08:59:29.960 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868320
2023-11-16 08:59:29.960 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.961 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868320 and Event_Details ID : 99446 
2023-11-16 08:59:29.961 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:29.961 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:29.961 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:29.961 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, with SITEID as( select * from ( select unnest(array[60362740]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:29.962 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 43ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:29.966 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_957039
2023-11-16 08:59:29.966 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 48ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_957039
2023-11-16 08:59:29.977 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 952338 -- Resulted rows -- [1]
2023-11-16 08:59:29.977 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 15ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:29.977 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 952338 : false : false : 19868320 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:29.978 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_957039
2023-11-16 08:59:29.978 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 11ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:29.978 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 957039
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 952338
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 4ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 952338
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 952338
2023-11-16 08:59:29.981  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 952338
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 952338 
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 952338 
2023-11-16 08:59:29.981 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.986 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 957039 
2023-11-16 08:59:29.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 957039 
2023-11-16 08:59:29.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 957039 
2023-11-16 08:59:29.987 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:29.994 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.014 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (952338,1369) and event_details_id = 99446] 
2023-11-16 08:59:30.019 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_952338
2023-11-16 08:59:30.019 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 952338
2023-11-16 08:59:30.019 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 37ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:30.019  INFO 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [952338]
2023-11-16 08:59:30.019  INFO 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [952338]
2023-11-16 08:59:30.020 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 952338 
2023-11-16 08:59:30.020 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 952338 
2023-11-16 08:59:30.020 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.028 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868318 and tenant_id = 957039] 
2023-11-16 08:59:30.028 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 41ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:30.041 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, WITH SITE_IDS AS( SELECT UNNEST('{1677,1677,1677,1677,1677,1677,29048,29048,29048,29048,29048,29048,30144,30144,30144,30144,30144,30144,30144,30144,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,37163,43610,43610,46065,46065,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,49301,49301,49301,49301,49301,49301,49301,50521,50521,50580,50580,55741,55741,55741,55741,55741,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300111,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300113,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,300114,322697,322697,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,322705,366560,366560,366560,366560,366560,366560,366560,366560,428271,428271,428271,428271,428271,428271,443659,443659,443659,443659,532614,532614,532614,533762,534974,534974,534974,534974,534974,534974,534975,534975,534975,534975,534975,534975,536498,536498,536498,536498,536515,536515,536515,536856,536856,538237,538237,538237,538237,538237,538237,654800,654800,654800,654800,654800,654800,654800,654800,654800,654800,654800,654800,720815,720815,720815,720815,720815,720815,720815,720815,720815,720815,720815,720815,720815,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,721088,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,722040,723410,723410,723410,723410,731078,731078,732853,732853,732853,732853,732853,732853,977159,1189136,1189136,1657144,1657144,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657571,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1657954,1658551,1658551,1658551,1658551,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,1937757,2001267,2001267,2001267,2001267,2001267,2001267,2020370,2020370,2020370,2020370,2020604,2020604,2020604,2020604,2020655,2020655,2020655,2020655,2020655,2020655,2020655,2020655,2020655,2348890,2348890,2348891,2348891}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1053500] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1053500 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:30.041 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 47ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:30.042 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1053500 
2023-11-16 08:59:30.049 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 952338 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (736254)] 
2023-11-16 08:59:30.051 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 952338
2023-11-16 08:59:30.051 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 30ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:30.060  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 249321
2023-11-16 08:59:30.060 DEBUG 1 --- [6_103335_249321] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.082 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_957039
2023-11-16 08:59:30.082 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_957039
2023-11-16 08:59:30.092 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (241706,295239,298375,299735,274135,295565,299836,297419,15689,297406,151899,298426,292932,293693,229466,311807,313555,313571,315347,317190,317456,319994,327090,330213,331795,336029,336617,341712,342317,346118,346580,349645,351394,351548,352410,353226,356857,358461,360158,361864,227639,252794,280745,281741,283267,283269,283271,283273,283275,283279,283281,283328,284030,284936,287406,287749,287907,289404,289465,290165,290952,290989,291427,336729,337047,338923,339091,340905,346483,347962,347966,349688,351875,353202,357058,359306,360790,361626,362051,363467,363525,363555,363890,364395,364834,365157,365304,306341,309309,311367,314092,316103,318650,318683,318709,323417,324280,324438,325168,325490,257287,268839,269185,271098,277237,278229,278384,278466,384327,382419,390199,391902,370396,374430,378259,382388,382423,382649,383656,392211,392215,392217,392218,392220,392223,392227,392228,392230,392232,392233,392236,392237,392238,392307,392997,393059,394690,394762,394924,395015,503033,343863,534961,420930,525103,426680,525145,525127,528383,425157,529919,424082,525112,483609,529549,525365,424837,498885,525136,525636,525118,424084,525121,511314,527644,525302,482396,279906,534631,529069,421831,525115,527825,398558,507407,526415,425126,286870,150401,398645,447122,507130,422572,525077,499189,499167,422261,528500,535186,535761,419898,422918,525209,525203,506938,499241,398158,398625,499266,526596,527243,525162,519744,535358,520358,535910,525151,535763,398725,398415,525988,525091,531351,425225,446335,686466,499251,531858,525100,525172,711954,447384,525050,481184,686472,677519,525236,526503,534630,296584,483696,527033,525082,526321,708539,525284,481258,747822,525305,525148,525245,481482,484597,525130,678539,700872,525320,448291,727078,526505,276439,525176,446443,525194,525644,710450,704265,445742,525059,531886,686475,448067,694753,686368,708766,525212,526002,525053,525071,526682,528423,686463,746845,532728,525218,258354,527846,528995,447987,690275,526589,762839,525371,525308,711607,722753,525179,446441,534693,526300,775280,531789,525106,520106,530038,703455,525157,686309,445938,448086,525139,729102,681171,747845,686470,525062,525248,358630,305488,678251,677591,821051,820794,821244,820826,821329,821961,47005,917131,871308,747796,878117,916416,903953,893052,311817,709134,917064,908740,855143,914047,853391,839059,870506,699790,528636,916277,869643,914553,850354,854869,910475,870305,914327,515841,916545,857476,424091,891146,868205,895517,904050,525233,902137,902058,839293,747791,916576,528902,861210,916574,870448,916153,686233,902135,676987,334774,887073,900537,917133,920450,353419,930650,850407,869790,850775,525951,868204,838844,524342,839089,916959,909603,915876,902134,859312,916219,839219,254543,525185,237104,889940,398337,916128,912798,253549,916276,871587,930773,426775,855662,893932,891145,914356,481812,862335,728859,871773,858759,708675,909905,702425,895064,912303,921352,911857,699979,910472,934606,856882,230287,916156,525272,930578,888107,322863,851615,290697,912298,912115,902136,858863,891287,525142,871588) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:30.093 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_957039
2023-11-16 08:59:30.093 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:30.095 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_249321
2023-11-16 08:59:30.096 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 35ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:30.098 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:30.102 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:30.103 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 957039 
2023-11-16 08:59:30.108 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.141 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 480856
2023-11-16 08:59:30.142  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 480856
2023-11-16 08:59:30.142 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 480856 
2023-11-16 08:59:30.142 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.181 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 480856 and es.event_id = 19868316 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:30.182 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 39ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:30.187 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_480856
2023-11-16 08:59:30.187 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 4ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_480856
2023-11-16 08:59:30.188 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [80, WITH SITE_IDS AS( SELECT UNNEST('{736254}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[952338] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 952338 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:30.189 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 81ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:30.189 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 952338 
2023-11-16 08:59:30.191 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:30.191 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 480856 
2023-11-16 08:59:30.192 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1053500
2023-11-16 08:59:30.192 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 150ms : for accumlator : {}
2023-11-16 08:59:30.192 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1053500 
2023-11-16 08:59:30.197 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1053500
2023-11-16 08:59:30.197 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 5ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1053500
2023-11-16 08:59:30.197 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.237 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1053500 and total_cpns != '{}' and site_private_id = any('{70871101,70871247,70871688,70872102,70872624,70873115,70873420,70873421,70873422,70874678,70875385,70875798,70876817,70876818,70876819,70876873,70877667,70877698,70879187,70879424,70879425,70879426,70879427,70880264,70880467,70880610,70880803,70881244,70881819,70881915,70883471,70883556,70883840,70883911,70885429,70885480,70886699,70886700,70886833,70886893,70887349,70887668,70887834,70888693,70889991,70890617,70890618}')] 
2023-11-16 08:59:30.241 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1053500
2023-11-16 08:59:30.241 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 43ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:30.241 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.251  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 480856
2023-11-16 08:59:30.251 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 480856 
2023-11-16 08:59:30.255 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 480856 
2023-11-16 08:59:30.255  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): false, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:30.255 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 480856 
2023-11-16 08:59:30.255 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 480856
2023-11-16 08:59:30.272 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, with SITEID as( select * from ( select unnest(array[70875385,70890617,70881915,70890618,70871101,70886833,70872624,70885429,70887349,70888693,70887668,70874678,70885480,70886699,70886893,70886700,70877667,70880803,70880610,70883556,70872102,70873115,70881819,70887834,70881244,70876817,70876819,70879187,70880467,70876818,70875798,70876873,70871688,70880264,70873421,70873420,70871247,70883471,70873422,70879425,70879424,70883840,70879427,70877698,70879426,70883911,70889991]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:30.272 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 31ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:30.277 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1053500
2023-11-16 08:59:30.278 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 36ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1053500
2023-11-16 08:59:30.292 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1053500
2023-11-16 08:59:30.292 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 14ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:30.292 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1053500
2023-11-16 08:59:30.300 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1053500 
2023-11-16 08:59:30.300 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1053500 
2023-11-16 08:59:30.300 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1053500 
2023-11-16 08:59:30.300 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.363 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [62, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868319 and tenant_id = 1053500] 
2023-11-16 08:59:30.363 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 63ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:30.439 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1053500
2023-11-16 08:59:30.440 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 5ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1053500
2023-11-16 08:59:30.451 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1053500
2023-11-16 08:59:30.451 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:30.452 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 952338
2023-11-16 08:59:30.453 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 263ms : for accumlator : {}
2023-11-16 08:59:30.453 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 952338 
2023-11-16 08:59:30.457 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_952338
2023-11-16 08:59:30.457 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_952338
2023-11-16 08:59:30.457 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.461 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 10ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:30.463 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1053500 
2023-11-16 08:59:30.498 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 952338 and total_cpns != '{}' and site_private_id = any('{88232108}')] 
2023-11-16 08:59:30.503 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_952338
2023-11-16 08:59:30.504 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 46ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:30.504 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.541 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with SITEID as( select * from ( select unnest(array[88232108]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:30.542 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 37ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:30.546 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_952338
2023-11-16 08:59:30.546 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 42ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_952338
2023-11-16 08:59:30.561 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_952338
2023-11-16 08:59:30.561 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 14ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:30.561 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 952338
2023-11-16 08:59:30.570 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 952338 
2023-11-16 08:59:30.570 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 952338 
2023-11-16 08:59:30.570 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 952338 
2023-11-16 08:59:30.570 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.619 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868320 and tenant_id = 952338] 
2023-11-16 08:59:30.619 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 49ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:30.797 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 957039
2023-11-16 08:59:30.833 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_952338
2023-11-16 08:59:30.834 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 5ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_952338
2023-11-16 08:59:30.856 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_952338
2023-11-16 08:59:30.857 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 22ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:30.871 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 14ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:30.873 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [?:?] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 952338 
2023-11-16 08:59:30.959 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 564ms : for accumulator : {}
2023-11-16 08:59:30.959 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 249321
2023-11-16 08:59:30.980 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 957039
2023-11-16 08:59:30.982  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 957039
2023-11-16 08:59:30.982 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 957039 
2023-11-16 08:59:30.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:30.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 957039 
2023-11-16 08:59:30.987  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 957039
2023-11-16 08:59:30.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 957039 
2023-11-16 08:59:30.987 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 957039 
2023-11-16 08:59:30.987 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:30.992 DEBUG 1 --- [6_103335_249321] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 249321
2023-11-16 08:59:30.994  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 249321
2023-11-16 08:59:30.994  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:30.995 DEBUG 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[15689,481812,237104],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [15689, 481812, 237104]
2023-11-16 08:59:30.996 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[15689,481812,237104],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22839
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_249321] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 249321, Took : 48s
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 201461 
2023-11-16 08:59:30.996  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:30.998 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:31.039 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with SITE_IDS as(select unnest('{60362829}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[957039] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:31.040 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 52ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:31.040 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 957039
2023-11-16 08:59:31.328 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 329ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:31.328 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.354 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[175076, 242288, 242599, 175047, 175160, 269529, 201295, 174939, 241763, 219888, 267762, 284181, 175068, 224514, 175101, 168974, 177660, 254152, 175169, 177680, 177693, 219865, 284175, 168977, 168951, 175163, 257136, 175139, 240743, 177659, 177708, 301011, 175023, 174968, 175129, 174434, 174972, 177657, 240747, 181435, 219856, 219882, 174453, 219880, 175094, 246053, 174955, 177676, 295098, 257142, 175183, 173449, 268046, 253511, 254265, 174439, 177694, 248526, 168981, 175072, 175065, 173468, 174444, 254260, 135732, 242289, 177691, 175166, 240296, 268012, 175043, 175164, 235225, 175161, 219929, 175046, 243469, 174457, 241764, 253060, 174931, 251933, 177956, 219921, 177704, 252636, 268016, 278151, 174438, 177670, 284180, 168979, 219884, 252642, 244334, 177668, 169005, 177701, 174925, 175027, 175189, 219877, 234005, 278028, 174944, 193918, 267778, 174919, 174942, 205405, 249285, 219917, 238847, 219913, 175045, 174985, 175028, 278025, 240126, 187910, 240121, 174454, 249286, 267768, 175005, 175102, 175136, 302296, 174967, 175024, 252634, 219928, 219863, 174929, 242601, 219862, 233530, 175191, 169002, 177682, 300991, 219941, 241263, 174460, 253061, 242290, 177688, 174966, 241765, 175186, 219875, 175044, 284303, 278027, 175074, 204898, 175051, 252631, 257134, 301012, 219861, 234011, 219916, 254261, 249440, 268069, 168975, 175088, 175106, 284182, 238493, 242291, 175152, 241262, 174433, 175182, 234008, 239239, 168958, 251934, 276263, 175098, 177690, 213112, 276269, 241261, 219857, 242027, 219922, 249759, 240703, 166261, 284808, 174432, 219883, 175126, 175193, 174980, 175135, 175151, 242595, 219879, 175145, 219823, 240298, 173469, 254257, 175000, 249287, 175194, 168980, 219874, 252633, 168272, 177685, 234010, 244144, 175054, 175090, 177695, 280624, 301010, 168948, 219868, 240123, 239488, 240704, 242294, 168976, 216635, 181422, 238491, 219871, 177665, 219876, 173450, 252632, 174934, 252638, 175073, 277578, 174956, 175119, 204143, 175033, 174946, 174458, 242596, 257523, 177697, 252639, 174978, 302222, 192779, 175002, 219870, 235552, 180167, 219855, 177672, 285925, 177667, 248658, 196616, 219878, 175021, 219881, 252508, 219866, 253058, 177700, 257526, 174970, 175050, 123736, 168956, 219925, 241266, 168945, 169001, 277975, 240297, 219858, 242287, 242283, 249758, 174910, 161991, 257146, 234009, 219920, 174906, 253509, 253838, 175017, 268037, 205403, 234004, 174953, 174974, 235272, 168982, 249291, 219912, 175022, 175095, 235578, 174437, 204437, 175081, 240702, 256749, 175058, 175146, 219919, 173463, 174431, 219872, 175422, 173471, 175003, 177698, 219869, 177677, 249754, 268049, 219927, 234006, 175185, 173462, 174464, 225015, 175016, 199654, 168949, 242293, 242382, 284184, 242924, 175181, 252186, 177696, 196931, 197107, 231725, 233529, 205404, 239493]
2023-11-16 08:59:31.355 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 1099ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:31.355 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 348 for customer 480856
2023-11-16 08:59:31.355 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[175076, 242288, 242599, 175047, 175160, 269529, 201295, 174939, 241763, 219888, 267762, 284181, 175068, 224514, 175101, 168974, 177660, 254152, 175169, 177680, 177693, 219865, 284175, 168977, 168951, 175163, 257136, 175139, 240743, 177659, 177708, 301011, 175023, 174968, 175129, 174434, 174972, 177657, 240747, 181435, 219856, 219882, 174453, 219880, 175094, 246053, 174955, 177676, 295098, 257142, 175183, 173449, 268046, 253511, 254265, 174439, 177694, 248526, 168981, 175072, 175065, 173468, 174444, 254260, 135732, 242289, 177691, 175166, 240296, 268012, 175043, 175164, 235225, 175161, 219929, 175046, 243469, 174457, 241764, 253060, 174931, 251933, 177956, 219921, 177704, 252636, 268016, 278151, 174438, 177670, 284180, 168979, 219884, 252642, 244334, 177668, 169005, 177701, 174925, 175027, 175189, 219877, 234005, 278028, 174944, 193918, 267778, 174919, 174942, 205405, 249285, 219917, 238847, 219913, 175045, 174985, 175028, 278025, 240126, 187910, 240121, 174454, 249286, 267768, 175005, 175102, 175136, 302296, 174967, 175024, 252634, 219928, 219863, 174929, 242601, 219862, 233530, 175191, 169002, 177682, 300991, 219941, 241263, 174460, 253061, 242290, 177688, 174966, 241765, 175186, 219875, 175044, 284303, 278027, 175074, 204898, 175051, 252631, 257134, 301012, 219861, 234011, 219916, 254261, 249440, 268069, 168975, 175088, 175106, 284182, 238493, 242291, 175152, 241262, 174433, 175182, 234008, 239239, 168958, 251934, 276263, 175098, 177690, 213112, 276269, 241261, 219857, 242027, 219922, 249759, 240703, 166261, 284808, 174432, 219883, 175126, 175193, 174980, 175135, 175151, 242595, 219879, 175145, 219823, 240298, 173469, 254257, 175000, 249287, 175194, 168980, 219874, 252633, 168272, 177685, 234010, 244144, 175054, 175090, 177695, 280624, 301010, 168948, 219868, 240123, 239488, 240704, 242294, 168976, 216635, 181422, 238491, 219871, 177665, 219876, 173450, 252632, 174934, 252638, 175073, 277578, 174956, 175119, 204143, 175033, 174946, 174458, 242596, 257523, 177697, 252639, 174978, 302222, 192779, 175002, 219870, 235552, 180167, 219855, 177672, 285925, 177667, 248658, 196616, 219878, 175021, 219881, 252508, 219866, 253058, 177700, 257526, 174970, 175050, 123736, 168956, 219925, 241266, 168945, 169001, 277975, 240297, 219858, 242287, 242283, 249758, 174910, 161991, 257146, 234009, 219920, 174906, 253509, 253838, 175017, 268037, 205403, 234004, 174953, 174974, 235272, 168982, 249291, 219912, 175022, 175095, 235578, 174437, 204437, 175081, 240702, 256749, 175058, 175146, 219919, 173463, 174431, 219872, 175422, 173471, 175003, 177698, 219869, 177677, 249754, 268049, 219927, 234006, 175185, 173462, 174464, 225015, 175016, 199654, 168949, 242293, 242382, 284184, 242924, 175181, 252186, 177696, 196931, 197107, 231725, 233529, 205404, 239493]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}480856
2023-11-16 08:59:31.376 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 201461 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 201461), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =201461 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 201461 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:31.378 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 49ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:31.378 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 201461 
2023-11-16 08:59:31.378 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.422 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, with SITE_IDS as ( select unnest('{293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 201461 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:31.424 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 201461
2023-11-16 08:59:31.424 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 45ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:31.460 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:31.467 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[175076, 242288, 242599, 175047, 175160, 269529, 201295, 174939, 241763, 219888, 267762, 284181, 175068, 224514, 175101, 168974, 177660, 254152, 175169, 177680, 177693, 219865, 284175, 168977, 168951, 175163, 257136, 175139, 240743, 177659, 177708, 301011, 175023, 174968, 175129, 174434, 174972, 177657, 240747, 181435, 219856, 219882, 174453, 219880, 175094, 246053, 174955, 177676, 295098, 257142, 175183, 173449, 268046, 253511, 254265, 174439, 177694, 248526, 168981, 175072, 175065, 173468, 174444, 254260, 135732, 242289, 177691, 175166, 240296, 268012, 175043, 175164, 235225, 175161, 219929, 175046, 243469, 174457, 241764, 253060, 174931, 251933, 177956, 219921, 177704, 252636, 268016, 278151, 174438, 177670, 284180, 168979, 219884, 252642, 244334, 177668, 169005, 177701, 174925, 175027, 175189, 219877, 234005, 278028, 174944, 193918, 267778, 174919, 174942, 205405, 249285, 219917, 238847, 219913, 175045, 174985, 175028, 278025, 240126, 187910, 240121, 174454, 249286, 267768, 175005, 175102, 175136, 302296, 174967, 175024, 252634, 219928, 219863, 174929, 242601, 219862, 233530, 175191, 169002, 177682, 300991, 219941, 241263, 174460, 253061, 242290, 177688, 174966, 241765, 175186, 219875, 175044, 284303, 278027, 175074, 204898, 175051, 252631, 257134, 301012, 219861, 234011, 219916, 254261, 249440, 268069, 168975, 175088, 175106, 284182, 238493, 242291, 175152, 241262, 174433, 175182, 234008, 239239, 168958, 251934, 276263, 175098, 177690, 213112, 276269, 241261, 219857, 242027, 219922, 249759, 240703, 166261, 284808, 174432, 219883, 175126, 175193, 174980, 175135, 175151, 242595, 219879, 175145, 219823, 240298, 173469, 254257, 175000, 249287, 175194, 168980, 219874, 252633, 168272, 177685, 234010, 244144, 175054, 175090, 177695, 280624, 301010, 168948, 219868, 240123, 239488, 240704, 242294, 168976, 216635, 181422, 238491, 219871, 177665, 219876, 173450, 252632, 174934, 252638, 175073, 277578, 174956, 175119, 204143, 175033, 174946, 174458, 242596, 257523, 177697, 252639, 174978, 302222, 192779, 175002, 219870, 235552, 180167, 219855, 177672, 285925, 177667, 248658, 196616, 219878, 175021, 219881, 252508, 219866, 253058, 177700, 257526, 174970, 175050, 123736, 168956, 219925, 241266, 168945, 169001, 277975, 240297, 219858, 242287, 242283, 249758, 174910, 161991, 257146, 234009, 219920, 174906, 253509, 253838, 175017, 268037, 205403, 234004, 174953, 174974, 235272, 168982, 249291, 219912, 175022, 175095, 235578, 174437, 204437, 175081, 240702, 256749, 175058, 175146, 219919, 173463, 174431, 219872, 175422, 173471, 175003, 177698, 219869, 177677, 249754, 268049, 219927, 234006, 175185, 173462, 174464, 225015, 175016, 199654, 168949, 242293, 242382, 284184, 242924, 175181, 252186, 177696, 196931, 197107, 231725, 233529, 205404, 239493]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}480856
2023-11-16 08:59:31.467 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 112ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:31.467 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 480856 99446 user with No pref [175076, 242288, 242599, 175047, 175160, 269529, 201295, 174939, 241763, 219888, 267762, 284181, 175068, 224514, 175101, 168974, 177660, 254152, 175169, 177680, 177693, 219865, 284175, 168977, 168951, 175163, 257136, 175139, 240743, 177659, 177708, 301011, 175023, 174968, 175129, 174434, 174972, 177657, 240747, 181435, 219856, 219882, 174453, 219880, 175094, 246053, 174955, 177676, 295098, 257142, 175183, 173449, 268046, 253511, 254265, 174439, 177694, 248526, 168981, 175072, 175065, 173468, 174444, 254260, 135732, 242289, 177691, 175166, 240296, 268012, 175043, 175164, 235225, 175161, 219929, 175046, 243469, 174457, 241764, 253060, 174931, 251933, 177956, 219921, 177704, 252636, 268016, 278151, 174438, 177670, 284180, 168979, 219884, 252642, 244334, 177668, 169005, 177701, 174925, 175027, 175189, 219877, 234005, 278028, 174944, 193918, 267778, 174919, 174942, 205405, 249285, 219917, 238847, 219913, 175045, 174985, 175028, 278025, 240126, 187910, 240121, 174454, 249286, 267768, 175005, 175102, 175136, 302296, 174967, 175024, 252634, 219928, 219863, 174929, 242601, 219862, 233530, 175191, 169002, 177682, 300991, 219941, 241263, 174460, 253061, 242290, 177688, 174966, 241765, 175186, 219875, 175044, 284303, 278027, 175074, 204898, 175051, 252631, 257134, 301012, 219861, 234011, 219916, 254261, 249440, 268069, 168975, 175088, 175106, 284182, 238493, 242291, 175152, 241262, 174433, 175182, 234008, 239239, 168958, 251934, 276263, 175098, 177690, 213112, 276269, 241261, 219857, 242027, 219922, 249759, 240703, 166261, 284808, 174432, 219883, 175126, 175193, 174980, 175135, 175151, 242595, 219879, 175145, 219823, 240298, 173469, 254257, 175000, 249287, 175194, 168980, 219874, 252633, 168272, 177685, 234010, 244144, 175054, 175090, 177695, 280624, 301010, 168948, 219868, 240123, 239488, 240704, 242294, 168976, 216635, 181422, 238491, 219871, 177665, 219876, 173450, 252632, 174934, 252638, 175073, 277578, 174956, 175119, 204143, 175033, 174946, 174458, 242596, 257523, 177697, 252639, 174978, 302222, 192779, 175002, 219870, 235552, 180167, 219855, 177672, 285925, 177667, 248658, 196616, 219878, 175021, 219881, 252508, 219866, 253058, 177700, 257526, 174970, 175050, 123736, 168956, 219925, 241266, 168945, 169001, 277975, 240297, 219858, 242287, 242283, 249758, 174910, 161991, 257146, 234009, 219920, 174906, 253509, 253838, 175017, 268037, 205403, 234004, 174953, 174974, 235272, 168982, 249291, 219912, 175022, 175095, 235578, 174437, 204437, 175081, 240702, 256749, 175058, 175146, 219919, 173463, 174431, 219872, 175422, 173471, 175003, 177698, 219869, 177677, 249754, 268049, 219927, 234006, 175185, 173462, 174464, 225015, 175016, 199654, 168949, 242293, 242382, 284184, 242924, 175181, 252186, 177696, 196931, 197107, 231725, 233529, 205404, 239493]
2023-11-16 08:59:31.471 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 3ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:31.471 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 480856 99446 [161990, 168954, 168994, 168995, 169000, 173453, 173456, 173464, 174440, 174945, 174954, 174971, 174981, 174997, 175004, 175019, 175052, 175053, 175055, 175059, 175067, 175069, 175070, 175093, 175100, 175104, 175109, 175128, 175133, 175158, 175170, 175175, 175176, 175195, 175307, 175308, 177702, 191972, 192448, 193916, 201286, 205401, 213188, 213409, 219820, 219864, 219867, 219885, 219887, 219915, 235274, 235308, 238848, 239492, 240120, 240127, 240751, 241265, 242025, 242286, 242597, 246514, 248716, 249288, 250013, 253197, 253463, 253510, 253844, 254247, 254259, 256019, 257138, 257145, 257984, 258982, 268053, 275730, 276268, 277379, 277974, 280561, 284178, 284280]
2023-11-16 08:59:31.471 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  480856 99446 
2023-11-16 08:59:31.471 DEBUG 1 --- [     Thread-377] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 480856 99446 [161990, 168954, 168994, 168995, 169000, 173453, 173456, 173464, 174440, 174945, 174954, 174971, 174981, 174997, 175004, 175019, 175052, 175053, 175055, 175059, 175067, 175069, 175070, 175093, 175100, 175104, 175109, 175128, 175133, 175158, 175170, 175175, 175176, 175195, 175307, 175308, 177702, 191972, 192448, 193916, 201286, 205401, 213188, 213409, 219820, 219864, 219867, 219885, 219887, 219915, 235274, 235308, 238848, 239492, 240120, 240127, 240751, 241265, 242025, 242286, 242597, 246514, 248716, 249288, 250013, 253197, 253463, 253510, 253844, 254247, 254259, 256019, 257138, 257145, 257984, 258982, 268053, 275730, 276268, 277379, 277974, 280561, 284178, 284280]
2023-11-16 08:59:31.475 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  480856 99446 
2023-11-16 08:59:31.475 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:31.475 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 480856 99446 [175104, 174981, 175109, 239492, 277379, 219915, 235274, 253197, 173453, 248716, 256019, 268053, 173456, 253463, 275730, 284178, 174997, 253844, 173464, 175128, 175004, 250013, 175133, 168995, 177702, 258982, 242597, 276268, 175019, 219820, 235308, 254259, 175158, 175170, 192448, 257984, 161990, 175175, 201286, 253510, 213188, 175307, 175176, 249288, 175055, 175052, 175308, 175053, 175059, 277974, 219867, 175067, 175195, 205401, 219864, 175070, 175069, 174945, 191972, 174954, 174440, 242025, 219887, 240751, 242286, 219885, 257138, 241265, 280561, 175093, 168954, 174971, 257145, 240120, 240127, 284280, 175100, 193916]
2023-11-16 08:59:31.479 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 480856 99446 [175104, 174981, 239492, 277379, 219915, 235274, 173453, 248716, 256019, 268053, 173456, 253463, 275730, 284178, 174997, 253844, 173464, 175128, 175004, 250013, 175133, 168995, 177702, 258982, 242597, 276268, 175019, 219820, 235308, 254259, 175158, 192448, 161990, 201286, 253510, 213188, 175307, 175176, 175055, 175052, 175308, 175053, 175059, 277974, 175067, 175195, 205401, 219864, 174945, 191972, 174440, 242025, 219887, 240751, 242286, 219885, 257138, 280561, 168954, 240120, 240127, 284280, 193916]
2023-11-16 08:59:31.479 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 4ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:31.479 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 480856 99446 [175104, 174981, 239492, 277379, 219915, 235274, 173453, 248716, 256019, 268053, 173456, 253463, 275730, 284178, 174997, 253844, 173464, 175128, 175004, 250013, 175133, 168995, 177702, 258982, 242597, 276268, 175019, 219820, 235308, 254259, 175158, 192448, 161990, 201286, 253510, 213188, 175307, 175176, 175055, 175052, 175308, 175053, 175059, 277974, 175067, 175195, 205401, 219864, 174945, 191972, 174440, 242025, 219887, 240751, 242286, 219885, 257138, 280561, 168954, 240120, 240127, 284280, 193916]
2023-11-16 08:59:31.483 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_957039
2023-11-16 08:59:31.483 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_957039
2023-11-16 08:59:31.483 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.510 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:31.512  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1053500
2023-11-16 08:59:31.512 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1053500 
2023-11-16 08:59:31.517 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:31.517 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1053500 
2023-11-16 08:59:31.517  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1053500
2023-11-16 08:59:31.517 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1053500 
2023-11-16 08:59:31.517 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1053500 
2023-11-16 08:59:31.517 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.532 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, with SITEID as( select * from ( select unnest(array[60362829]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:31.532 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 49ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:31.536 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 952338
2023-11-16 08:59:31.536 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_957039
2023-11-16 08:59:31.536 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 53ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_957039
2023-11-16 08:59:31.546 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_957039
2023-11-16 08:59:31.546 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:31.546 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 957039 
2023-11-16 08:59:31.546  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 957039
2023-11-16 08:59:31.571 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [53, with SITE_IDS as(select unnest('{6857,24570,32749,44573,63635,69853,85939,86984,89133,95398,104865,1233762,1233772,1233775,1371403,1881386,2288516,2493241,3611810,3612956,3614168,3614169,3615692,3615709,3616050,3616947,4727785,4728572,5368841,5369115,5370067,5371434,5688942,5690442,12102897,26110573,52395395,52395825,52396211,52396809,60450749,61810292,62727695,62727928,62727979,70897124,70906804}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[1053500] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:31.572 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 54ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:31.572 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 1053500
2023-11-16 08:59:31.587 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 952338
2023-11-16 08:59:31.588  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 952338
2023-11-16 08:59:31.588 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 952338 
2023-11-16 08:59:31.594 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:31.594 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 952338 
2023-11-16 08:59:31.594  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 952338
2023-11-16 08:59:31.594 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 952338 
2023-11-16 08:59:31.595 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 952338 
2023-11-16 08:59:31.595 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.595 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 957039 
2023-11-16 08:59:31.600 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:31.600 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 957039 
2023-11-16 08:59:31.602 DEBUG 1 --- [     Thread-377] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 480856 99446 [161990, 168954, 168994, 168995, 169000, 173453, 173456, 173464, 174440, 174945, 174954, 174971, 174981, 174997, 175004, 175019, 175052, 175053, 175055, 175059, 175067, 175069, 175070, 175093, 175100, 175104, 175109, 175128, 175133, 175158, 175170, 175175, 175176, 175195, 175307, 175308, 177702, 191972, 192448, 193916, 201286, 205401, 213188, 213409, 219820, 219864, 219867, 219885, 219887, 219915, 235274, 235308, 238848, 239492, 240120, 240127, 240751, 241265, 242025, 242286, 242597, 246514, 248716, 249288, 250013, 253197, 253463, 253510, 253844, 254247, 254259, 256019, 257138, 257145, 257984, 258982, 268053, 275730, 276268, 277379, 277974, 280561, 284178, 284280]
2023-11-16 08:59:31.602 DEBUG 1 --- [     Thread-377] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 131ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:31.608 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 957039
2023-11-16 08:59:31.619 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 201461, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:31.619 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868321 and EventDetID : 99446 
2023-11-16 08:59:31.619 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 201461
2023-11-16 08:59:31.625 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868321
2023-11-16 08:59:31.625 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 5ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:31.625 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868321 and Event_Details ID : 99446 
2023-11-16 08:59:31.625 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:31.626 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:31.626 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:31.629 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 201461 -- Resulted rows -- [1]
2023-11-16 08:59:31.629 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:31.629 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 201461 : false : false : 19868321 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:31.631 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 201461
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 201461
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 201461
2023-11-16 08:59:31.632  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 201461
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 201461 
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 201461 
2023-11-16 08:59:31.632 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.669 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [74, with SITE_IDS as(select unnest('{5699442}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[952338] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:31.669 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 74ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:31.669 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 952338
2023-11-16 08:59:31.681 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (201461,90137,90166,90182,90261,90581,91075,91085,91245,91277,91317,91350,91364,91550,91588,91913,92183,92258,92275,92315,92375,92536,92763,92871,92961,93396,93486,93500,94337,94392) and event_details_id = 99446] 
2023-11-16 08:59:31.694 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_201461
2023-11-16 08:59:31.695 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 201461
2023-11-16 08:59:31.695 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 62ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:31.695  INFO 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [201461]
2023-11-16 08:59:31.696  INFO 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [201461]
2023-11-16 08:59:31.697 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 201461 
2023-11-16 08:59:31.697 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 201461 
2023-11-16 08:59:31.697 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.753 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [56, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 201461 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751)] 
2023-11-16 08:59:31.755 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 201461
2023-11-16 08:59:31.755 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 58ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:31.818 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_1053500
2023-11-16 08:59:31.819 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_1053500
2023-11-16 08:59:31.819 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.833 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.853 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with SITEID as( select * from ( select unnest(array[5370067,3616947,3616050,62727928,6857,86984,12102897,5369115,70906804,63635,3611810,52396809,62727979,5368841,61810292,69853,5690442,52395395,44573,70897124,1371403,2493241,104865,4727785,26110573,2288516,95398,60450749,3615709,3612956,89133,52396211,32749,3614169,52395825,3614168,1233762,85939,62727695,4728572,1881386,5688942,24570,3615692,5371434,1233775,1233772]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:31.853 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 34ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:31.856 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1053500
2023-11-16 08:59:31.857 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 37ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_1053500
2023-11-16 08:59:31.866 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_1053500
2023-11-16 08:59:31.866 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:31.866 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 1053500 
2023-11-16 08:59:31.866  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 1053500
2023-11-16 08:59:31.886 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [53, WITH SITE_IDS AS( SELECT UNNEST('{293219,293219,293219,293259,293304,293304,293304,293304,293304,294088,294088,294088,294315,295250,295328,295434,295598,296045,296045,296045,296045,296045,296045,296045,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296112,296249,296961,296961,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299746,299748,299751,299751}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[201461] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 201461 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:31.887 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 53ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:31.887 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 201461 
2023-11-16 08:59:31.950 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_952338
2023-11-16 08:59:31.950 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_952338
2023-11-16 08:59:31.950 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:31.956 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 1053500 
2023-11-16 08:59:31.961 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:31.961 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 1053500 
2023-11-16 08:59:31.970 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:31.996 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, with SITEID as( select * from ( select unnest(array[5699442]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:31.996 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 45ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:32.000 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_952338
2023-11-16 08:59:32.000 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 49ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_952338
2023-11-16 08:59:32.008 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 957039
2023-11-16 08:59:32.009  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 957039
2023-11-16 08:59:32.009 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 957039 
2023-11-16 08:59:32.009 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.009 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_952338
2023-11-16 08:59:32.009 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:32.009 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 952338 
2023-11-16 08:59:32.010  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 952338
2023-11-16 08:59:32.030 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 201461
2023-11-16 08:59:32.030 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 142ms : for accumlator : {}
2023-11-16 08:59:32.030 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 201461 
2023-11-16 08:59:32.035 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_201461
2023-11-16 08:59:32.036 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 5ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_201461
2023-11-16 08:59:32.036 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.063 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [53, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 957039 and es.event_id = 19868318 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:32.063 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 54ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:32.147 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 952338 
2023-11-16 08:59:32.149 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_957039
2023-11-16 08:59:32.150 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 86ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_957039
2023-11-16 08:59:32.153 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:32.153 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 952338 
2023-11-16 08:59:32.156 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 5ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:32.156 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 957039 
2023-11-16 08:59:32.162 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [126, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 201461 and total_cpns != '{}' and site_private_id = any('{4393890,4393914,4393945,4394618,4394845,4395762,4395839,4395925,4396108,4396534,4396535,4396536,4396541,4396608,4396744,4397453,4397509,4398887,4398974,4398980,4399038,4399262,4399343,4399411,4399655,4399897,4400117,4400164,4400181,4400186,4400188,4400190}')] 
2023-11-16 08:59:32.163 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 952338
2023-11-16 08:59:32.169 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_201461
2023-11-16 08:59:32.169 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 133ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:32.169 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.203 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with SITEID as( select * from ( select unnest(array[4396608,4397509,4398980,4396744,4397453,4396108,4395925,4393945,4399897,4399262,4394845,4393890,4398887,4399655,4400164,4399343,4399411,4395762,4396535,4396534,4400117,4400181,4393914,4394618,4400186,4396536,4395839,4398974,4399038,4400190,4396541,4400188]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:32.204 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 35ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:32.209 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_201461
2023-11-16 08:59:32.209 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 40ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_201461
2023-11-16 08:59:32.227 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_201461
2023-11-16 08:59:32.227 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 17ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:32.227 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 201461
2023-11-16 08:59:32.235 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 201461 
2023-11-16 08:59:32.235 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 201461 
2023-11-16 08:59:32.235 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 201461 
2023-11-16 08:59:32.235 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.255  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 957039
2023-11-16 08:59:32.255 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 957039 
2023-11-16 08:59:32.259 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 957039 
2023-11-16 08:59:32.259  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:32.259 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 957039 
2023-11-16 08:59:32.259 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 957039
2023-11-16 08:59:32.269 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[258167, 277909, 200699, 274259, 200697, 224735, 224738]
2023-11-16 08:59:32.269 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 9ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:32.269 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 7 for customer 957039
2023-11-16 08:59:32.269 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[258167, 277909, 200699, 274259, 200697, 224735, 224738]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}957039
2023-11-16 08:59:32.275 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[258167, 277909, 200699, 274259, 200697, 224735, 224738]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}957039
2023-11-16 08:59:32.275 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 5ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:32.275 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 957039 99446 user with No pref [258167, 277909, 200699, 274259, 200697, 224735, 224738]
2023-11-16 08:59:32.276 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:32.277 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 957039 and eventId 99446
2023-11-16 08:59:32.277 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 957039 99446
2023-11-16 08:59:32.277 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 957039
2023-11-16 08:59:32.277  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 957039
2023-11-16 08:59:32.277 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:32.277 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [957039] 
2023-11-16 08:59:32.283 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:32.284 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 6ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:32.284  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 957039, isUpdateAlert : true
2023-11-16 08:59:32.284  INFO 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:32.284 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:32.285  INFO 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:32.285 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"108d9896-5387-4210-a694-8df5ed81517b","eventId":19868318,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:32.287  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868318, tenantId : 957039
2023-11-16 08:59:32.287  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:32.287 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"108d9896-5387-4210-a694-8df5ed81517b","eventId":19868318,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41773
2023-11-16 08:59:32.287  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [203537] 
2023-11-16 08:59:32.288 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.297 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [61, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868321 and tenant_id = 201461] 
2023-11-16 08:59:32.297 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 62ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:32.356 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [68, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (203537)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:32.356 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 68ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:32.413 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_201461
2023-11-16 08:59:32.413 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_201461
2023-11-16 08:59:32.427 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_201461
2023-11-16 08:59:32.427 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 13ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:32.427 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.442 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 14ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:32.444 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 201461 
2023-11-16 08:59:32.465 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (203537)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:32.465 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 38ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:32.469 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_957039
2023-11-16 08:59:32.469 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_957039
2023-11-16 08:59:32.472 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_957039
2023-11-16 08:59:32.472 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_957039
2023-11-16 08:59:32.478 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 5ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:32.608 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:32.609  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 1053500
2023-11-16 08:59:32.609 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 1053500 
2023-11-16 08:59:32.609 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.652 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 1053500 and es.event_id = 19868319 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:32.652 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 43ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:32.656 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_1053500
2023-11-16 08:59:32.656 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_1053500
2023-11-16 08:59:32.659 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:32.659 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 1053500 
2023-11-16 08:59:32.951  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 957039
2023-11-16 08:59:32.951 DEBUG 1 --- [6_103335_957039] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:32.958  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 1053500
2023-11-16 08:59:32.959 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1053500 
2023-11-16 08:59:32.963 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1053500 
2023-11-16 08:59:32.963  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:32.963 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 1053500 
2023-11-16 08:59:32.963 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 1053500
2023-11-16 08:59:33.002 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (203537) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:33.008 DEBUG 1 --- [6_103335_957039] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_957039
2023-11-16 08:59:33.008 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 57ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:33.011 DEBUG 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:33.040 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 952338
2023-11-16 08:59:33.041  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 952338
2023-11-16 08:59:33.041 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 952338 
2023-11-16 08:59:33.041 DEBUG 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.076 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[132982, 294029, 294028, 213456, 5357, 216469, 6021, 106799, 257118, 182265]
2023-11-16 08:59:33.076 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 112ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:33.076 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 10 for customer 1053500
2023-11-16 08:59:33.076 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[132982, 294029, 294028, 213456, 5357, 216469, 6021, 106799, 257118, 182265]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1053500
2023-11-16 08:59:33.080 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 952338 and es.event_id = 19868320 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:33.080 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 39ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:33.084 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_952338
2023-11-16 08:59:33.084 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_952338
2023-11-16 08:59:33.086 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[132982, 294029, 294028, 213456, 5357, 216469, 6021, 106799, 257118, 182265]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}1053500
2023-11-16 08:59:33.086 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 9ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:33.086 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 1053500 99446 user with No pref [132982, 294029, 294028, 213456, 5357, 216469, 6021, 106799, 257118, 182265]
2023-11-16 08:59:33.087 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:33.087 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:33.088 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 1053500 99446 [112046, 196739, 224835, 224842, 224843, 243523, 251828]
2023-11-16 08:59:33.088 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 952338 
2023-11-16 08:59:33.088 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  1053500 99446 
2023-11-16 08:59:33.088 DEBUG 1 --- [     Thread-379] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 1053500 99446 [112046, 196739, 224835, 224842, 224843, 243523, 251828]
2023-11-16 08:59:33.093 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  1053500 99446 
2023-11-16 08:59:33.093 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 4ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:33.093 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.097 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.097 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 4ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:33.098 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.102 DEBUG 1 --- [     Thread-379] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 1053500 99446 [112046, 196739, 224835, 224842, 224843, 243523, 251828]
2023-11-16 08:59:33.102 DEBUG 1 --- [     Thread-379] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 13ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:33.118 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.118 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 20ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:33.118 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.119 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 1053500 99446 [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.119 DEBUG 1 --- [     Thread-378] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 0ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:33.119 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 1053500 and eventId 99446 and userIds [196739, 224835, 243523, 251828, 224843, 224842, 112046]
2023-11-16 08:59:33.120 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 1053500 and eventId : 99446 
2023-11-16 08:59:33.120 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 5
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 4ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 1053500 99446
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 1053500
2023-11-16 08:59:33.124  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 1053500
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:33.124 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1053500] 
2023-11-16 08:59:33.127 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:33.127 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:33.127  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 1053500, isUpdateAlert : true
2023-11-16 08:59:33.127  INFO 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:33.128 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:33.128  INFO 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:33.128 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"a3c545ab-b443-440a-bb1a-a408924a1b60","eventId":19868319,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:33.130  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868319, tenantId : 1053500
2023-11-16 08:59:33.130  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:33.130  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [742, 11464, 3807, 156946, 983495] 
2023-11-16 08:59:33.130 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"a3c545ab-b443-440a-bb1a-a408924a1b60","eventId":19868319,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41774
2023-11-16 08:59:33.130 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 957039
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_957039] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 957039, Took : 3s
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 832990 
2023-11-16 08:59:33.151  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:33.152 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:33.169  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 952338
2023-11-16 08:59:33.170 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 952338 
2023-11-16 08:59:33.175 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 952338 
2023-11-16 08:59:33.176  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:33.176 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 952338 
2023-11-16 08:59:33.176 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 952338
2023-11-16 08:59:33.177 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [46, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (742,11464,3807,156946,983495)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:33.178 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 47ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:33.229 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.256 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (742,11464,3807,156946,983495)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:33.256 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 27ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:33.259 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1053500
2023-11-16 08:59:33.259 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_1053500
2023-11-16 08:59:33.262 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1053500
2023-11-16 08:59:33.262 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_1053500
2023-11-16 08:59:33.267 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:33.327 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 201461
2023-11-16 08:59:33.391 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 201461
2023-11-16 08:59:33.392  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 201461
2023-11-16 08:59:33.392 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 201461 
2023-11-16 08:59:33.398 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:33.398 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 201461 
2023-11-16 08:59:33.398  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 201461
2023-11-16 08:59:33.398 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 201461 
2023-11-16 08:59:33.399 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 201461 
2023-11-16 08:59:33.399 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.425  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 1053500
2023-11-16 08:59:33.425 DEBUG 1 --- [_103335_1053500] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.443 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, with SITE_IDS as(select unnest('{1220946,1220947,1220948,1220949,1220950,1220951,1220952,1220953,1220954,1220955,1220957,1220958,1220959,1220960,1220961,1220962,1220963,1220964,1220965,1220966,1220967,1220968,1220969,1220971,1220972,1220973,1220974,1220975,1220976,1220977,1222262,1222263}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[201461] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:33.443 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 44ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:33.443 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 201461
2023-11-16 08:59:33.466 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (742,11464,3807,156946,983495) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:33.470 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_1053500
2023-11-16 08:59:33.470 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 44ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:33.472 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:33.645 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 493ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:33.645 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.651 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:?] : EVENT_PARTNER_DATA_SET_99446_201461
2023-11-16 08:59:33.651 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 5ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_201461
2023-11-16 08:59:33.651 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.678 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 832990 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 832990), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =832990 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1974941,1974942,2355770,2393055,2453575}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 832990 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:33.679 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 34ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:33.680 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 832990 
2023-11-16 08:59:33.680 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.691 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, with SITEID as( select * from ( select unnest(array[1220946,1220947,1220950,1220951,1220948,1220949,1220954,1220955,1220952,1220953,1220958,1220959,1220957,1220976,1220977,1222262,1222263,1220962,1220963,1220960,1220961,1220966,1220967,1220964,1220965,1220971,1220968,1220969,1220974,1220975,1220972,1220973]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:33.692 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 40ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:33.695 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_201461
2023-11-16 08:59:33.695 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 44ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_201461
2023-11-16 08:59:33.704 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_201461
2023-11-16 08:59:33.705 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:33.705 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 201461 
2023-11-16 08:59:33.705  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 201461
2023-11-16 08:59:33.712 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with SITE_IDS as ( select unnest('{1974941,1974942,2355770,2393055,2453575}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 832990 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:33.714 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 832990
2023-11-16 08:59:33.714 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 34ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:33.732 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 111ms : for accumulator : {}
2023-11-16 08:59:33.732 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:33.791 DEBUG 1 --- [_103335_1053500] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 1053500
2023-11-16 08:59:33.792  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 1053500
2023-11-16 08:59:33.792  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:33.793 DEBUG 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[11464,742,3807],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:33.794  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [11464, 742, 3807]
2023-11-16 08:59:33.794 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[11464,742,3807],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22840
2023-11-16 08:59:33.794  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:33.794  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:33.794  INFO 1 --- [_103335_1053500] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1053500, Took : 5s
2023-11-16 08:59:33.794  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 240830 
2023-11-16 08:59:33.794  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:33.795 DEBUG 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:33.819 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 201461 
2023-11-16 08:59:33.823 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:33.823 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 201461 
2023-11-16 08:59:33.832 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 201461
2023-11-16 08:59:33.839 DEBUG 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 44ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:33.839 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 240830, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:33.839 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:33.840 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 240830
2023-11-16 08:59:33.840 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868323
2023-11-16 08:59:33.840 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:33.840 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:33.841 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:33.841 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:33.842 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:33.844 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 240830 -- Resulted rows -- [1]
2023-11-16 08:59:33.844 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:33.844 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 240830 : null : null : 19868323 : Update published
2023-11-16 08:59:33.846 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 240830
2023-11-16 08:59:33.846 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 1ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:33.846 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 240830
2023-11-16 08:59:33.846  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 240830
2023-11-16 08:59:33.846  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 240830 
2023-11-16 08:59:33.846 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:33.846 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [240830] 
2023-11-16 08:59:33.848 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:33.848 DEBUG 1 --- [6_103335_240830] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:33.848 DEBUG 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 240830 
2023-11-16 08:59:33.849 DEBUG 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 240830 
2023-11-16 08:59:33.849  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:33.849  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:33.849  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:33.849  INFO 1 --- [6_103335_240830] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 240830, Took : 0s
2023-11-16 08:59:33.849  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 3 
2023-11-16 08:59:33.849  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:33.849 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:33.893 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 43ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:33.893 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.913 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 832990, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:33.913 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868322 and EventDetID : 99446 
2023-11-16 08:59:33.913 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 832990
2023-11-16 08:59:33.914 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868322
2023-11-16 08:59:33.914 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:33.914 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868322 and Event_Details ID : 99446 
2023-11-16 08:59:33.914 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:33.914 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:33.915 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[233261, 285826, 233265, 238515, 233275, 238518, 154990, 267675, 233266, 238796, 233274, 238777, 233273, 238813, 233272, 302304, 233277, 234088, 224557, 233264, 233276, 238779]
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 741ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 22 for customer 952338
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[233261, 285826, 233265, 238515, 233275, 238518, 154990, 267675, 233266, 238796, 233274, 238777, 233273, 238813, 233272, 302304, 233277, 234088, 224557, 233264, 233276, 238779]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}952338
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 832990 -- Resulted rows -- [1]
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:33.918 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 832990 : false : false : 19868322 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 832990
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 832990
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 832990
2023-11-16 08:59:33.921  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 832990
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 832990 
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 832990 
2023-11-16 08:59:33.921 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.931 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 3 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 3), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =3 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{42882,42883,42886,291821,292887,357294,378121,378122,1530309}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 3 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:33.932 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 39ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:33.933 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 3 
2023-11-16 08:59:33.933 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.941 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[233261, 285826, 233265, 238515, 233275, 238518, 154990, 267675, 233266, 238796, 233274, 238777, 233273, 238813, 233272, 302304, 233277, 234088, 224557, 233264, 233276, 238779]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}952338
2023-11-16 08:59:33.941 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 23ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:33.941 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 952338 99446 user with No pref [233261, 285826, 233265, 238515, 233275, 238518, 154990, 267675, 233266, 238796, 233274, 238777, 233273, 238813, 233272, 302304, 233277, 234088, 224557, 233264, 233276, 238779]
2023-11-16 08:59:33.943 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:33.943 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 952338 99446 [188701, 192505, 224947, 224948, 233262, 233263, 233267, 233268, 233269, 233270, 233271, 234752, 268176]
2023-11-16 08:59:33.943 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  952338 99446 
2023-11-16 08:59:33.943 DEBUG 1 --- [     Thread-381] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 952338 99446 [188701, 192505, 224947, 224948, 233262, 233263, 233267, 233268, 233269, 233270, 233271, 234752, 268176]
2023-11-16 08:59:33.946 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  952338 99446 
2023-11-16 08:59:33.947 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:33.947 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 952338 99446 [224947, 233267, 234752, 233271, 233270, 233269, 224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.948 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 952338 99446 [224947, 233267, 234752, 233271, 233270, 233269, 224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.948 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:33.948 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 952338 99446 [224947, 233267, 234752, 233271, 233270, 233269, 224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.948 DEBUG 1 --- [     Thread-381] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 952338 99446 [188701, 192505, 224947, 224948, 233262, 233263, 233267, 233268, 233269, 233270, 233271, 234752, 268176]
2023-11-16 08:59:33.949 DEBUG 1 --- [     Thread-381] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 5ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:33.958 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, with SITE_IDS as ( select unnest('{42882,42883,42886,291821,292887,357294,378121,378122,1530309}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 3 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:33.960 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 3
2023-11-16 08:59:33.960 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 26ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:33.982 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [60, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (832990,978176,29615,1177431,1125463) and event_details_id = 99446] 
2023-11-16 08:59:33.983 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 952338 99446 [224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.984 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 35ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:33.984 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 952338 99446 [224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.986 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_832990
2023-11-16 08:59:33.986 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 832990
2023-11-16 08:59:33.986 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 64ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:33.986  INFO 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [832990]
2023-11-16 08:59:33.988  INFO 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [832990]
2023-11-16 08:59:33.988 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 832990 
2023-11-16 08:59:33.988 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 832990 
2023-11-16 08:59:33.988 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:33.990 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 952338 99446 [224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.990 DEBUG 1 --- [     Thread-380] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 6ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:33.991 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 952338 and eventId 99446 and userIds [224948, 192505, 233263, 233262, 188701]
2023-11-16 08:59:33.991 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 952338 and eventId : 99446 
2023-11-16 08:59:33.991 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:33.997 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 3
2023-11-16 08:59:33.997 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 6ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:33.997 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 952338 99446
2023-11-16 08:59:33.998 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 952338
2023-11-16 08:59:33.998  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 952338
2023-11-16 08:59:33.998 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:33.998 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [952338] 
2023-11-16 08:59:34.001 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:34.001 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:34.001  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 952338, isUpdateAlert : true
2023-11-16 08:59:34.001  INFO 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:34.002 DEBUG 1 --- [6_103335_952338] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:34.002  INFO 1 --- [6_103335_952338] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:34.003 DEBUG 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"a41a78be-ba4f-4f3b-af2a-20a3ac4e7219","eventId":19868320,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:34.004  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868320, tenantId : 952338
2023-11-16 08:59:34.004  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:34.004 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"a41a78be-ba4f-4f3b-af2a-20a3ac4e7219","eventId":19868320,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41775
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_952338] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 952338, Took : 4s
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 158308 
2023-11-16 08:59:34.005  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:34.005 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:34.016 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 832990 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1974941,1974942,2393055,2453575)] 
2023-11-16 08:59:34.018 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 832990
2023-11-16 08:59:34.018 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 29ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:34.029 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 23ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:34.029 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.066 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 158308 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 158308), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =158308 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{443171,443493,443494,443495,443496}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158308 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:34.067 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.068 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 39ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:34.068 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 158308 
2023-11-16 08:59:34.068 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.092 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [23, with SITE_IDS as ( select unnest('{443171,443493,443494,443495,443496}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158308 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:34.094 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 158308
2023-11-16 08:59:34.094 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 25ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:34.120 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:?] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 3, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:34.120 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868324 and EventDetID : 99446 
2023-11-16 08:59:34.120 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 3
2023-11-16 08:59:34.121 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868324
2023-11-16 08:59:34.121 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:34.121 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868324 and Event_Details ID : 99446 
2023-11-16 08:59:34.121 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:34.122 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:34.122 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:34.125 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 3 -- Resulted rows -- [1]
2023-11-16 08:59:34.125 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:34.125 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 3 : false : false : 19868324 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 3
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 1ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 3
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 3
2023-11-16 08:59:34.127  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 3
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 3 
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 3 
2023-11-16 08:59:34.127 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.128 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [61, WITH SITE_IDS AS( SELECT UNNEST('{1974941,1974941,1974942,1974942,1974942,2393055,2393055,2453575,2453575}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[832990] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 832990 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:34.129 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 62ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:34.129 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 832990 
2023-11-16 08:59:34.175 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (3,293,292) and event_details_id = 99446] 
2023-11-16 08:59:34.178 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_3
2023-11-16 08:59:34.178 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 3
2023-11-16 08:59:34.178 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 50ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:34.178  INFO 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [3]
2023-11-16 08:59:34.180  INFO 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [3]
2023-11-16 08:59:34.181 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 3 
2023-11-16 08:59:34.181 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 3 
2023-11-16 08:59:34.181 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.215 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 158308, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:34.215 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868326 and EventDetID : 99446 
2023-11-16 08:59:34.215 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 158308
2023-11-16 08:59:34.216 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868326
2023-11-16 08:59:34.216 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:34.216 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868326 and Event_Details ID : 99446 
2023-11-16 08:59:34.216 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:34.216 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:34.217 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:34.220 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 3 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (42882,42883,42886,292887,378121,378122,1530309,291821,357294)] 
2023-11-16 08:59:34.221 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 3
2023-11-16 08:59:34.221 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 40ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:34.222 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 158308 -- Resulted rows -- [1]
2023-11-16 08:59:34.222 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 5ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:34.222 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 158308 : false : false : 19868326 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 158308
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 158308
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 158308
2023-11-16 08:59:34.225  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 158308
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 158308 
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 158308 
2023-11-16 08:59:34.225 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.253 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 832990
2023-11-16 08:59:34.253 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 123ms : for accumlator : {}
2023-11-16 08:59:34.253 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 832990 
2023-11-16 08:59:34.255 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (158308,75792,75803) and event_details_id = 99446] 
2023-11-16 08:59:34.257 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_832990
2023-11-16 08:59:34.258 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_832990
2023-11-16 08:59:34.258 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.259 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_158308
2023-11-16 08:59:34.259 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 158308
2023-11-16 08:59:34.259 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 33ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:34.260  INFO 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [158308]
2023-11-16 08:59:34.260  INFO 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [158308]
2023-11-16 08:59:34.260 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158308 
2023-11-16 08:59:34.260 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158308 
2023-11-16 08:59:34.260 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.278 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.283 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 832990 and total_cpns != '{}' and site_private_id = any('{61457316,61457317,76516951,81886126}')] 
2023-11-16 08:59:34.286 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_832990
2023-11-16 08:59:34.286 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 28ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:34.286 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.287 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 158308 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (443171,443493,443494,443495,443496)] 
2023-11-16 08:59:34.288 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158308
2023-11-16 08:59:34.289 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 28ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:34.302 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 201461
2023-11-16 08:59:34.302  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 201461
2023-11-16 08:59:34.302 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 201461 
2023-11-16 08:59:34.302 DEBUG 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.307 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [20, with SITEID as( select * from ( select unnest(array[76516951,61457317,61457316,81886126]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:34.307 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 20ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:34.311 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_832990
2023-11-16 08:59:34.311 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 24ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_832990
2023-11-16 08:59:34.322 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_832990
2023-11-16 08:59:34.322 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:34.322 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 832990
2023-11-16 08:59:34.329 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 832990 
2023-11-16 08:59:34.329 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 832990 
2023-11-16 08:59:34.329 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 832990 
2023-11-16 08:59:34.329 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.338 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 201461 and es.event_id = 19868321 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:34.338 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 35ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:34.342 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_201461
2023-11-16 08:59:34.342 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_201461
2023-11-16 08:59:34.345 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:34.345 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 201461 
2023-11-16 08:59:34.358 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.371 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [92, WITH SITE_IDS AS( SELECT UNNEST('{42882,42882,42883,42883,42886,42886,291821,292887,357294,378121,378122,1530309}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[3] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 3 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:34.372 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 93ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:34.372 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 3 
2023-11-16 08:59:34.388 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [58, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868322 and tenant_id = 832990] 
2023-11-16 08:59:34.388 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 58ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:34.410 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, WITH SITE_IDS AS( SELECT UNNEST('{443171,443171,443493,443493,443494,443494,443495,443495,443496,443496}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[158308] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 158308 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:34.411 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 53ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:34.411 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 158308 
2023-11-16 08:59:34.423  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 201461
2023-11-16 08:59:34.424 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 201461 
2023-11-16 08:59:34.427 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 201461 
2023-11-16 08:59:34.427  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:34.427 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 201461 
2023-11-16 08:59:34.427 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 201461
2023-11-16 08:59:34.460 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_832990
2023-11-16 08:59:34.460 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_832990
2023-11-16 08:59:34.470 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_832990
2023-11-16 08:59:34.470 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:34.479 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:34.480 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 832990 
2023-11-16 08:59:34.504 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 3
2023-11-16 08:59:34.504 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 132ms : for accumlator : {}
2023-11-16 08:59:34.504 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 3 
2023-11-16 08:59:34.508 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_3
2023-11-16 08:59:34.508 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_3
2023-11-16 08:59:34.508 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.546 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 3 and total_cpns != '{}' and site_private_id = any('{130501,148780,186502,1409691,1507302,1507387,1650816,1650817,34690133}')] 
2023-11-16 08:59:34.549 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_3
2023-11-16 08:59:34.549 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 41ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:34.549 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.565 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 158308
2023-11-16 08:59:34.566 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 154ms : for accumlator : {}
2023-11-16 08:59:34.566 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 158308 
2023-11-16 08:59:34.570 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_158308
2023-11-16 08:59:34.570 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_158308
2023-11-16 08:59:34.570 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.584 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with SITEID as( select * from ( select unnest(array[1507302,130501,186502,34690133,1650817,1650816,1507387,148780,1409691]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:34.585 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 35ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:34.588 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_3
2023-11-16 08:59:34.588 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 38ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_3
2023-11-16 08:59:34.600 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_3
2023-11-16 08:59:34.601 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 12ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:34.601 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 3
2023-11-16 08:59:34.608 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 3 
2023-11-16 08:59:34.608 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 3 
2023-11-16 08:59:34.608 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 3 
2023-11-16 08:59:34.608 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.610 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[240219, 235604, 292698, 292699, 235597, 235605, 240229, 240215, 240231, 235602, 240220, 274259, 240232, 235611, 240223, 240226, 292701, 235601, 235606, 235608, 111619, 240224, 240233, 240228, 235609, 235599, 240217, 240221, 88191, 240212, 240214, 235610, 235598, 240222, 240211, 277909, 235613, 103778, 240213, 240216, 240218, 235612, 235603, 234060]
2023-11-16 08:59:34.611 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 183ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:34.611 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 44 for customer 201461
2023-11-16 08:59:34.611 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[240219, 235604, 292698, 292699, 235597, 235605, 240229, 240215, 240231, 235602, 240220, 274259, 240232, 235611, 240223, 240226, 292701, 235601, 235606, 235608, 111619, 240224, 240233, 240228, 235609, 235599, 240217, 240221, 88191, 240212, 240214, 235610, 235598, 240222, 240211, 277909, 235613, 103778, 240213, 240216, 240218, 235612, 235603, 234060]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}201461
2023-11-16 08:59:34.612 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 158308 and total_cpns != '{}' and site_private_id = any('{2314059,2314386,2314387,2314388,2314389}')] 
2023-11-16 08:59:34.617 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_158308
2023-11-16 08:59:34.617 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 47ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:34.617 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.659 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, with SITEID as( select * from ( select unnest(array[2314387,2314386,2314389,2314388,2314059]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:34.659 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 41ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:34.663 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_158308
2023-11-16 08:59:34.663 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 45ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_158308
2023-11-16 08:59:34.672 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[240219, 235604, 292698, 292699, 235597, 235605, 240229, 240215, 240231, 235602, 240220, 274259, 240232, 235611, 240223, 240226, 292701, 235601, 235606, 235608, 111619, 240224, 240233, 240228, 235609, 235599, 240217, 240221, 88191, 240212, 240214, 235610, 235598, 240222, 240211, 277909, 235613, 103778, 240213, 240216, 240218, 235612, 235603, 234060]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}201461
2023-11-16 08:59:34.672 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 61ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:34.672 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 201461 99446 user with No pref [240219, 235604, 292698, 292699, 235597, 235605, 240229, 240215, 240231, 235602, 240220, 274259, 240232, 235611, 240223, 240226, 292701, 235601, 235606, 235608, 111619, 240224, 240233, 240228, 235609, 235599, 240217, 240221, 88191, 240212, 240214, 235610, 235598, 240222, 240211, 277909, 235613, 103778, 240213, 240216, 240218, 235612, 235603, 234060]
2023-11-16 08:59:34.674 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:34.674 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 201461 99446 [235600, 235607, 240225]
2023-11-16 08:59:34.675 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [?:?] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  201461 99446 
2023-11-16 08:59:34.675 DEBUG 1 --- [     Thread-383] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 201461 99446 [235600, 235607, 240225]
2023-11-16 08:59:34.677 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_158308
2023-11-16 08:59:34.677 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 13ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:34.677 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  201461 99446 
2023-11-16 08:59:34.677 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 158308
2023-11-16 08:59:34.677 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:34.677 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:34.677 DEBUG 1 --- [     Thread-383] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 201461 99446 [235600, 235607, 240225]
2023-11-16 08:59:34.677 DEBUG 1 --- [     Thread-383] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 2ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:34.679 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:34.679 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:34.679 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:34.686 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158308 
2023-11-16 08:59:34.686 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 158308 
2023-11-16 08:59:34.686 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 158308 
2023-11-16 08:59:34.686 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:34.686 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [77, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868324 and tenant_id = 3] 
2023-11-16 08:59:34.687 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 78ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:34.737 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [50, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868326 and tenant_id = 158308] 
2023-11-16 08:59:34.737 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 51ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:34.825 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_3
2023-11-16 08:59:34.825 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_3
2023-11-16 08:59:34.835 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_3
2023-11-16 08:59:34.835 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 10ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:34.840 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_158308
2023-11-16 08:59:34.840 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_158308
2023-11-16 08:59:34.845 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:34.846 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 3 
2023-11-16 08:59:34.852 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_158308
2023-11-16 08:59:34.853 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 12ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:34.862 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:34.863 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 158308 
2023-11-16 08:59:35.435 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:35.435 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 756ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:35.435 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:35.436 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 201461 99446 [240225, 235600, 235607]
2023-11-16 08:59:35.437 DEBUG 1 --- [     Thread-382] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 1ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:35.437 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 201461 and eventId 99446 and userIds [240225, 235600, 235607]
2023-11-16 08:59:35.437 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 201461 and eventId : 99446 
2023-11-16 08:59:35.437 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 3
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 20ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 201461 99446
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 201461
2023-11-16 08:59:35.458  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 201461
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:35.458 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [201461] 
2023-11-16 08:59:35.463 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:35.463 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 5ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:35.463  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 201461, isUpdateAlert : true
2023-11-16 08:59:35.464  INFO 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:35.464 DEBUG 1 --- [6_103335_201461] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:35.464  INFO 1 --- [6_103335_201461] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:35.465 DEBUG 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"16c7798e-0ce8-4d03-9688-3e0fb4c60dbb","eventId":19868321,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868321, tenantId : 201461
2023-11-16 08:59:35.467 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"16c7798e-0ce8-4d03-9688-3e0fb4c60dbb","eventId":19868321,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41776
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:35.467  INFO 1 --- [6_103335_201461] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 201461, Took : 4s
2023-11-16 08:59:35.468  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1160168 
2023-11-16 08:59:35.468  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:35.468 DEBUG 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 3ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1160168, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1160168
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868325
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:35.472 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:35.473 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:35.473 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:35.473 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:35.477 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1160168 -- Resulted rows -- [1]
2023-11-16 08:59:35.477 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:35.477 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1160168 : null : null : 19868325 : Update published
2023-11-16 08:59:35.480 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1160168
2023-11-16 08:59:35.480 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:35.480 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1160168
2023-11-16 08:59:35.481  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1160168
2023-11-16 08:59:35.481  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1160168 
2023-11-16 08:59:35.481 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:35.481 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1160168] 
2023-11-16 08:59:35.485 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:35.485 DEBUG 1 --- [_103335_1160168] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:35.485 DEBUG 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1160168 
2023-11-16 08:59:35.485 DEBUG 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1160168 
2023-11-16 08:59:35.485  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:35.485  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:35.485  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:35.485  INFO 1 --- [_103335_1160168] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1160168, Took : 0s
2023-11-16 08:59:35.485  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 565620 
2023-11-16 08:59:35.485  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:35.487 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:35.579 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 91ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:35.579 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.621 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 565620 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 565620), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =565620 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{96474,96637,96949,97341,492717}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 565620 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:35.623 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 43ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:35.623 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 565620 
2023-11-16 08:59:35.623 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.672 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, with SITE_IDS as ( select unnest('{96474,96637,96949,97341,492717}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 565620 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:35.673 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 565620
2023-11-16 08:59:35.673 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 50ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:35.802 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 832990
2023-11-16 08:59:35.875 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 3
2023-11-16 08:59:35.879 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 832990
2023-11-16 08:59:35.881  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 832990
2023-11-16 08:59:35.881 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 832990 
2023-11-16 08:59:35.886 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:35.886 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 832990 
2023-11-16 08:59:35.886  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 832990
2023-11-16 08:59:35.886 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 832990 
2023-11-16 08:59:35.886 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 832990 
2023-11-16 08:59:35.886 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.893 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 565620, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:35.893 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868327 and EventDetID : 99446 
2023-11-16 08:59:35.893 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 565620
2023-11-16 08:59:35.894 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868327
2023-11-16 08:59:35.894 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:35.894 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868327 and Event_Details ID : 99446 
2023-11-16 08:59:35.894 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:35.895 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:35.895 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:35.898 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 565620 -- Resulted rows -- [1]
2023-11-16 08:59:35.898 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:35.898 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 565620 : false : false : 19868327 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 565620
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 565620
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 565620
2023-11-16 08:59:35.902  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 565620
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 565620 
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 565620 
2023-11-16 08:59:35.902 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.908 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 3
2023-11-16 08:59:35.909  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 3
2023-11-16 08:59:35.909 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 3 
2023-11-16 08:59:35.914 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:35.914 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 3 
2023-11-16 08:59:35.914  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 3
2023-11-16 08:59:35.914 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 3 
2023-11-16 08:59:35.914 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 3 
2023-11-16 08:59:35.914 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.928 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, with SITE_IDS as(select unnest('{61457507,61457647,81887874,87240252}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[832990] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:35.928 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 41ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:35.928 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 832990
2023-11-16 08:59:35.944 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (565620,75804,75792,75811) and event_details_id = 99446] 
2023-11-16 08:59:35.948 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_565620
2023-11-16 08:59:35.948 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 565620
2023-11-16 08:59:35.948 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 45ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:35.948  INFO 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [565620]
2023-11-16 08:59:35.949  INFO 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [565620]
2023-11-16 08:59:35.949 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 565620 
2023-11-16 08:59:35.949 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 565620 
2023-11-16 08:59:35.949 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:35.962 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, with SITE_IDS as(select unnest('{7217,25496,63218,1208224,1650813,1650814}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[3] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:35.963 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 48ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:35.963 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 3
2023-11-16 08:59:35.978 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 565620 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (96474,96637,96949,97341,492717)] 
2023-11-16 08:59:35.980 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 565620
2023-11-16 08:59:35.980 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 30ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:36.006 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 158308
2023-11-16 08:59:36.035 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.043 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 158308
2023-11-16 08:59:36.044  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 158308
2023-11-16 08:59:36.045 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 158308 
2023-11-16 08:59:36.049 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:36.049 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 158308 
2023-11-16 08:59:36.049  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 158308
2023-11-16 08:59:36.049 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 158308 
2023-11-16 08:59:36.049 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 158308 
2023-11-16 08:59:36.049 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.134 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [99, WITH SITE_IDS AS( SELECT UNNEST('{96474,96637,96949,97341,492717}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[565620] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 565620 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:36.135 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 100ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:36.135 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 565620 
2023-11-16 08:59:36.135 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [85, with SITE_IDS as(select unnest('{2288360,2288361,2288362,2288363,2288409}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[158308] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:36.135 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 86ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:36.135 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 158308
2023-11-16 08:59:36.210 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_3
2023-11-16 08:59:36.210 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_832990
2023-11-16 08:59:36.210 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 3ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_3
2023-11-16 08:59:36.210 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_832990
2023-11-16 08:59:36.210 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.210 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.241 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, with SITEID as( select * from ( select unnest(array[81887874,61457647,61457507,87240252]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:36.242 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 31ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:36.245 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with SITEID as( select * from ( select unnest(array[63218,1208224,1650813,1650814,25496]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:36.246 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_832990
2023-11-16 08:59:36.246 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 35ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_832990
2023-11-16 08:59:36.246 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 35ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:36.251 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_3
2023-11-16 08:59:36.251 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 40ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_3
2023-11-16 08:59:36.254 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 565620
2023-11-16 08:59:36.254 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 118ms : for accumlator : {}
2023-11-16 08:59:36.254 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 565620 
2023-11-16 08:59:36.257 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_565620
2023-11-16 08:59:36.257 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_565620
2023-11-16 08:59:36.258 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.259 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_832990
2023-11-16 08:59:36.259 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 12ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:36.259 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 832990 
2023-11-16 08:59:36.259  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 832990
2023-11-16 08:59:36.267 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_3
2023-11-16 08:59:36.267 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 16ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:36.267 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 3 
2023-11-16 08:59:36.267  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 3
2023-11-16 08:59:36.290 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 565620 and total_cpns != '{}' and site_private_id = any('{26565134,26565135,26565136,26565205,26565688}')] 
2023-11-16 08:59:36.295 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_565620
2023-11-16 08:59:36.295 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 37ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:36.295 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.326 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 832990 
2023-11-16 08:59:36.328 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[26565205,26565136,26565135,26565134,26565688]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:36.328 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 33ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:36.333 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [?:?] : [createEventSiteDsForPartner:1501]: Time taken : 6ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:36.333 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 832990 
2023-11-16 08:59:36.334 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_565620
2023-11-16 08:59:36.334 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 38ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_565620
2023-11-16 08:59:36.345 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 832990
2023-11-16 08:59:36.349 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_565620
2023-11-16 08:59:36.350 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 15ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:36.350 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 565620
2023-11-16 08:59:36.357 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 565620 
2023-11-16 08:59:36.357 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 565620 
2023-11-16 08:59:36.358 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 565620 
2023-11-16 08:59:36.358 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.359 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 3 
2023-11-16 08:59:36.364 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:36.364 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 3 
2023-11-16 08:59:36.374 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 3
2023-11-16 08:59:36.375 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_158308
2023-11-16 08:59:36.376 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_158308
2023-11-16 08:59:36.376 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.394 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868327 and tenant_id = 565620] 
2023-11-16 08:59:36.395 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 37ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:36.400 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, with SITEID as( select * from ( select unnest(array[2288362,2288363,2288360,2288361,2288409]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:36.401 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 24ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:36.406 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158308
2023-11-16 08:59:36.406 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 30ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158308
2023-11-16 08:59:36.420 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_158308
2023-11-16 08:59:36.420 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 13ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:36.420 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 158308 
2023-11-16 08:59:36.420  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 158308
2023-11-16 08:59:36.456 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_565620
2023-11-16 08:59:36.456 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 3ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_565620
2023-11-16 08:59:36.470 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_565620
2023-11-16 08:59:36.470 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 13ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:36.482 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 11ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:36.483 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 158308 
2023-11-16 08:59:36.484 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 565620 
2023-11-16 08:59:36.490 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 6ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:36.490 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 158308 
2023-11-16 08:59:36.502 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 158308
2023-11-16 08:59:36.765 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 832990
2023-11-16 08:59:36.767  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 832990
2023-11-16 08:59:36.767 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 832990 
2023-11-16 08:59:36.767 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:36.816 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 832990 and es.event_id = 19868322 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:36.816 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 49ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:36.821 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_832990
2023-11-16 08:59:36.821 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 4ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_832990
2023-11-16 08:59:36.825 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:36.825 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 832990 
2023-11-16 08:59:37.113 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 3
2023-11-16 08:59:37.114  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 3
2023-11-16 08:59:37.114 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 3 
2023-11-16 08:59:37.114 DEBUG 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:37.144  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 832990
2023-11-16 08:59:37.144 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 832990 
2023-11-16 08:59:37.150 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 832990 
2023-11-16 08:59:37.150  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:37.150 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 832990 
2023-11-16 08:59:37.150 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 832990
2023-11-16 08:59:37.157 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 3 and es.event_id = 19868324 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:37.158 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 43ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:37.161 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_3
2023-11-16 08:59:37.161 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_3
2023-11-16 08:59:37.164 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:37.165 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [?:?] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 3 
2023-11-16 08:59:37.203 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 158308
2023-11-16 08:59:37.204  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 158308
2023-11-16 08:59:37.204 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 158308 
2023-11-16 08:59:37.204 DEBUG 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:37.225  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 3
2023-11-16 08:59:37.225 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 3 
2023-11-16 08:59:37.229 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 3 
2023-11-16 08:59:37.230  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): false, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:37.230 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 3 
2023-11-16 08:59:37.230 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 3
2023-11-16 08:59:37.249 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 158308 and es.event_id = 19868326 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:37.249 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 45ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:37.252 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_158308
2023-11-16 08:59:37.253 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_158308
2023-11-16 08:59:37.256 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:37.256 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 158308 
2023-11-16 08:59:37.312  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 158308
2023-11-16 08:59:37.313 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 158308 
2023-11-16 08:59:37.316 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 158308 
2023-11-16 08:59:37.316  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:37.316 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 158308 
2023-11-16 08:59:37.316 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 158308
2023-11-16 08:59:37.325 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[5357]
2023-11-16 08:59:37.325 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 8ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:37.325 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 1 for customer 158308
2023-11-16 08:59:37.325 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[5357]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158308
2023-11-16 08:59:37.330 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[5357]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158308
2023-11-16 08:59:37.330 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 4ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:37.330 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 158308 99446 user with No pref [5357]
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 158308 and eventId 99446
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 158308 99446
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 158308
2023-11-16 08:59:37.332  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 158308
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:37.332 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [158308] 
2023-11-16 08:59:37.334 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:37.334 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 1ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:37.334  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 158308, isUpdateAlert : true
2023-11-16 08:59:37.334  INFO 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:37.340 DEBUG 1 --- [6_103335_158308] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [5, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:37.340  INFO 1 --- [6_103335_158308] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:37.340 DEBUG 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"0d85b31e-7d4c-4b16-ac8a-edba7e7e6254","eventId":19868326,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868326, tenantId : 158308
2023-11-16 08:59:37.341 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"0d85b31e-7d4c-4b16-ac8a-edba7e7e6254","eventId":19868326,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41777
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:37.341  INFO 1 --- [6_103335_158308] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 158308, Took : 3s
2023-11-16 08:59:37.342  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 158843 
2023-11-16 08:59:37.342  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:37.342 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:37.360 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 565620
2023-11-16 08:59:37.401 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 565620
2023-11-16 08:59:37.402  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 565620
2023-11-16 08:59:37.402 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 565620 
2023-11-16 08:59:37.406 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:37.406 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 565620 
2023-11-16 08:59:37.406  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 565620
2023-11-16 08:59:37.407 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 565620 
2023-11-16 08:59:37.407 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 565620 
2023-11-16 08:59:37.407 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:37.465 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [58, with SITE_IDS as(select unnest('{20145,80130,80261,108423,2917404}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[565620] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:37.465 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 58ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:37.465 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 565620
2023-11-16 08:59:37.709 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_565620
2023-11-16 08:59:37.709 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_565620
2023-11-16 08:59:37.709 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:37.715 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[215427, 215436, 240052, 192167, 215426, 215419, 215485, 215449, 215452, 246083, 215489, 215527, 242950, 216494, 216450, 192166, 215497, 215456, 215445, 215447, 215472, 215496, 215470, 243374, 215422, 192170, 239410, 238962, 302299, 215433, 215479, 215425, 215486, 215484, 192168, 250084, 215501, 215492, 215480, 215453, 215435, 215526, 242126, 242911, 215418, 215444, 261321, 215471, 215473, 215457, 206322, 220274, 135732, 215529, 215530, 215420, 215491, 242127, 206326, 215490, 253247, 215442, 215448, 238963, 215504, 233604, 215500, 215451, 215483, 215469, 215494, 192171, 257664, 215495, 253298, 215454, 215455, 249340, 215439, 215441, 215482, 215487, 215417, 192172, 215438, 192469, 215481, 215424, 215458, 192505, 215499, 237035, 215423, 215421, 215434, 215437]
2023-11-16 08:59:37.715 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 564ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:37.715 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 96 for customer 832990
2023-11-16 08:59:37.715 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[215427, 215436, 240052, 192167, 215426, 215419, 215485, 215449, 215452, 246083, 215489, 215527, 242950, 216494, 216450, 192166, 215497, 215456, 215445, 215447, 215472, 215496, 215470, 243374, 215422, 192170, 239410, 238962, 302299, 215433, 215479, 215425, 215486, 215484, 192168, 250084, 215501, 215492, 215480, 215453, 215435, 215526, 242126, 242911, 215418, 215444, 261321, 215471, 215473, 215457, 206322, 220274, 135732, 215529, 215530, 215420, 215491, 242127, 206326, 215490, 253247, 215442, 215448, 238963, 215504, 233604, 215500, 215451, 215483, 215469, 215494, 192171, 257664, 215495, 253298, 215454, 215455, 249340, 215439, 215441, 215482, 215487, 215417, 192172, 215438, 192469, 215481, 215424, 215458, 192505, 215499, 237035, 215423, 215421, 215434, 215437]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}832990
2023-11-16 08:59:37.743 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with SITEID as( select * from ( select unnest(array[2917404,20145,80130,80261,108423]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:37.744 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 34ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:37.747 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_565620
2023-11-16 08:59:37.747 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 38ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_565620
2023-11-16 08:59:37.755 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[215427, 215436, 240052, 192167, 215426, 215419, 215485, 215449, 215452, 246083, 215489, 215527, 242950, 216494, 216450, 192166, 215497, 215456, 215445, 215447, 215472, 215496, 215470, 243374, 215422, 192170, 239410, 238962, 302299, 215433, 215479, 215425, 215486, 215484, 192168, 250084, 215501, 215492, 215480, 215453, 215435, 215526, 242126, 242911, 215418, 215444, 261321, 215471, 215473, 215457, 206322, 220274, 135732, 215529, 215530, 215420, 215491, 242127, 206326, 215490, 253247, 215442, 215448, 238963, 215504, 233604, 215500, 215451, 215483, 215469, 215494, 192171, 257664, 215495, 253298, 215454, 215455, 249340, 215439, 215441, 215482, 215487, 215417, 192172, 215438, 192469, 215481, 215424, 215458, 192505, 215499, 237035, 215423, 215421, 215434, 215437]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}832990
2023-11-16 08:59:37.755 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 40ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:37.755 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 832990 99446 user with No pref [215427, 215436, 240052, 192167, 215426, 215419, 215485, 215449, 215452, 246083, 215489, 215527, 242950, 216494, 216450, 192166, 215497, 215456, 215445, 215447, 215472, 215496, 215470, 243374, 215422, 192170, 239410, 238962, 302299, 215433, 215479, 215425, 215486, 215484, 192168, 250084, 215501, 215492, 215480, 215453, 215435, 215526, 242126, 242911, 215418, 215444, 261321, 215471, 215473, 215457, 206322, 220274, 135732, 215529, 215530, 215420, 215491, 242127, 206326, 215490, 253247, 215442, 215448, 238963, 215504, 233604, 215500, 215451, 215483, 215469, 215494, 192171, 257664, 215495, 253298, 215454, 215455, 249340, 215439, 215441, 215482, 215487, 215417, 192172, 215438, 192469, 215481, 215424, 215458, 192505, 215499, 237035, 215423, 215421, 215434, 215437]
2023-11-16 08:59:37.756 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_565620
2023-11-16 08:59:37.757 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:37.757 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 565620 
2023-11-16 08:59:37.757  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 565620
2023-11-16 08:59:37.757 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:37.757 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 832990 99446 [192169, 192174, 192470, 206324, 215415, 215416, 215478, 215498]
2023-11-16 08:59:37.758 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  832990 99446 
2023-11-16 08:59:37.758 DEBUG 1 --- [     Thread-385] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 832990 99446 [192169, 192174, 192470, 206324, 215415, 215416, 215478, 215498]
2023-11-16 08:59:37.760 DEBUG 1 --- [     Thread-385] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 832990 99446 [192169, 192174, 192470, 206324, 215415, 215416, 215478, 215498]
2023-11-16 08:59:37.760 DEBUG 1 --- [     Thread-385] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 2ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:37.760 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  832990 99446 
2023-11-16 08:59:37.760 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:37.760 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 832990 99446 [192470, 215415, 215478, 206324, 215498, 192169, 215416, 192174]
2023-11-16 08:59:37.762 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 832990 99446 [192470, 215415, 215478, 206324, 215498, 192169, 215416, 192174]
2023-11-16 08:59:37.762 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:37.762 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 832990 99446 [192470, 215415, 215478, 206324, 215498, 192169, 215416, 192174]
2023-11-16 08:59:37.821 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 565620 
2023-11-16 08:59:37.826 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:37.826 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 565620 
2023-11-16 08:59:37.834 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 565620
2023-11-16 08:59:37.933 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 832990 99446 [192470, 215415, 206324, 215498, 192174]
2023-11-16 08:59:37.933 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 171ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:37.933 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 832990 99446 [192470, 215415, 206324, 215498, 192174]
2023-11-16 08:59:37.934 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 832990 99446 [192470, 215415, 215498, 192174]
2023-11-16 08:59:37.934 DEBUG 1 --- [     Thread-384] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 0ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:37.934 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 832990 and eventId 99446 and userIds [192470, 215415, 215498, 192174]
2023-11-16 08:59:37.934 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 832990 and eventId : 99446 
2023-11-16 08:59:37.934 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:37.939 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 4
2023-11-16 08:59:37.939 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 5ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:37.940 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 832990 99446
2023-11-16 08:59:37.940 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 832990
2023-11-16 08:59:37.940  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 832990
2023-11-16 08:59:37.940 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:37.940 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [832990] 
2023-11-16 08:59:37.943 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:37.943 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:37.943  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 832990, isUpdateAlert : true
2023-11-16 08:59:37.943  INFO 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:37.944 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:37.944  INFO 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:37.945 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"c908e67c-093b-4922-b8e2-14181c2fc826","eventId":19868322,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:37.946  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868322, tenantId : 832990
2023-11-16 08:59:37.946  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:37.946  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [978176, 29615, 1177431, 1125463] 
2023-11-16 08:59:37.946 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"c908e67c-093b-4922-b8e2-14181c2fc826","eventId":19868322,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41778
2023-11-16 08:59:37.946 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:37.984 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (978176,29615,1177431,1125463)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:37.985 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 38ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:38.089 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.148 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [58, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (978176,29615,1177431,1125463)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:38.148 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 59ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:38.154 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_832990
2023-11-16 08:59:38.154 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 5ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_832990
2023-11-16 08:59:38.158 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_832990
2023-11-16 08:59:38.158 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_832990
2023-11-16 08:59:38.163 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:38.176 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 565620
2023-11-16 08:59:38.177  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 565620
2023-11-16 08:59:38.178 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 565620 
2023-11-16 08:59:38.178 DEBUG 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.230 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 565620 and es.event_id = 19868327 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:38.230 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 52ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:38.234 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 890ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:38.234 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.234 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_565620
2023-11-16 08:59:38.234 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_565620
2023-11-16 08:59:38.238 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:38.238 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 565620 
2023-11-16 08:59:38.285 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 158843 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 158843), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =158843 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1677,29048,37163,46086,49301,55741,322697,366560,428271,443659,534966,534974,534975,536856,654800,731078,732853,924351,974076,1189136,1638163}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158843 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:38.287 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 53ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:38.288 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 158843 
2023-11-16 08:59:38.288 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.327  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 565620
2023-11-16 08:59:38.327 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 565620 
2023-11-16 08:59:38.330 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with SITE_IDS as ( select unnest('{1677,29048,37163,46086,49301,55741,322697,366560,428271,443659,534966,534974,534975,536856,654800,731078,732853,924351,974076,1189136,1638163}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158843 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:38.330 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 565620 
2023-11-16 08:59:38.330  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:38.330 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 565620 
2023-11-16 08:59:38.330 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 565620
2023-11-16 08:59:38.331 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 158843
2023-11-16 08:59:38.331 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 43ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:38.345  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 832990
2023-11-16 08:59:38.345 DEBUG 1 --- [6_103335_832990] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.396 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[6145, 5357, 240311, 101797]
2023-11-16 08:59:38.396 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 65ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:38.396 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 4 for customer 565620
2023-11-16 08:59:38.396 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[6145, 5357, 240311, 101797]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}565620
2023-11-16 08:59:38.405 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [60, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (978176,29615,1177431,1125463) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:38.409 DEBUG 1 --- [6_103335_832990] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_832990
2023-11-16 08:59:38.409 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 63ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:38.410 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[6145, 5357, 240311, 101797]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}565620
2023-11-16 08:59:38.410 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 14ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:38.411 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 565620 99446 user with No pref [6145, 5357, 240311, 101797]
2023-11-16 08:59:38.412 DEBUG 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:38.412 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:38.412 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 565620 99446 [182265]
2023-11-16 08:59:38.413 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  565620 99446 
2023-11-16 08:59:38.413 DEBUG 1 --- [     Thread-387] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 565620 99446 [182265]
2023-11-16 08:59:38.415 DEBUG 1 --- [     Thread-387] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 565620 99446 [182265]
2023-11-16 08:59:38.415 DEBUG 1 --- [     Thread-387] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 2ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:38.416 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  565620 99446 
2023-11-16 08:59:38.416 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 3ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:38.417 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 565620 99446 [182265]
2023-11-16 08:59:38.419 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 565620 99446 [182265]
2023-11-16 08:59:38.419 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 2ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:38.420 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 565620 99446 [182265]
2023-11-16 08:59:38.441 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 565620 99446 []
2023-11-16 08:59:38.441 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 21ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:38.441 DEBUG 1 --- [     Thread-386] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 565620 99446 []
2023-11-16 08:59:38.441 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 565620 and eventId 99446 and userIds []
2023-11-16 08:59:38.441 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 565620 and eventId : 99446 
2023-11-16 08:59:38.441 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 565620 99446
2023-11-16 08:59:38.442 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 565620
2023-11-16 08:59:38.442  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 565620
2023-11-16 08:59:38.442 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:38.442 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [565620] 
2023-11-16 08:59:38.446 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:38.446 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 4ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:38.446  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 565620, isUpdateAlert : true
2023-11-16 08:59:38.447  INFO 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:38.448 DEBUG 1 --- [6_103335_565620] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [1, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:38.448  INFO 1 --- [6_103335_565620] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:38.448 DEBUG 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"7c87708c-566a-4322-8c3a-6df12561a489","eventId":19868327,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:38.449  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868327, tenantId : 565620
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:38.450 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"7c87708c-566a-4322-8c3a-6df12561a489","eventId":19868327,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41779
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_565620] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 565620, Took : 2s
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 158371 
2023-11-16 08:59:38.450  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:38.451 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:38.486 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 158843, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:38.486 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868328 and EventDetID : 99446 
2023-11-16 08:59:38.487 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 158843
2023-11-16 08:59:38.487 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868328
2023-11-16 08:59:38.487 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:38.488 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868328 and Event_Details ID : 99446 
2023-11-16 08:59:38.488 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:38.488 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:38.489 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:38.491 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 158843 -- Resulted rows -- [1]
2023-11-16 08:59:38.491 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:38.491 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 158843 : false : false : 19868328 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:38.493 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 158843
2023-11-16 08:59:38.493 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:38.493 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 158843
2023-11-16 08:59:38.493 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 158843
2023-11-16 08:59:38.493  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 158843
2023-11-16 08:59:38.494 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 158843 
2023-11-16 08:59:38.494 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 158843 
2023-11-16 08:59:38.494 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 832990
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:38.508  INFO 1 --- [6_103335_832990] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 832990, Took : 5s
2023-11-16 08:59:38.508  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 32 
2023-11-16 08:59:38.508  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:38.509 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:38.520 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (158843,3248,1375,7837,1449,1788,2177,273,293,1572,90,2281,1573,102,4473,152723,45992,144203,75804) and event_details_id = 99446] 
2023-11-16 08:59:38.524 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_158843
2023-11-16 08:59:38.524 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 158843
2023-11-16 08:59:38.524 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 30ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:38.524  INFO 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [158843]
2023-11-16 08:59:38.525  INFO 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [158843]
2023-11-16 08:59:38.525 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158843 
2023-11-16 08:59:38.525 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158843 
2023-11-16 08:59:38.525 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.563 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 158843 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1677,29048,37163,46086,49301,55741,322697,366560,428271,443659,534966,534974,534975,536856,654800,731078,732853,924351,974076,1189136,1638163)] 
2023-11-16 08:59:38.565 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158843
2023-11-16 08:59:38.565 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 40ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:38.583 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[123736, 123874, 131706, 79372, 233118, 131719, 302344, 81815, 131704, 131734, 249421, 251862, 131717, 238133, 204853, 270268, 131708, 302321, 267430, 131727, 131705, 133205, 265753, 131722, 217826, 169257, 131735, 242904, 79380, 131732, 131702, 79316, 131703, 114806, 302296, 265752, 131736, 233789]
2023-11-16 08:59:38.583 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 1353ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:38.583 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 38 for customer 3
2023-11-16 08:59:38.584 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[123736, 123874, 131706, 79372, 233118, 131719, 302344, 81815, 131704, 131734, 249421, 251862, 131717, 238133, 204853, 270268, 131708, 302321, 267430, 131727, 131705, 133205, 265753, 131722, 217826, 169257, 131735, 242904, 79380, 131732, 131702, 79316, 131703, 114806, 302296, 265752, 131736, 233789]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}3
2023-11-16 08:59:38.597 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[123736, 123874, 131706, 79372, 233118, 131719, 302344, 81815, 131704, 131734, 249421, 251862, 131717, 238133, 204853, 270268, 131708, 302321, 267430, 131727, 131705, 133205, 265753, 131722, 217826, 169257, 131735, 242904, 79380, 131732, 131702, 79316, 131703, 114806, 302296, 265752, 131736, 233789]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}3
2023-11-16 08:59:38.597 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 13ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:38.598 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 3 99446 user with No pref [123736, 123874, 131706, 79372, 233118, 131719, 302344, 81815, 131704, 131734, 249421, 251862, 131717, 238133, 204853, 270268, 131708, 302321, 267430, 131727, 131705, 133205, 265753, 131722, 217826, 169257, 131735, 242904, 79380, 131732, 131702, 79316, 131703, 114806, 302296, 265752, 131736, 233789]
2023-11-16 08:59:38.605 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 7ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:38.605 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 3 99446 [132, 86772, 101920, 132288, 132289, 149162, 166301, 168030, 168571, 168724, 173251, 179305, 225446]
2023-11-16 08:59:38.605 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  3 99446 
2023-11-16 08:59:38.606 DEBUG 1 --- [     Thread-389] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 3 99446 [132, 86772, 101920, 132288, 132289, 149162, 166301, 168030, 168571, 168724, 173251, 179305, 225446]
2023-11-16 08:59:38.611 DEBUG 1 --- [     Thread-389] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 3 99446 [132, 86772, 101920, 132288, 132289, 149162, 166301, 168030, 168571, 168724, 173251, 179305, 225446]
2023-11-16 08:59:38.611 DEBUG 1 --- [     Thread-389] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 5ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:38.619 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  3 99446 
2023-11-16 08:59:38.619 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 13ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:38.619 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 3 99446 [101920, 132288, 132289, 132, 86772, 225446, 149162, 168571, 179305, 168030, 166301]
2023-11-16 08:59:38.626 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 3 99446 [101920, 132288, 132289, 132, 86772, 149162, 168571, 179305, 168030, 166301]
2023-11-16 08:59:38.626 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 6ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:38.626 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 3 99446 [101920, 132288, 132289, 132, 86772, 149162, 168571, 179305, 168030, 166301]
2023-11-16 08:59:38.626 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 116ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:38.626 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.638 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.660 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 32 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 32), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =32 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{2002021}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 32 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:38.661 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 34ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:38.661 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 32 
2023-11-16 08:59:38.661 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.692 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [54, WITH SITE_IDS AS( SELECT UNNEST('{1677,1677,1677,1677,29048,29048,29048,29048,37163,37163,37163,37163,37163,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,46086,49301,49301,49301,49301,49301,49301,49301,49301,49301,49301,55741,55741,322697,322697,322697,322697,366560,366560,366560,366560,366560,428271,428271,428271,428271,428271,443659,443659,534966,534966,534966,534966,534966,534974,534974,534974,534974,534974,534975,534975,534975,534975,534975,536856,536856,654800,654800,654800,654800,654800,731078,732853,732853,732853,732853,732853,732853,732853,732853,924351,974076,974076,1189136,1189136,1638163}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[158843] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 158843 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:38.693 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 54ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:38.693 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 158843 
2023-11-16 08:59:38.697 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, with SITE_IDS as ( select unnest('{2002021}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 32 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:38.699 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 32
2023-11-16 08:59:38.699 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 37ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:38.829 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 158843
2023-11-16 08:59:38.829 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 135ms : for accumlator : {}
2023-11-16 08:59:38.829 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 158843 
2023-11-16 08:59:38.833 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_158843
2023-11-16 08:59:38.833 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_158843
2023-11-16 08:59:38.833 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.874 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [41, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 158843 and total_cpns != '{}' and site_private_id = any('{52455453,52455721,52456386,52456515,52456607,52457096,52458053,52458054,52458055,52458280,52459330,52459514,52459695,52460498,52460615,52462062,52462167,52462319,52462501,52462502,52463000}')] 
2023-11-16 08:59:38.879 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_158843
2023-11-16 08:59:38.880 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 46ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:38.880 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.881 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 32, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868329 and EventDetID : 99446 
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 32
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868329
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868329 and Event_Details ID : 99446 
2023-11-16 08:59:38.882 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:38.883 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:38.883 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:38.886 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 32 -- Resulted rows -- [1]
2023-11-16 08:59:38.886 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:38.886 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 32 : false : false : 19868329 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 32
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 32
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 32
2023-11-16 08:59:38.889  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 32
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 32 
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 32 
2023-11-16 08:59:38.889 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.911 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, with SITEID as( select * from ( select unnest(array[52456386,52459330,52456515,52458053,52462501,52458054,52462502,52458055,52460615,52457096,52458280,52455721,52462062,52459695,52462319,52460498,52462167,52463000,52459514,52455453,52456607]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:38.912 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 31ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:38.916 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_158843
2023-11-16 08:59:38.916 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 36ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_158843
2023-11-16 08:59:38.927 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_158843
2023-11-16 08:59:38.927 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:38.927 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 158843
2023-11-16 08:59:38.934 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158843 
2023-11-16 08:59:38.934 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 158843 
2023-11-16 08:59:38.934 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 158843 
2023-11-16 08:59:38.934 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.934 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (32,985825) and event_details_id = 99446] 
2023-11-16 08:59:38.938 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_32
2023-11-16 08:59:38.938 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 32
2023-11-16 08:59:38.938 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 48ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:38.938  INFO 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [32]
2023-11-16 08:59:38.939  INFO 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [32]
2023-11-16 08:59:38.939 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 32 
2023-11-16 08:59:38.939 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 32 
2023-11-16 08:59:38.939 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:38.965 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 32 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (2002021)] 
2023-11-16 08:59:38.967 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 32
2023-11-16 08:59:38.967 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 28ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:38.985 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868328 and tenant_id = 158843] 
2023-11-16 08:59:38.986 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 51ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:39.037 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 586ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:39.038 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.043 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.059 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_158843
2023-11-16 08:59:39.059 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 3ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_158843
2023-11-16 08:59:39.068 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_158843
2023-11-16 08:59:39.068 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 9ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:39.076 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:39.077 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 158843 
2023-11-16 08:59:39.081 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, WITH SITE_IDS AS( SELECT UNNEST('{2002021}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[32] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 32 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:39.082 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 39ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:39.082 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 32 
2023-11-16 08:59:39.090 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [52, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 158371 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 158371), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =158371 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{37163,46830,366560,428271,534966,534974,534975,721088,722040,723410,1215175,1657571,2373503,2423546,2423547,2423549,2423550,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423558,2423560,2423561,2423562,2423563,2450478,2450479,2450480,2450481,2450482,2450483,2450484,2450485,2450486,2450487,2450488,2450489,2450490,2450491,2450492,2450493,2450494,2450495,2450496,2450497,2450498,2450499}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158371 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:39.091 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 53ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:39.091 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 158371 
2023-11-16 08:59:39.091 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.098 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 3 99446 [101920, 132288, 132289, 132, 86772, 149162, 179305, 166301]
2023-11-16 08:59:39.098 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 472ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:39.098 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 3 99446 [101920, 132288, 132289, 132, 86772, 149162, 179305, 166301]
2023-11-16 08:59:39.113 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 3 99446 [101920, 149162, 179305, 166301]
2023-11-16 08:59:39.113 DEBUG 1 --- [     Thread-388] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 15ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:39.113 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 3 and eventId 99446 and userIds [101920, 149162, 179305, 166301]
2023-11-16 08:59:39.114 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 3 and eventId : 99446 
2023-11-16 08:59:39.114 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:39.123 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, with SITE_IDS as ( select unnest('{37163,46830,366560,428271,534966,534974,534975,721088,722040,723410,1215175,1657571,2373503,2423546,2423547,2423549,2423550,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423558,2423560,2423561,2423562,2423563,2450478,2450479,2450480,2450481,2450482,2450483,2450484,2450485,2450486,2450487,2450488,2450489,2450490,2450491,2450492,2450493,2450494,2450495,2450496,2450497,2450498,2450499}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158371 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:39.124 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 158371
2023-11-16 08:59:39.124 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 32ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 4
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 12ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 3 99446
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 3
2023-11-16 08:59:39.126  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 3
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:39.126 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [3] 
2023-11-16 08:59:39.129 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:39.129 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:39.129  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 3, isUpdateAlert : true
2023-11-16 08:59:39.129  INFO 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:39.129 DEBUG 1 --- [_99446_103335_3] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:39.130  INFO 1 --- [_99446_103335_3] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:39.130 DEBUG 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"5a8d1eb0-35dc-4166-9596-28a66cc9a2c0","eventId":19868324,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:39.131  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868324, tenantId : 3
2023-11-16 08:59:39.131 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"5a8d1eb0-35dc-4166-9596-28a66cc9a2c0","eventId":19868324,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41780
2023-11-16 08:59:39.131  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:39.131  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:39.132  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:39.132  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:39.132  INFO 1 --- [_99446_103335_3] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 3, Took : 5s
2023-11-16 08:59:39.132  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 397511 
2023-11-16 08:59:39.132  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:39.133 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:39.190 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 32
2023-11-16 08:59:39.190 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 108ms : for accumlator : {}
2023-11-16 08:59:39.190 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 32 
2023-11-16 08:59:39.195 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_32
2023-11-16 08:59:39.195 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_32
2023-11-16 08:59:39.195 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.225 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 32 and total_cpns != '{}' and site_private_id = any('{61932350}')] 
2023-11-16 08:59:39.232 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_32
2023-11-16 08:59:39.232 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 36ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:39.232 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.265 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[61932350]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:39.266 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 33ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:39.271 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_32
2023-11-16 08:59:39.271 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 38ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_32
2023-11-16 08:59:39.286 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_32
2023-11-16 08:59:39.286 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 14ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:39.286 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 32
2023-11-16 08:59:39.294 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 32 
2023-11-16 08:59:39.295 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 32 
2023-11-16 08:59:39.295 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 32 
2023-11-16 08:59:39.295 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.334 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868329 and tenant_id = 32] 
2023-11-16 08:59:39.335 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 40ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:39.374 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 158371, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:39.374 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868330 and EventDetID : 99446 
2023-11-16 08:59:39.374 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 158371
2023-11-16 08:59:39.375 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868330
2023-11-16 08:59:39.375 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 1ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:39.375 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868330 and Event_Details ID : 99446 
2023-11-16 08:59:39.375 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:39.376 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:39.377 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:39.380 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 158371 -- Resulted rows -- [1]
2023-11-16 08:59:39.380 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:39.380 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 158371 : false : false : 19868330 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:39.384 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 158371
2023-11-16 08:59:39.384 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 4ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:39.384 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 158371
2023-11-16 08:59:39.384 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 158371
2023-11-16 08:59:39.385  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 158371
2023-11-16 08:59:39.385 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 158371 
2023-11-16 08:59:39.385 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 158371 
2023-11-16 08:59:39.385 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.418 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (158371,1661,1449,273,1572,90,1166,324,2156,194315,1369,1786,1382,1405,40670,1366,732,1402,992681,2199,1385,1587,7297,1681,2091,17071,153274,2203,2251,37892,7437,608,127954,230372) and event_details_id = 99446] 
2023-11-16 08:59:39.423 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_158371
2023-11-16 08:59:39.423 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 158371
2023-11-16 08:59:39.423 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 38ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:39.423  INFO 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [158371]
2023-11-16 08:59:39.425  INFO 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [158371]
2023-11-16 08:59:39.426 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158371 
2023-11-16 08:59:39.426 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158371 
2023-11-16 08:59:39.426 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.457 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 158371 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (37163,46830,366560,428271,534966,534974,534975,721088,722040,723410,1215175,1657571,2373503,2423546,2423547,2423549,2423550,2423551,2423552,2423553,2423554,2423555,2423556,2423557,2423558,2423560,2423561,2423562,2423563,2450478,2450479,2450480,2450481,2450482,2450483,2450484,2450485,2450486,2450487,2450488,2450489,2450490,2450491,2450492,2450493,2450494,2450495,2450496,2450497,2450498,2450499)] 
2023-11-16 08:59:39.459 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158371
2023-11-16 08:59:39.459 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 33ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:39.481 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 348ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:39.481 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.501 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [19, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 397511 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 397511), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =397511 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 397511 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:39.502 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 21ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:39.503 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 397511 
2023-11-16 08:59:39.503 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.516 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.530 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_32
2023-11-16 08:59:39.531 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 5ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_32
2023-11-16 08:59:39.545 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_32
2023-11-16 08:59:39.545 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 14ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:39.560 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 14ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:39.562 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 32 
2023-11-16 08:59:39.565 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [62, with SITE_IDS as ( select unnest('{293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 397511 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:39.567 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [?:?] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 397511
2023-11-16 08:59:39.567 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 64ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:39.587 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [71, WITH SITE_IDS AS( SELECT UNNEST('{37163,37163,37163,37163,37163,37163,37163,46830,366560,366560,366560,366560,366560,428271,534966,534974,534975,721088,721088,721088,721088,721088,721088,721088,722040,723410,1215175,1215175,1215175,1657571,2373503,2423546,2423547,2423547,2423547,2423549,2423549,2423549,2423550,2423551,2423552,2423553,2423553,2423553,2423554,2423555,2423555,2423555,2423555,2423555,2423556,2423557,2423558,2423560,2423560,2423560,2423560,2423560,2423560,2423560,2423560,2423560,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423561,2423562,2423562,2423562,2423562,2423562,2423563,2450478,2450479,2450480,2450481,2450482,2450483,2450484,2450485,2450486,2450487,2450488,2450489,2450490,2450491,2450492,2450493,2450494,2450495,2450496,2450497,2450498,2450499}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[158371] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 158371 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:39.587 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 71ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:39.587 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 158371 
2023-11-16 08:59:39.702 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 158371
2023-11-16 08:59:39.702 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 113ms : for accumlator : {}
2023-11-16 08:59:39.702 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 158371 
2023-11-16 08:59:39.707 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_158371
2023-11-16 08:59:39.707 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 5ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_158371
2023-11-16 08:59:39.707 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.724 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 397511, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:39.724 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868331 and EventDetID : 99446 
2023-11-16 08:59:39.724 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 397511
2023-11-16 08:59:39.725 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868331
2023-11-16 08:59:39.725 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:39.725 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868331 and Event_Details ID : 99446 
2023-11-16 08:59:39.725 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:39.726 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:39.726 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:39.731 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 397511 -- Resulted rows -- [1]
2023-11-16 08:59:39.731 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 4ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:39.731 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 397511 : false : false : 19868331 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:39.735 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 397511
2023-11-16 08:59:39.735 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 4ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:39.735 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 397511
2023-11-16 08:59:39.735 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 397511
2023-11-16 08:59:39.735  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 397511
2023-11-16 08:59:39.735 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 397511 
2023-11-16 08:59:39.736 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 397511 
2023-11-16 08:59:39.736 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.752 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 158371 and total_cpns != '{}' and site_private_id = any('{79119231,79119450,79119620,79119801,79119802,79120117,79120428,79120673,79120766,79120767,79121096,79121097,79121267,79121575,79121576,79121863,79122403,79122621,79122830,79123117,79123132,79123171,79123308,79123382,81591885,81592039,81592183,81592257,81592258,81592259,81592260,81592261,81592414,81592415,81592648,81592649,81592650,81592651,81592652,81593275,81593554,81593555,81593556,81593742,81594480,81594481,81594482,81595173,81595174,81595327,81595598}')] 
2023-11-16 08:59:39.756 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_158371
2023-11-16 08:59:39.756 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 49ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:39.757 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.766 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (397511,90137,90166,90182,90261,90581,91075,91085,91245,91277,91317,91350,91364,91550,91588,91913,92183,92258,92275,92315,92375,92536,92763,92871,92961,93396,93486,93500,94337,94392) and event_details_id = 99446] 
2023-11-16 08:59:39.769 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_397511
2023-11-16 08:59:39.770 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 397511
2023-11-16 08:59:39.770 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 33ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:39.770  INFO 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [397511]
2023-11-16 08:59:39.770  INFO 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [397511]
2023-11-16 08:59:39.771 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 397511 
2023-11-16 08:59:39.771 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 397511 
2023-11-16 08:59:39.771 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.790 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[79123382,81592415,81592414,81593556,79122621,79123132,79119802,79119801,81593555,81593554,79121575,81591885,81592652,81595598,81592649,81592648,79120673,81592651,81592650,81592260,81592261,79123117,79120428,81592257,81592258,79121576,81592259,81592183,81594481,81594480,81594482,79119620,79122830,81592039,79120117,79121267,79119231,79120767,79120766,81593742,79122403,79123171,79123308,81595327,81593275,79119450,79121863,81595173,81595174,79121097,79121096]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:39.790 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 33ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:39.796 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_158371
2023-11-16 08:59:39.796 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 39ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_158371
2023-11-16 08:59:39.801 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 397511 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (293219,293259,293304,294088,294315,295250,295328,295434,295598,296045,296046,296047,296048,296112,296249,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299746,299748,299751)] 
2023-11-16 08:59:39.803 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 397511
2023-11-16 08:59:39.803 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 32ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:39.814 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_158371
2023-11-16 08:59:39.815 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 18ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:39.815 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 158371
2023-11-16 08:59:39.825 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158371 
2023-11-16 08:59:39.825 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 158371 
2023-11-16 08:59:39.826 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 158371 
2023-11-16 08:59:39.826 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.887 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:39.912 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [86, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868330 and tenant_id = 158371] 
2023-11-16 08:59:39.913 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 86ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:39.930 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, WITH SITE_IDS AS( SELECT UNNEST('{293219,293219,293219,293259,293304,293304,293304,293304,293304,294088,294088,294088,294315,295250,295328,295434,295598,296045,296045,296045,296045,296045,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296046,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296047,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296048,296112,296249,296961,296961,296961,297025,298440,298527,298533,298592,298818,298899,298967,299213,299456,299677,299724,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299742,299746,299748,299751,299751}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[397511] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 397511 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:39.931 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 43ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:39.931 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 397511 
2023-11-16 08:59:40.180 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_158371
2023-11-16 08:59:40.180 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 7ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_158371
2023-11-16 08:59:40.181 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 158843
2023-11-16 08:59:40.193 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_158371
2023-11-16 08:59:40.193 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 12ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:40.202 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:40.204 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 158371 
2023-11-16 08:59:40.359 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 158843
2023-11-16 08:59:40.360  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 158843
2023-11-16 08:59:40.361 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 158843 
2023-11-16 08:59:40.365 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:40.366 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 158843 
2023-11-16 08:59:40.366  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 158843
2023-11-16 08:59:40.366 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 158843 
2023-11-16 08:59:40.366 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 158843 
2023-11-16 08:59:40.366 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.386 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 397511
2023-11-16 08:59:40.387 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 455ms : for accumlator : {}
2023-11-16 08:59:40.387 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 397511 
2023-11-16 08:59:40.391 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_397511
2023-11-16 08:59:40.391 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_397511
2023-11-16 08:59:40.391 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.418 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 397511 and total_cpns != '{}' and site_private_id = any('{10389626,10389650,10389681,10390354,10390581,10391498,10391575,10391661,10391844,10392270,10392271,10392272,10392277,10392344,10392480,10393189,10393245,10394623,10394710,10394716,10394774,10394998,10395079,10395147,10395391,10395633,10395853,10395900,10395917,10395922,10395924,10395926}')] 
2023-11-16 08:59:40.422 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_397511
2023-11-16 08:59:40.422 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 31ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:40.422 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.426 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [59, with SITE_IDS as(select unnest('{24570,32749,44573,69853,85939,104865,1371403,1881386,2288516,2493241,3614160,3614168,3614169,3616050,4728572,5688942,5690442,10182907,12026033,26110573,52062549}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[158843] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:40.426 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 60ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:40.426 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 158843
2023-11-16 08:59:40.456 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[10394716,10393245,10392344,10394710,10394774,10395926,10391575,10395924,10392277,10389650,10390354,10395922,10392272,10392270,10392271,10395853,10395917,10391498,10395147,10395079,10394623,10395391,10395900,10389626,10394998,10390581,10389681,10395633,10391661,10391844,10393189,10392480]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:40.456 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 33ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:40.459 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_397511
2023-11-16 08:59:40.460 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 37ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_397511
2023-11-16 08:59:40.470 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_397511
2023-11-16 08:59:40.471 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:40.471 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 397511
2023-11-16 08:59:40.478 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 397511 
2023-11-16 08:59:40.478 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 397511 
2023-11-16 08:59:40.478 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 397511 
2023-11-16 08:59:40.478 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.526 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868331 and tenant_id = 397511] 
2023-11-16 08:59:40.527 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 48ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:40.530 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 32
2023-11-16 08:59:40.702 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 32
2023-11-16 08:59:40.702  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 32
2023-11-16 08:59:40.702 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 32 
2023-11-16 08:59:40.708 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:40.708 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 32 
2023-11-16 08:59:40.708  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 32
2023-11-16 08:59:40.708 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 32 
2023-11-16 08:59:40.708 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 32 
2023-11-16 08:59:40.708 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.716 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_397511
2023-11-16 08:59:40.716 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_397511
2023-11-16 08:59:40.728 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_397511
2023-11-16 08:59:40.728 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:40.737 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:40.738 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 397511 
2023-11-16 08:59:40.753 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [44, with SITE_IDS as(select unnest('{61932450}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[32] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:40.754 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 45ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:40.754 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 32
2023-11-16 08:59:40.770 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_158843
2023-11-16 08:59:40.770 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_158843
2023-11-16 08:59:40.770 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:40.812 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with SITEID as( select * from ( select unnest(array[104865,10182907,26110573,3616050,2288516,12026033,3614160,32749,3614169,3614168,52062549,85939,4728572,1881386,5688942,24570,69853,5690442,44573,1371403,2493241]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:40.813 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 42ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:40.816 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158843
2023-11-16 08:59:40.816 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 46ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158843
2023-11-16 08:59:40.826 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_158843
2023-11-16 08:59:40.826 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:40.826 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 158843 
2023-11-16 08:59:40.826  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 158843
2023-11-16 08:59:40.918 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 158843 
2023-11-16 08:59:40.923 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:40.923 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 158843 
2023-11-16 08:59:40.932 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 158843
2023-11-16 08:59:41.108 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_32
2023-11-16 08:59:41.108 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_32
2023-11-16 08:59:41.108 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.141 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, with SITEID as( select * from ( select unnest(array[61932450]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:41.141 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 32ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:41.144 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_32
2023-11-16 08:59:41.144 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 36ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_32
2023-11-16 08:59:41.153 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_32
2023-11-16 08:59:41.154 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:41.154 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 32 
2023-11-16 08:59:41.154  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 32
2023-11-16 08:59:41.232 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 158371
2023-11-16 08:59:41.261 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 32 
2023-11-16 08:59:41.266 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:41.267 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 32 
2023-11-16 08:59:41.277 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 32
2023-11-16 08:59:41.280 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [?:?] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 158371
2023-11-16 08:59:41.281  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 158371
2023-11-16 08:59:41.281 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 158371 
2023-11-16 08:59:41.286 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:41.287 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 158371 
2023-11-16 08:59:41.287  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 158371
2023-11-16 08:59:41.287 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 158371 
2023-11-16 08:59:41.287 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 158371 
2023-11-16 08:59:41.287 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.326 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with SITE_IDS as(select unnest('{48900,69853,1881386,2493241,3614160,3614168,3614169,5369115,5370067,5371434,27377105,52395825,74185244,79123876,79123886,79124157,79124441,79124684,79124886,79125735,79126082,79126314,79126754,79126781,79127271,79127310,79127447,79127543,79127807,81595955,81596704,81597339,81597466,81597723,81597947,81598131,81598226,81598343,81598547,81598668,81599209,81599263,81600096,81600629,81600734,81600946,81601531,81601988,81602025,81603465,81603769}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[158371] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:41.327 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 39ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:41.327 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 158371
2023-11-16 08:59:41.665 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 32
2023-11-16 08:59:41.667  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 32
2023-11-16 08:59:41.667 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 32 
2023-11-16 08:59:41.667 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.682 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_158371
2023-11-16 08:59:41.682 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_158371
2023-11-16 08:59:41.682 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.701 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [19, with SITEID as( select * from ( select unnest(array[5370067,81600734,48900,79124157,81598547,81598668,79123876,79123886,81601988,79126314,2493241,79127447,79124886,81597947,81601531,81600629,52395825,81599209,81602025,1881386,79127310,81600096,79127543,81599263,81597339,81597723,81597466,79127807,5369115,79126781,81598226,79125735,79127271,81603465,79126754,81598343,69853,81603769,3614160,3614169,79124441,81595955,81598131,3614168,81600946,27377105,79126082,74185244,5371434,79124684,81596704]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:41.702 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 19ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:41.702 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [35, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 32 and es.event_id = 19868329 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:41.702 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 35ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:41.705 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_32
2023-11-16 08:59:41.705 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158371
2023-11-16 08:59:41.705 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 2ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_32
2023-11-16 08:59:41.705 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 23ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158371
2023-11-16 08:59:41.708 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:41.709 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 32 
2023-11-16 08:59:41.711 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 397511
2023-11-16 08:59:41.717 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_158371
2023-11-16 08:59:41.717 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 12ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:41.717 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 158371 
2023-11-16 08:59:41.717  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 158371
2023-11-16 08:59:41.765 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 158371 
2023-11-16 08:59:41.769  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 32
2023-11-16 08:59:41.769 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 32 
2023-11-16 08:59:41.770 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:41.770 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 158371 
2023-11-16 08:59:41.776 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 32 
2023-11-16 08:59:41.777  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:41.777 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 32 
2023-11-16 08:59:41.777 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 32
2023-11-16 08:59:41.781 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 158371
2023-11-16 08:59:41.787 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 397511
2023-11-16 08:59:41.788  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 397511
2023-11-16 08:59:41.789 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 397511 
2023-11-16 08:59:41.794 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:41.794 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 397511 
2023-11-16 08:59:41.794  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 397511
2023-11-16 08:59:41.794 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 397511 
2023-11-16 08:59:41.794 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 397511 
2023-11-16 08:59:41.794 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.804 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[92382, 194499, 257760, 269257, 151644]
2023-11-16 08:59:41.805 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 27ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:41.805 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 5 for customer 32
2023-11-16 08:59:41.805 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[92382, 194499, 257760, 269257, 151644]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}32
2023-11-16 08:59:41.817 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[92382, 194499, 257760, 269257, 151644]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}32
2023-11-16 08:59:41.817 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 12ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:41.817 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 32 99446 user with No pref [92382, 194499, 257760, 269257, 151644]
2023-11-16 08:59:41.820 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 2ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:41.820 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 32 99446 [74949, 89439, 95330, 150460, 151645, 151646, 219609, 230975, 235238]
2023-11-16 08:59:41.820 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  32 99446 
2023-11-16 08:59:41.820 DEBUG 1 --- [     Thread-391] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 32 99446 [74949, 89439, 95330, 150460, 151645, 151646, 219609, 230975, 235238]
2023-11-16 08:59:41.823 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  32 99446 
2023-11-16 08:59:41.823 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:41.823 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 32 99446 [95330, 74949, 235238, 219609, 151646, 230975, 89439, 150460, 151645]
2023-11-16 08:59:41.823 DEBUG 1 --- [     Thread-391] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 32 99446 [74949, 89439, 95330, 150460, 151645, 151646, 219609, 230975, 235238]
2023-11-16 08:59:41.823 DEBUG 1 --- [     Thread-391] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 3ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:41.824 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 32 99446 [95330, 74949, 235238, 219609, 151646, 230975, 89439, 150460, 151645]
2023-11-16 08:59:41.824 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:41.825 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 32 99446 [95330, 74949, 235238, 219609, 151646, 230975, 89439, 150460, 151645]
2023-11-16 08:59:41.831 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, with SITE_IDS as(select unnest('{1220946,1220947,1220948,1220949,1220950,1220951,1220952,1220953,1220954,1220955,1220957,1220958,1220959,1220960,1220961,1220962,1220963,1220964,1220965,1220966,1220967,1220968,1220969,1220971,1220972,1220973,1220974,1220975,1220976,1220977,1222262,1222263}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[397511] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:41.832 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 37ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:41.832 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 397511
2023-11-16 08:59:41.847 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 32 99446 [95330, 235238, 219609, 151646, 230975, 89439, 151645]
2023-11-16 08:59:41.847 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 22ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:41.847 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 32 99446 [95330, 235238, 219609, 151646, 230975, 89439, 151645]
2023-11-16 08:59:41.849 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 32 99446 [95330]
2023-11-16 08:59:41.849 DEBUG 1 --- [     Thread-390] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 1ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:41.849 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 32 and eventId 99446 and userIds [219609, 230975, 95330]
2023-11-16 08:59:41.849 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 32 and eventId : 99446 
2023-11-16 08:59:41.849 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:41.861 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 3
2023-11-16 08:59:41.861 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 12ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:41.861 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 32 99446
2023-11-16 08:59:41.861 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 32
2023-11-16 08:59:41.862  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 32
2023-11-16 08:59:41.862 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:41.862 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [32] 
2023-11-16 08:59:41.864 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:41.864 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 1ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:41.864  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 32, isUpdateAlert : true
2023-11-16 08:59:41.864  INFO 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:41.864 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:41.864  INFO 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:41.865 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [?:?] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 158843
2023-11-16 08:59:41.865 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"a58157ae-022c-406d-af93-e3e809eb80e2","eventId":19868329,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:41.865  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 158843
2023-11-16 08:59:41.865 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 158843 
2023-11-16 08:59:41.865 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.867  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868329, tenantId : 32
2023-11-16 08:59:41.867 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"a58157ae-022c-406d-af93-e3e809eb80e2","eventId":19868329,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41781
2023-11-16 08:59:41.867  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:41.867  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [985825] 
2023-11-16 08:59:41.867 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.916 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 158843 and es.event_id = 19868328 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:41.916 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (985825)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:41.917 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 51ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:41.917 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 49ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:41.920 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_158843
2023-11-16 08:59:41.920 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_158843
2023-11-16 08:59:41.924 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:41.924 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 158843 
2023-11-16 08:59:41.967 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:41.995  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 158843
2023-11-16 08:59:41.995 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 158843 
2023-11-16 08:59:41.999 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 158843 
2023-11-16 08:59:41.999  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:41.999 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 158843 
2023-11-16 08:59:41.999 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 158843
2023-11-16 08:59:42.000 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (985825)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:42.000 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 33ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:42.004 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_32
2023-11-16 08:59:42.004 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_32
2023-11-16 08:59:42.009 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_32
2023-11-16 08:59:42.009 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_32
2023-11-16 08:59:42.013 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:42.014 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[192878, 5357]
2023-11-16 08:59:42.015 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 15ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:42.015 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 2 for customer 158843
2023-11-16 08:59:42.015 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[192878, 5357]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158843
2023-11-16 08:59:42.018 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[192878, 5357]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158843
2023-11-16 08:59:42.018 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 3ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:42.018 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 158843 99446 user with No pref [192878, 5357]
2023-11-16 08:59:42.019 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:42.019 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 158843 and eventId 99446
2023-11-16 08:59:42.019 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 158843 99446
2023-11-16 08:59:42.019 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 158843
2023-11-16 08:59:42.019  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 158843
2023-11-16 08:59:42.019 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:42.020 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [158843] 
2023-11-16 08:59:42.023 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:42.023 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:42.023  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 158843, isUpdateAlert : true
2023-11-16 08:59:42.023  INFO 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.023 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:42.023  INFO 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.024 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"05fe1aca-276b-47b2-8d7b-462cf0715154","eventId":19868328,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:42.026  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868328, tenantId : 158843
2023-11-16 08:59:42.026  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:42.026  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [102] 
2023-11-16 08:59:42.027 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.026 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"05fe1aca-276b-47b2-8d7b-462cf0715154","eventId":19868328,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41782
2023-11-16 08:59:42.054 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_397511
2023-11-16 08:59:42.055 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 5ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_397511
2023-11-16 08:59:42.055 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.076 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [49, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (102)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:42.077 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 50ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:42.084 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, with SITEID as( select * from ( select unnest(array[1220946,1220947,1220950,1220951,1220948,1220949,1220954,1220955,1220952,1220953,1220958,1220959,1220957,1220976,1220977,1222262,1222263,1220962,1220963,1220960,1220961,1220966,1220967,1220964,1220965,1220971,1220968,1220969,1220974,1220975,1220972,1220973]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:42.084 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 29ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:42.089 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_397511
2023-11-16 08:59:42.089 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 34ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_397511
2023-11-16 08:59:42.101 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_397511
2023-11-16 08:59:42.101 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 11ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:42.101 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 397511 
2023-11-16 08:59:42.101  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 397511
2023-11-16 08:59:42.147 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 397511 
2023-11-16 08:59:42.153 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.153  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 32
2023-11-16 08:59:42.153 DEBUG 1 --- [99446_103335_32] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.161 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 13ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:42.162 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 397511 
2023-11-16 08:59:42.175 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 397511
2023-11-16 08:59:42.186 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [32, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (985825) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:42.190 DEBUG 1 --- [99446_103335_32] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_32
2023-11-16 08:59:42.190 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 37ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:42.190 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (102)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:42.191 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 37ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:42.194 DEBUG 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:42.195 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158843
2023-11-16 08:59:42.195 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 4ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158843
2023-11-16 08:59:42.200 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158843
2023-11-16 08:59:42.200 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158843
2023-11-16 08:59:42.205 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:42.243 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 158371
2023-11-16 08:59:42.244  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 158371
2023-11-16 08:59:42.244 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 158371 
2023-11-16 08:59:42.244 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 32
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:639]: No Data found for Sending Supplier Impact Notification for event_details_id : 99446
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:42.273  INFO 1 --- [99446_103335_32] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 32, Took : 3s
2023-11-16 08:59:42.273  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 158224 
2023-11-16 08:59:42.273  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:42.274 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:42.287 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 12ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:42.287 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.306 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [61, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 158371 and es.event_id = 19868330 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:42.306 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 61ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:42.311 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_158371
2023-11-16 08:59:42.311 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 5ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_158371
2023-11-16 08:59:42.315 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:42.315 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 158371 
2023-11-16 08:59:42.324 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 158224 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 158224), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =158224 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{1288795,1288796,1288797,1288798,1288799,1288800,1288801,1288802,1288803,1288804,1292922}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158224 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:42.326 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 38ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:42.326 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 158224 
2023-11-16 08:59:42.326 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.363  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 158843
2023-11-16 08:59:42.364 DEBUG 1 --- [6_103335_158843] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.375  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 158371
2023-11-16 08:59:42.375 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [48, with SITE_IDS as ( select unnest('{1288795,1288796,1288797,1288798,1288799,1288800,1288801,1288802,1288803,1288804,1292922}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 158224 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:42.375 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 158371 
2023-11-16 08:59:42.376 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 158224
2023-11-16 08:59:42.377 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 50ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:42.379 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 158371 
2023-11-16 08:59:42.379  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:42.379 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 158371 
2023-11-16 08:59:42.379 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 158371
2023-11-16 08:59:42.394 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[5357]
2023-11-16 08:59:42.395 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 15ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:42.395 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 1 for customer 158371
2023-11-16 08:59:42.395 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[5357]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158371
2023-11-16 08:59:42.399 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[5357]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158371
2023-11-16 08:59:42.399 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 4ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:42.399 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 158371 99446 user with No pref [5357]
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 158371 and eventId 99446
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 158371 99446
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 158371
2023-11-16 08:59:42.401  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 158371
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:42.401 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [158371] 
2023-11-16 08:59:42.404 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:42.405 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:42.405  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 158371, isUpdateAlert : true
2023-11-16 08:59:42.405  INFO 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.405 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:42.405  INFO 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.406 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"b4014785-fbe4-45bf-9f1e-05a573b8735e","eventId":19868330,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:42.407 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (102) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:42.408  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868330, tenantId : 158371
2023-11-16 08:59:42.408 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"b4014785-fbe4-45bf-9f1e-05a573b8735e","eventId":19868330,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41783
2023-11-16 08:59:42.408  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:42.408  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [1786, 40670, 992681, 2199, 7297, 1681, 2091, 17071, 153274, 2203, 2251, 37892, 7437, 608, 230372] 
2023-11-16 08:59:42.408 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.410 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_158843
2023-11-16 08:59:42.410 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 46ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:42.413 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:42.456 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (1786,40670,992681,2199,7297,1681,2091,17071,153274,2203,2251,37892,7437,608,230372)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:42.456 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 48ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:42.540 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.569 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (1786,40670,992681,2199,7297,1681,2091,17071,153274,2203,2251,37892,7437,608,230372)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:42.569 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 28ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:42.573 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158371
2023-11-16 08:59:42.573 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158371
2023-11-16 08:59:42.576 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158371
2023-11-16 08:59:42.577 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158371
2023-11-16 08:59:42.581 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:42.598 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 397511
2023-11-16 08:59:42.599  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 397511
2023-11-16 08:59:42.599 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 397511 
2023-11-16 08:59:42.599 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 158224, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868332 and EventDetID : 99446 
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 158224
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868332
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868332 and Event_Details ID : 99446 
2023-11-16 08:59:42.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:42.619 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:42.619 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:42.625 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 158224 -- Resulted rows -- [1]
2023-11-16 08:59:42.625 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 6ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:42.625 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 158224 : false : false : 19868332 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:42.643 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 158224
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 18ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 158224
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 158224
2023-11-16 08:59:42.644  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 158224
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 158224 
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 158224 
2023-11-16 08:59:42.644 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.645 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [45, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 397511 and es.event_id = 19868331 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:42.645 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 45ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:42.649 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_397511
2023-11-16 08:59:42.649 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 3ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_397511
2023-11-16 08:59:42.652 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 3ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:42.653 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 397511 
2023-11-16 08:59:42.655 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 105ms : for accumulator : {}
2023-11-16 08:59:42.655 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 158843
2023-11-16 08:59:42.666 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [21, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (158224,642574,642637,642461,637569,643946,629777,641724,644259,645550,632913,635986) and event_details_id = 99446] 
2023-11-16 08:59:42.670 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [?:?] : EVENT_DETAIL_99446_158224
2023-11-16 08:59:42.670 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 158224
2023-11-16 08:59:42.670 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 26ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:42.670  INFO 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [158224]
2023-11-16 08:59:42.673  INFO 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [158224]
2023-11-16 08:59:42.673 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158224 
2023-11-16 08:59:42.673 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158224 
2023-11-16 08:59:42.673 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.686 DEBUG 1 --- [6_103335_158843] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 158843
2023-11-16 08:59:42.687  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 158843
2023-11-16 08:59:42.687  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:42.687 DEBUG 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[102],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:42.688  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [102]
2023-11-16 08:59:42.688  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:42.688 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[102],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22841
2023-11-16 08:59:42.688  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:42.688  INFO 1 --- [6_103335_158843] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 158843, Took : 5s
2023-11-16 08:59:42.689  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 545592 
2023-11-16 08:59:42.689  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:42.689 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:42.701 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 158224 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (1288795,1288796,1288797,1288798,1288799,1288800,1288801,1288802,1288803,1288804,1292922)] 
2023-11-16 08:59:42.702 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 158224
2023-11-16 08:59:42.703 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 29ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:42.715  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 397511
2023-11-16 08:59:42.715 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 397511 
2023-11-16 08:59:42.717 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 397511 
2023-11-16 08:59:42.717  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:42.717 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 397511 
2023-11-16 08:59:42.718 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 397511
2023-11-16 08:59:42.732  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 158371
2023-11-16 08:59:42.732 DEBUG 1 --- [6_103335_158371] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.771 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.772 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (1786,40670,992681,2199,7297,1681,2091,17071,153274,2203,2251,37892,7437,608,230372) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:42.775 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_158371
2023-11-16 08:59:42.776 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 43ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:42.778 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:42.804 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[193689, 244082, 244084, 193684, 193690, 244067, 193688, 193679, 193683, 244083, 193694, 244069, 193687, 193681, 274259, 193678, 193692, 193698, 193696, 193682, 193685, 193693, 244076, 136166, 88191, 193686, 244075, 180332, 244074, 193680, 277909, 244079, 244068, 193677, 193699]
2023-11-16 08:59:42.804 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 86ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:42.804 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 35 for customer 397511
2023-11-16 08:59:42.804 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[193689, 244082, 244084, 193684, 193690, 244067, 193688, 193679, 193683, 244083, 193694, 244069, 193687, 193681, 274259, 193678, 193692, 193698, 193696, 193682, 193685, 193693, 244076, 136166, 88191, 193686, 244075, 180332, 244074, 193680, 277909, 244079, 244068, 193677, 193699]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}397511
2023-11-16 08:59:42.810 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, WITH SITE_IDS AS( SELECT UNNEST('{1288795,1288796,1288797,1288798,1288799,1288800,1288801,1288802,1288803,1288804,1292922}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[158224] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 158224 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:42.810 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 39ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:42.810 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 158224 
2023-11-16 08:59:42.828 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[193689, 244082, 244084, 193684, 193690, 244067, 193688, 193679, 193683, 244083, 193694, 244069, 193687, 193681, 274259, 193678, 193692, 193698, 193696, 193682, 193685, 193693, 244076, 136166, 88191, 193686, 244075, 180332, 244074, 193680, 277909, 244079, 244068, 193677, 193699]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}397511
2023-11-16 08:59:42.828 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 24ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:42.828 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 397511 99446 user with No pref [193689, 244082, 244084, 193684, 193690, 244067, 193688, 193679, 193683, 244083, 193694, 244069, 193687, 193681, 274259, 193678, 193692, 193698, 193696, 193682, 193685, 193693, 244076, 136166, 88191, 193686, 244075, 180332, 244074, 193680, 277909, 244079, 244068, 193677, 193699]
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 397511 and eventId 99446
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 397511 99446
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 397511
2023-11-16 08:59:42.830  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 397511
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:42.830 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [397511] 
2023-11-16 08:59:42.834 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:42.834 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 4ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:42.834  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 397511, isUpdateAlert : true
2023-11-16 08:59:42.834  INFO 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.835 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:42.835  INFO 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.836 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"8e857ebd-f819-4512-b11f-64fa37703cbb","eventId":19868331,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:42.837  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868331, tenantId : 397511
2023-11-16 08:59:42.837 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"8e857ebd-f819-4512-b11f-64fa37703cbb","eventId":19868331,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41784
2023-11-16 08:59:42.837  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:42.837  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [90137, 90166, 90182, 90261, 90581, 91075, 91085, 91245, 91277, 91317, 91350, 91364, 91550, 91588, 91913, 92183, 92258, 92275, 92315, 92375, 92536, 92763, 92871, 92961, 93396, 93486, 93500, 94337, 94392] 
2023-11-16 08:59:42.838 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.883 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 193ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:42.883 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.895 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [57, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (90137,90166,90182,90261,90581,91075,91085,91245,91277,91317,91350,91364,91550,91588,91913,92183,92258,92275,92315,92375,92536,92763,92871,92961,93396,93486,93500,94337,94392)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:42.895 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 57ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:42.918 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 545592 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 545592), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =545592 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{292887,532614,538237,1557794}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 545592 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:42.919 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 35ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:42.919 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 545592 
2023-11-16 08:59:42.919 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.919 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 480856 99446 [175104, 239492, 277379, 235274, 173456, 253463, 253844, 175128, 175004, 250013, 175133, 258982, 242597, 175019, 219820, 235308, 254259, 192448, 161990, 201286, 213188, 175307, 175052, 175059, 277974, 175067, 175195, 205401, 191972, 242025, 219887, 242286, 280561, 240120, 193916]
2023-11-16 08:59:42.919 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 11440ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:42.920 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 480856 99446 [175104, 239492, 277379, 235274, 173456, 253463, 253844, 175128, 175004, 250013, 175133, 258982, 242597, 175019, 219820, 235308, 254259, 192448, 161990, 201286, 213188, 175307, 175052, 175059, 277974, 175067, 175195, 205401, 191972, 242025, 219887, 242286, 280561, 240120, 193916]
2023-11-16 08:59:42.932 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 480856 99446 [175104, 239492, 277379, 235274, 173456, 253463, 253844, 175128, 175004, 250013, 175133, 258982, 242597, 175019, 219820, 235308, 254259, 192448, 161990, 201286, 213188, 175307, 175052, 175059, 277974, 175067, 175195, 205401, 191972, 242025, 219887, 242286, 280561, 240120, 193916]
2023-11-16 08:59:42.932 DEBUG 1 --- [     Thread-376] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 12ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:42.932 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 480856 and eventId 99446 and userIds [175104, 239492, 277379, 235274, 173456, 253463, 253844, 175128, 175004, 250013, 175133, 258982, 242597, 175019, 219820, 235308, 254259, 192448, 161990, 201286, 213188, 175307, 175052, 175059, 277974, 175067, 175195, 205401, 191972, 242025, 219887, 242286, 280561, 240120, 193916]
2023-11-16 08:59:42.933 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 480856 and eventId : 99446 
2023-11-16 08:59:42.933 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:42.934 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 158224
2023-11-16 08:59:42.934 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 123ms : for accumlator : {}
2023-11-16 08:59:42.934 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 158224 
2023-11-16 08:59:42.938 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_158224
2023-11-16 08:59:42.938 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_158224
2023-11-16 08:59:42.938 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.947 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 28
2023-11-16 08:59:42.947 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 14ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:42.948 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 480856 99446
2023-11-16 08:59:42.948 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 480856
2023-11-16 08:59:42.948  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 480856
2023-11-16 08:59:42.948 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:42.948 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [480856] 
2023-11-16 08:59:42.950 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:42.950 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 2ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:42.950  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 480856, isUpdateAlert : true
2023-11-16 08:59:42.950  INFO 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.951 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:42.951  INFO 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:42.951 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"411bc127-4575-4429-b6e1-eac45f40a0e7","eventId":19868316,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:42.953  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868316, tenantId : 480856
2023-11-16 08:59:42.953 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"411bc127-4575-4429-b6e1-eac45f40a0e7","eventId":19868316,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41785
2023-11-16 08:59:42.953  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:42.953  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [29622, 1788, 561172, 832, 6437, 585596, 1382, 1405, 732, 1402, 1587] 
2023-11-16 08:59:42.953 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.963 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, with SITE_IDS as ( select unnest('{292887,532614,538237,1557794}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 545592 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:42.963 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.964 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 545592
2023-11-16 08:59:42.964 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 45ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:42.969 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [30, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 158224 and total_cpns != '{}' and site_private_id = any('{33109905,33110109,33121319,33121320,33121321,33121322,33121323,33121324,33121325,33121326,33124708}')] 
2023-11-16 08:59:42.973 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_158224
2023-11-16 08:59:42.973 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 34ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:42.973 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:42.987 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (29622,1788,561172,832,6437,585596,1382,1405,732,1402,1587)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:42.988 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 34ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:42.994 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (90137,90166,90182,90261,90581,91075,91085,91245,91277,91317,91350,91364,91550,91588,91913,92183,92258,92275,92315,92375,92536,92763,92871,92961,93396,93486,93500,94337,94392)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:42.994 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 31ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:42.998 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_397511
2023-11-16 08:59:42.998 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 3ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_397511
2023-11-16 08:59:43.003 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_397511
2023-11-16 08:59:43.003 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 4ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_397511
2023-11-16 08:59:43.007 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[33121321,33121320,33121323,33121322,33110109,33121325,33121324,33121326,33109905,33124708,33121319]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:43.007 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 34ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:43.007 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 4ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:43.011 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_158224
2023-11-16 08:59:43.012 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 38ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_158224
2023-11-16 08:59:43.025 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_158224
2023-11-16 08:59:43.025 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 13ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:43.025 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 158224
2023-11-16 08:59:43.082 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.084 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 158224 
2023-11-16 08:59:43.084 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 158224 
2023-11-16 08:59:43.084 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 158224 
2023-11-16 08:59:43.084 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.116 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [34, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (29622,1788,561172,832,6437,585596,1382,1405,732,1402,1587)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:43.117 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 35ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:43.121 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_480856
2023-11-16 08:59:43.121 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 4ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_480856
2023-11-16 08:59:43.122 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868332 and tenant_id = 158224] 
2023-11-16 08:59:43.122 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 37ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:43.125 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_480856
2023-11-16 08:59:43.125 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 3ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_480856
2023-11-16 08:59:43.130 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 5ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:43.175 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 545592, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868333 and EventDetID : 99446 
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 545592
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868333
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868333 and Event_Details ID : 99446 
2023-11-16 08:59:43.176 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:43.177 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:43.177 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:43.194 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 545592 -- Resulted rows -- [1]
2023-11-16 08:59:43.194 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 16ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:43.194 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 545592 : false : false : 19868333 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:43.200 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_158224
2023-11-16 08:59:43.200 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_158224
2023-11-16 08:59:43.206 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 181ms : for accumulator : {}
2023-11-16 08:59:43.206 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 158371
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 545592
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 45ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 545592
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 545592
2023-11-16 08:59:43.239  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 545592
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 545592 
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 545592 
2023-11-16 08:59:43.239 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.240 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_158224
2023-11-16 08:59:43.240 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 39ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:43.251 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 11ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:43.252 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 158224 
2023-11-16 08:59:43.276 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (545592,292,111,270,2956) and event_details_id = 99446] 
2023-11-16 08:59:43.279 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_545592
2023-11-16 08:59:43.279 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 545592
2023-11-16 08:59:43.279 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 40ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:43.279  INFO 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [545592]
2023-11-16 08:59:43.280  INFO 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [545592]
2023-11-16 08:59:43.280 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 545592 
2023-11-16 08:59:43.280 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 545592 
2023-11-16 08:59:43.280 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.312 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 545592 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (292887,532614,538237,1557794)] 
2023-11-16 08:59:43.315 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 545592
2023-11-16 08:59:43.315 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 34ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:43.322  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 397511
2023-11-16 08:59:43.322 DEBUG 1 --- [6_103335_397511] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.329  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 480856
2023-11-16 08:59:43.329 DEBUG 1 --- [6_103335_480856] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.362 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (90137,90166,90182,90261,90581,91075,91085,91245,91277,91317,91350,91364,91550,91588,91913,92183,92258,92275,92315,92375,92536,92763,92871,92961,93396,93486,93500,94337,94392) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:43.366 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [37, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (29622,1788,561172,832,6437,585596,1382,1405,732,1402,1587) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:43.367 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_397511
2023-11-16 08:59:43.367 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 44ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:43.370 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:43.370 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_480856
2023-11-16 08:59:43.370 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 41ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:43.374 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 3ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:43.377 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.428 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [50, WITH SITE_IDS AS( SELECT UNNEST('{292887,292887,532614,532614,538237,1557794}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[545592] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 545592 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:43.428 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 51ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:43.428 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 545592 
2023-11-16 08:59:43.537 DEBUG 1 --- [6_103335_158371] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 158371
2023-11-16 08:59:43.538  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 158371
2023-11-16 08:59:43.539  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:43.539 DEBUG 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[37892,608,7437,2199,2251,7297,1681,2091,17071,2203],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:43.540  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [37892, 608, 7437, 2199, 2251, 7297, 1681, 2091, 17071, 2203]
2023-11-16 08:59:43.540 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[37892,608,7437,2199,2251,7297,1681,2091,17071,2203],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22842
2023-11-16 08:59:43.541  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:43.541  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:43.541  INFO 1 --- [6_103335_158371] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 158371, Took : 5s
2023-11-16 08:59:43.541  INFO 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1100997 
2023-11-16 08:59:43.541  INFO 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:43.542 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:43.738 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 545592
2023-11-16 08:59:43.738 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 309ms : for accumlator : {}
2023-11-16 08:59:43.738 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 545592 
2023-11-16 08:59:43.742 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_545592
2023-11-16 08:59:43.742 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_545592
2023-11-16 08:59:43.742 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.768 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 545592 and total_cpns != '{}' and site_private_id = any('{27325367,31193204,50961298,51644498}')] 
2023-11-16 08:59:43.772 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_545592
2023-11-16 08:59:43.772 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 29ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:43.772 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.793 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [21, with SITEID as( select * from ( select unnest(array[51644498,27325367,50961298,31193204]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:43.794 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 21ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:43.797 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_545592
2023-11-16 08:59:43.797 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 25ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_545592
2023-11-16 08:59:43.809 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_545592
2023-11-16 08:59:43.809 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 11ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:43.809 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 545592
2023-11-16 08:59:43.817 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 545592 
2023-11-16 08:59:43.817 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 545592 
2023-11-16 08:59:43.817 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 545592 
2023-11-16 08:59:43.817 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:43.842 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868333 and tenant_id = 545592] 
2023-11-16 08:59:43.843 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 25ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:43.868 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:697]: Time taken : 80ms : for accumulator : {}
2023-11-16 08:59:43.868 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 480856
2023-11-16 08:59:43.902 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_545592
2023-11-16 08:59:43.902 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_545592
2023-11-16 08:59:43.913 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_545592
2023-11-16 08:59:43.913 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:43.914 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [?:?] : [createEventUserForPartner:697]: Time taken : 83ms : for accumulator : {}
2023-11-16 08:59:43.914 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1764]: Writing records into 'event_user' -- for Customer tenant_id -- 397511
2023-11-16 08:59:43.923 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 9ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:43.924 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 545592 
2023-11-16 08:59:43.960 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 158224
2023-11-16 08:59:43.967 DEBUG 1 --- [6_103335_397511] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 397511
2023-11-16 08:59:43.968  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 397511
2023-11-16 08:59:43.968  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:43.969 DEBUG 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[92871,90166,92183,91913,92375,90581,92315,93396,92275,90182,92763,92258,91317,93500,91085,91350,90261,92961,91550,91245,91277,91588,93486,90137,92536,91364,91075],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:43.970  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [92871, 90166, 92183, 91913, 92375, 90581, 92315, 93396, 92275, 90182, 92763, 92258, 91317, 93500, 91085, 91350, 90261, 92961, 91550, 91245, 91277, 91588, 93486, 90137, 92536, 91364, 91075]
2023-11-16 08:59:43.971  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:43.970 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[92871,90166,92183,91913,92375,90581,92315,93396,92275,90182,92763,92258,91317,93500,91085,91350,90261,92961,91550,91245,91277,91588,93486,90137,92536,91364,91075],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22843
2023-11-16 08:59:43.971  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:43.971  INFO 1 --- [6_103335_397511] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 397511, Took : 4s
2023-11-16 08:59:43.971  INFO 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 248170 
2023-11-16 08:59:43.971  INFO 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:43.973 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 1ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:44.010 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 158224
2023-11-16 08:59:44.011  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 158224
2023-11-16 08:59:44.011 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 158224 
2023-11-16 08:59:44.014 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 40ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:44.014 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.016 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:44.016 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 158224 
2023-11-16 08:59:44.016  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 158224
2023-11-16 08:59:44.016 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 158224 
2023-11-16 08:59:44.016 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 158224 
2023-11-16 08:59:44.016 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.042 DEBUG 1 --- [6_103335_480856] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForPartner:1769]: Done Writing records into 'event_user' -- for Customer tenant_id -- 480856
2023-11-16 08:59:44.043  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:524]: Done replicating event_user for partner with tenant_id : 480856
2023-11-16 08:59:44.044  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:624]: Sending Supplier Impact Notification for event_id : 99446 and writeupId : 103335
2023-11-16 08:59:44.044 DEBUG 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendPartnerImpact:631]: SIN KafkaObject : {"eventId":99446,"affectedPartners":[1405,1402,732,1788,6437,29622,1382,832,1587],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}
2023-11-16 08:59:44.046  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendPartnerImpact:635]: Done Sending Supplier Impact Notification for event_id : 99446 with no. of Supplier(s) [1405, 1402, 732, 1788, 6437, 29622, 1382, 832, 1587]
2023-11-16 08:59:44.046 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"eventId":99446,"affectedPartners":[1405,1402,732,1788,6437,29622,1382,832,1587],"emailType":"supplierImpactNotification","writeupId":103335,"isUpdate":true}' partition 0 with offset=22844
2023-11-16 08:59:44.046  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:44.046  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:44.046  INFO 1 --- [6_103335_480856] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 480856, Took : 18s
2023-11-16 08:59:44.046  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1145805 
2023-11-16 08:59:44.046  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:44.047 DEBUG 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:44.050 DEBUG 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchors:928]: Time taken : 2ms : for query : select distinct site_anchor_id from site_private where is_deleted = false and tenant_id = ? and site_anchor_id = ANY('{%s}'::BIGINT[])
2023-11-16 08:59:44.050 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1145805, isWhatIf : false, isALert : false, hasSites : true, isupdate : true
2023-11-16 08:59:44.050 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : null and EventDetID : 99446 
2023-11-16 08:59:44.050 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1145805
2023-11-16 08:59:44.051 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868335
2023-11-16 08:59:44.051 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.051 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : null and Event_Details ID : 99446 
2023-11-16 08:59:44.051 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:44.051 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.053 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: true, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:44.055 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1145805 -- Resulted rows -- [1]
2023-11-16 08:59:44.056 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set  SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false,   is_alert = ?, is_deleted = false  where id = ? and tenant_id = ?
2023-11-16 08:59:44.056 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1145805 : null : null : 19868335 : Update published
2023-11-16 08:59:44.058 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1145805
2023-11-16 08:59:44.059 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 2ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:44.059 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1145805
2023-11-16 08:59:44.059  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1145805
2023-11-16 08:59:44.059  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:414]: Site details not exists for tenant_id : 1145805 
2023-11-16 08:59:44.059 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 4, metaData : null
2023-11-16 08:59:44.059 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [1145805] 
2023-11-16 08:59:44.062 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:44.062 DEBUG 1 --- [_103335_1145805] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:44.062 DEBUG 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 1145805 
2023-11-16 08:59:44.063 DEBUG 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 1145805 
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : true, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : true 
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1145805] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 1145805, Took : 0s
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 1210151 
2023-11-16 08:59:44.063  INFO 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:44.064 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
2023-11-16 08:59:44.080 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [65, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 248170 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 248170), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =248170 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{775900,776210}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 248170 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:44.082 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 67ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:44.082 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 248170 
2023-11-16 08:59:44.082 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.096 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [80, with SITE_IDS as(select unnest('{33131272,33135514,33140168,33142964,33143935,33148365,33149870,33150435,33154827,33155414,33155730}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[158224] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:44.097 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 80ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:44.097 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 158224
2023-11-16 08:59:44.106 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, with SITE_IDS as ( select unnest('{775900,776210}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 248170 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:44.108 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 248170
2023-11-16 08:59:44.108 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 26ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:44.143 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 78ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:44.143 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.159 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [15, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1210151 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1210151), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1210151 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{2512660,2512672,2512718,2512961,2512974,2513075,2513129}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1210151 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:44.160 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 17ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:44.161 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1210151 
2023-11-16 08:59:44.161 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.175 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [13, with SITE_IDS as ( select unnest('{2512660,2512672,2512718,2512961,2512974,2513075,2513129}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1210151 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:44.176 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1210151
2023-11-16 08:59:44.176 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 15ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:44.352 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [getSiteAnchorsForUpdate:853]: Time taken : 809ms : for query : with site_private_data as( select sp.id, sp.site_anchor_id from site_private sp where is_deleted = false and tenant_id = ? and site_anchor_id = any('{%s}'::bigint[])) select distinct sp.site_anchor_id from site_private_data sp left join event_site es on es.is_deleted = false and es.event_id = ? and es.tenant_id = ? and es.site_private_id = sp.id and es.created_date <( select publish_date from event_writeup ew where ew.event_details_id = ? and ew.selected_sites != '{}' order by publish_date desc limit 1) where es.event_id is null;
2023-11-16 08:59:44.352 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.377 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 248170, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:44.377 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868336 and EventDetID : 99446 
2023-11-16 08:59:44.377 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 248170
2023-11-16 08:59:44.378 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868336
2023-11-16 08:59:44.378 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.378 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868336 and Event_Details ID : 99446 
2023-11-16 08:59:44.378 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:44.378 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.379 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:44.383 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 248170 -- Resulted rows -- [1]
2023-11-16 08:59:44.383 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:44.383 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 248170 : false : false : 19868336 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:44.390 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = 1100997 union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = 1100997), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =1100997 and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{30144,37163,2381262}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1100997 and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId] 
2023-11-16 08:59:44.392 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerSiteDs:960]: Time taken : 39ms : for query : with normalized_tenants as ( select distinct normalized_tenant_id tenant_id, is_deleted from rcm_subtier rs where (is_deleted = false or is_deleted is null) and customer_tenant_id = %s union select distinct company_provided_tenant_id tenant_id, is_deleted from resilinc_company_mapping rcm where (is_deleted = false or is_deleted is null) and resilinc_company_name = %s), SITE_IDS as (select array_agg(distinct site_anchor_id) as value, is_deleted from site_shareable where is_deleted = false and tenant_id =%s and protected_by_eventwatch = true and case when source_id = 1 then true else best_original_row = true end and site_anchor_id = any('{%s}'::bigint[]) group by is_deleted) select distinct on (SP.ID) SP.ID as siteId, SP.TENANT_ID as tenantId, sp.site_anchor_id as siteAnchorId from SITE_PRIVATE as SP inner join ( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = any(SITE_IDS.VALUE) inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id ) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID = TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID inner join site_shareable ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_anchor_id = sp.site_anchor_id and ss.protected_by_eventwatch=true and case when ss.source_id = 1 then true else best_original_row = true end inner join normalized_tenants nt on nt.is_deleted = false and nt.tenant_id = sp.tenant_id order by siteId, tenantId
2023-11-16 08:59:44.392 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:974]: executing query to get sub tier site anchors shared with customers and tier ones for tenant_id : 1100997 
2023-11-16 08:59:44.392 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 248170
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 11ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 248170
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 248170
2023-11-16 08:59:44.395  INFO 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 248170
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 248170 
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 248170 
2023-11-16 08:59:44.395 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.432 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (248170,6090,249470) and event_details_id = 99446] 
2023-11-16 08:59:44.433 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [40, with SITE_IDS as ( select unnest('{30144,37163,2381262}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = 1100997 and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID] 
2023-11-16 08:59:44.434 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:987]: Done : executing query to get sub tier site anchors shared with customers and tier ones  for tenant_id : 1100997
2023-11-16 08:59:44.434 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteDs:991]: Time taken : 41ms : for query : with SITE_IDS as ( select unnest('{%s}'::bigint[]) as value, false as IS_DELETED) select distinct SP.SITE_ANCHOR_ID as SITE_ANCHOR_ID from SITE_PRIVATE as SP inner join( select distinct sp.site_owner_tenant_id, sp.SITE_ANCHOR_ID as SITE_ANCHOR_ID from site_private sp inner join SITE_IDS on sp.is_deleted = false and sp.tenant_id = %s and sp.SITE_ANCHOR_ID = SITE_IDS.VALUE inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = sp.tenant_id and ss.site_private_id = sp.id) as TEMP_S on SP.is_deleted = false and SP.TENANT_ID != TEMP_S.site_owner_tenant_id and SP.SITE_ANCHOR_ID = TEMP_S.SITE_ANCHOR_ID
2023-11-16 08:59:44.435 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_248170
2023-11-16 08:59:44.435 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 248170
2023-11-16 08:59:44.435 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 39ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:44.435  INFO 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [248170]
2023-11-16 08:59:44.436  INFO 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [248170]
2023-11-16 08:59:44.436 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 248170 
2023-11-16 08:59:44.436 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 248170 
2023-11-16 08:59:44.436 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.454 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [18, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 248170 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (775900,776210)] 
2023-11-16 08:59:44.456 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 248170
2023-11-16 08:59:44.456 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 19ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:44.468 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_158224
2023-11-16 08:59:44.469 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_158224
2023-11-16 08:59:44.469 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.481 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1210151, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:44.481 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868337 and EventDetID : 99446 
2023-11-16 08:59:44.481 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1210151
2023-11-16 08:59:44.481 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868337
2023-11-16 08:59:44.482 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.482 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868337 and Event_Details ID : 99446 
2023-11-16 08:59:44.482 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:44.482 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.485 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:44.487 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1210151 -- Resulted rows -- [1]
2023-11-16 08:59:44.487 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 2ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:44.487 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1210151 : false : false : 19868337 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:44.490 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1210151
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 3ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1210151
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1210151
2023-11-16 08:59:44.491  INFO 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1210151
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1210151 
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1210151 
2023-11-16 08:59:44.491 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.498 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [29, with SITEID as( select * from ( select unnest(array[33131272,33140168,33154827,33135514,33148365,33143935,33149870,33150435,33155730,33142964,33155414]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:44.499 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 30ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:44.502 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158224
2023-11-16 08:59:44.502 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 33ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_158224
2023-11-16 08:59:44.504 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.512 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_158224
2023-11-16 08:59:44.512 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 9ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:44.512 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 158224 
2023-11-16 08:59:44.512  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 158224
2023-11-16 08:59:44.520 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1210151,304,342,156914,308) and event_details_id = 99446] 
2023-11-16 08:59:44.523 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1210151
2023-11-16 08:59:44.523 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1210151
2023-11-16 08:59:44.524 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 32ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:44.524  INFO 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1210151]
2023-11-16 08:59:44.524  INFO 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1210151]
2023-11-16 08:59:44.525 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1210151 
2023-11-16 08:59:44.525 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1210151 
2023-11-16 08:59:44.525 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.549 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [24, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1210151 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (2512660,2512672,2512718,2512961,2512974,2513075,2513129)] 
2023-11-16 08:59:44.551 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1210151
2023-11-16 08:59:44.551 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 26ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:44.560 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [55, WITH SITE_IDS AS( SELECT UNNEST('{775900,776210}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[248170] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 248170 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:44.560 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 56ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:44.560 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 248170 
2023-11-16 08:59:44.564 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:271]: Writing into 'event_shareable' -- for tenant_id : 1100997, isWhatIf : false, isALert : false, hasSites : false, isupdate : true
2023-11-16 08:59:44.564 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:290]: For updated events : ID : 19868334 and EventDetID : 99446 
2023-11-16 08:59:44.564 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1824]: checking event exist with params : eventDetailId : 99446, tenantId : 1100997
2023-11-16 08:59:44.565 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1832]: Resulted event_id : 19868334
2023-11-16 08:59:44.565 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [checkEventExist:1834]: Time taken : 0ms : for query : select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.565 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:294]: For updated - Event Already Exists : Event_Shareable ID : 19868334 and Event_Details ID : 99446 
2023-11-16 08:59:44.565 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1852]: fetching is_alert value for event params : 99446
2023-11-16 08:59:44.565 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [getIsAlertFromEvent:1859]: Time taken : 0ms : for query : select is_alert from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false
2023-11-16 08:59:44.566 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2085]: flag values : hasNoSites: false, eventShareable.isSendPartnerImpactNotification: true, eventShareable.getAffectedRegion(): SRID=4326;MULTIPOLYGON(((35.14575672140135 30.23268504820912,35.145313748560596 30.228150195020174,35.15590507125859 30.108153141699137,35.111593490600626 30.01522742837303,35.07927526092533 29.948178397376356,35.09058196640017 29.895589867896494,35.0413036785126 29.80972401131604,35.01941111660004 29.735764264942826,35.01601793622972 29.69578163051015,35.02256109213829 29.66981830962408,35.01759292399885 29.640125202221345,34.98214985555412 29.59184425428932,34.9796657714844 29.54115068785875,34.906671875000015 29.497057891553712,34.86674169921876 29.57896344225215,34.66587170410154 30.21842975823892,34.5603630552212 30.421114922909144,34.552153320312506 30.4246665868378,34.555278969126476 30.430881599274002,34.55445037841795 30.432473345978984,34.44852221679686 30.75468390210463,34.17074792480468 31.447438402304034,34.370878906250006 32.19091030751971,34.99962950643395 32.951962770449384,35.046538085937506 33.04684529329276,35.084282485863056 33.05442845154776,35.117949218750006 33.09517934701396,35.28171417236329 33.105245599042895,35.39604064941407 33.073892619033366,35.48736450195313 33.09863076330063,35.505217285156256 33.1204865857114,35.55153561767386 33.25919983124088,35.550830871582015 33.26390651793022,35.55309965532087 33.26388378090734,35.557402343750006 33.27676938891753,35.733183593750006 33.33186138255204,35.826767333984364 33.35356620563527,35.87640576171872 33.23753898180406,35.88779199218748 33.00502227010063,35.850793014526374 32.860677493124925,35.83641339874267 32.819582686512774,35.750622650146475 32.74151328661612,35.61070672607418 32.66008182023258,35.57378762817379 32.61906926131642,35.58081384277341 32.54099935382164,35.567240692138654 32.52888318224268,35.57144044494629 32.492713316486395,35.57014703369139 32.41016572553072,35.58145288085938 32.32557256073629,35.54427880859373 32.05161494826221,35.55379663085938 31.720780495925638,35.44905938720701 31.239513227076134,35.443199096679685 30.99152049901693,35.387900329589854 30.92212006007925,35.331503616333 30.79983469791822,35.231161590576185 30.613592893665928,35.18547671890264 30.431195135364366,35.178243995666556 30.338574285008672,35.14575672140135 30.23268504820912))), eventShareable.getSelectionTypes(): [polygon]eventShareable.getSeverity(): High
2023-11-16 08:59:44.569 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2130]: Done -- updating records into 'event_shareable' -- for Customer tenant_id -- 1100997 -- Resulted rows -- [1]
2023-11-16 08:59:44.569 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareableForCustomer:2133]: Time taken : 3ms : for query : update event_shareable set SEND_CUSTOMER_IMPACT_NOTIFICATION = true, CUSTOMER_IMPACT_NOTIFICATION_SENT = false, SEND_PARTNER_IMPACT_NOTIFICATION = true, PARTNER_IMPACT_NOTIFICATION_SENT = false, event_modified_date = now(), SEVERITY= case when EVENT_SHAREABLE.overridden_severity = true then EVENT_SHAREABLE.SEVERITY ELSE ?::event_severity END, is_alert = ?, is_deleted = false , status = case when EVENT_SHAREABLE.status = 'Closed' then 'New' ELSE event_shareable.status END where id = ? and tenant_id = ?
2023-11-16 08:59:44.569 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1874]: inserting records into 'event_timeline' -- for Customer tenant_id -- 1100997 : false : false : 19868334 : WarRoom Updated : New Regions/Sites added
2023-11-16 08:59:44.576 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 158224 
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1908]: Done inserting records into 'event_timeline' -- for Customer tenant_id -- 1100997
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertIntoEventTimeline:1911]: Time taken : 7ms : for query : INSERT INTO EVENT_TIMELINE(event_id, previous_value, new_value, operation, record_name, record_id, record_table_name, updated_by_tenant, created_by_id, last_modified_by_id, tenant_id) values ( ?::BIGINT, ?::text, ?::text, ?:: text, ?::text, ?::BIGINT, ?::text, ?::text, ?::bigint, ?::bigint, ?::bigint)
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventShareableForExistingTenant:367]: Event Timeline is WARROOM_UPDATED because previouse state is_alert = false and new state is_alert =false are same for event_id 99446 and tenant_id 1100997
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventShareable:342]: Done Writing into 'event_shareable' -- for tenant_id -- 1100997
2023-11-16 08:59:44.577  INFO 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:357]: Done replicating event_shareable for tenant_id : 1100997
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1053]: Replicating Customer entities for tenant_id : 1100997 
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1092]: executing query to get event detail as Spark View for tenant_id : 1100997 
2023-11-16 08:59:44.577 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.582 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:44.582 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 158224 
2023-11-16 08:59:44.586 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 545592
2023-11-16 08:59:44.592 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 158224
2023-11-16 08:59:44.592 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.602 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [25, select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (1100997,292,1449,1123155) and event_details_id = 99446] 
2023-11-16 08:59:44.606 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_DETAIL_99446_1100997
2023-11-16 08:59:44.606 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1110]: Done : executing query to get event detail as Spark View for tenant_id : 1100997
2023-11-16 08:59:44.606 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventDetailViewForCustomer:1113]: Time taken : 28ms : for query : select distinct tenant_id, id as event_id from event_shareable where is_deleted = false and tenant_id in (%s) and event_details_id = %s
2023-11-16 08:59:44.606  INFO 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Site Anchors Ids for tenantId - [1100997]
2023-11-16 08:59:44.607  INFO 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Site Anchors Ids for tenantId - [1100997]
2023-11-16 08:59:44.607 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1126]: Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1100997 
2023-11-16 08:59:44.607 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1167]: executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1100997 
2023-11-16 08:59:44.607 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.627 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 545592
2023-11-16 08:59:44.627  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 545592
2023-11-16 08:59:44.627 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 545592 
2023-11-16 08:59:44.632 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 4ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:44.632 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 545592 
2023-11-16 08:59:44.632  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 545592
2023-11-16 08:59:44.632 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 545592 
2023-11-16 08:59:44.632 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 545592 
2023-11-16 08:59:44.632 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.632 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, WITH SITE_IDS AS( SELECT UNNEST('{2512660,2512672,2512718,2512961,2512974,2513075,2513129}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1210151] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1210151 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:44.633 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 40ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:44.633 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1210151 
2023-11-16 08:59:44.640 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = 1100997 AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (30144,37163,2381262)] 
2023-11-16 08:59:44.642 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1175]: Done : executing query to get customer site_anchor_id(s) as Ds for tenant_id : 1100997
2023-11-16 08:59:44.642 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerAnchorIdDs:1179]: Time taken : 34ms : for query : select site_anchor_id as site_anchor_id from site_shareable ss where is_deleted = false and tenant_id = %s AND case when ss.source_id = 1 then true else ss.best_original_row = true end and ss.protected_by_eventwatch = true and site_anchor_id in (%s)
2023-11-16 08:59:44.661 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 248170
2023-11-16 08:59:44.662 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 100ms : for accumlator : {}
2023-11-16 08:59:44.662 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 248170 
2023-11-16 08:59:44.666 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_248170
2023-11-16 08:59:44.666 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_248170
2023-11-16 08:59:44.666 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.672 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, with SITE_IDS as(select unnest('{1208224,3611810,3616947,46719674}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[545592] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:44.672 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 40ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:44.672 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 545592
2023-11-16 08:59:44.694 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [27, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 248170 and total_cpns != '{}' and site_private_id = any('{7121986,7142829}')] 
2023-11-16 08:59:44.697 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_248170
2023-11-16 08:59:44.697 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 31ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:44.698 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.704 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.731 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [33, with SITEID as( select * from ( select unnest(array[7142829,7121986]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:44.731 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 33ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:44.734 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_248170
2023-11-16 08:59:44.734 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 36ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_248170
2023-11-16 08:59:44.744 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_248170
2023-11-16 08:59:44.745 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 10ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:44.745 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 248170
2023-11-16 08:59:44.746 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, WITH SITE_IDS AS( SELECT UNNEST('{30144,37163,37163,2381262,2381262}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, 157408::bigint AS created_by_id, 157408::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[1100997] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = 1100997 AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID] 
2023-11-16 08:59:44.747 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDs:1204]: Time taken : 42ms : for query : WITH SITE_IDS AS( SELECT UNNEST('{%s}'::bigint[]) AS site_anchor_id, FALSE AS IS_DELETED) SELECT DISTINCT SP.Id AS SITE_ID, CS.COMPANY_PRIVATE_ID AS COMPANY_ID, SP.SITE_ANCHOR_ID AS SITE_ANCHOR_ID, SP.TENANT_ID, cs.owner_tenant_id, 'weeks'::time_unit AS down_time_unit, %s::bigint AS created_by_id, %s::bigint AS last_modified_by_id, 'Potential'::event_impact_status AS impact_status, 'Pending'::impact_notification_status AS impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate FROM SITE_IDS INNER JOIN SITE_PRIVATE SP ON SITE_IDS.is_deleted = FALSE AND sp.is_deleted = FALSE AND sp.tenant_id = %s AND sp.SITE_ANCHOR_ID = SITE_IDS.site_anchor_id INNER JOIN SITE_SUMMARY SS ON SS.IS_DELETED = FALSE AND SS.TENANT_ID = SP.TENANT_ID AND SS.SITE_PRIVATE_ID = SP.ID INNER JOIN COMPANY_SUMMARY CS ON CS.IS_DELETED = FALSE AND CS.TENANT_ID = SS.TENANT_ID AND CS.ID = SS.COMPANY_SUMMARY_ID AND cs.COMPANY_PRIVATE_ID = SS.COMPANY_PRIVATE_ID
2023-11-16 08:59:44.747 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1218]: executing query of getting customer site Ids Dataset for tenant_id : 1100997 
2023-11-16 08:59:44.753 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 248170 
2023-11-16 08:59:44.753 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 248170 
2023-11-16 08:59:44.753 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 248170 
2023-11-16 08:59:44.753 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.767 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1210151
2023-11-16 08:59:44.767 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 134ms : for accumlator : {}
2023-11-16 08:59:44.767 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1210151 
2023-11-16 08:59:44.771 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1210151
2023-11-16 08:59:44.771 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 4ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1210151
2023-11-16 08:59:44.771 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.816 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [62, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868336 and tenant_id = 248170] 
2023-11-16 08:59:44.816 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 63ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:44.823 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [51, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1210151 and total_cpns != '{}' and site_private_id = any('{87257243,87257253,87257296,87257537,87257549,87257646,87257694}')] 
2023-11-16 08:59:44.828 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1210151
2023-11-16 08:59:44.828 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 56ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:44.828 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.863 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1236]: executing query of getting customer site Ids Dataset for tenant_id : 1100997
2023-11-16 08:59:44.863 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerSiteList:1239]: Time taken : 116ms : for accumlator : {}
2023-11-16 08:59:44.864 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1254]: Creating Views required for all entities of Customer for tenant_id : 1100997 
2023-11-16 08:59:44.867 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_CUSTOMER_DATA_SET_99446_1100997
2023-11-16 08:59:44.868 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1263]: Time taken : 3ms : for Sparkview : EVENT_CUSTOMER_DATA_SET_99446_1100997
2023-11-16 08:59:44.868 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.868 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [39, with SITEID as( select * from ( select unnest(array[87257537,87257296,87257253,87257243,87257646,87257694,87257549]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:44.868 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 40ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:44.871 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1210151
2023-11-16 08:59:44.872 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 43ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1210151
2023-11-16 08:59:44.884 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1210151
2023-11-16 08:59:44.884 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 12ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:44.884 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1210151
2023-11-16 08:59:44.892 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1210151 
2023-11-16 08:59:44.892 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1210151 
2023-11-16 08:59:44.892 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1210151 
2023-11-16 08:59:44.892 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.898 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_248170
2023-11-16 08:59:44.898 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_248170
2023-11-16 08:59:44.900 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_DATA_SET_99446_545592
2023-11-16 08:59:44.900 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1596]: Time taken : 4ms : for Sparkview : EVENT_PARTNER_DATA_SET_99446_545592
2023-11-16 08:59:44.901 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.912 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_248170
2023-11-16 08:59:44.913 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 14ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:44.915 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = 1100997 and total_cpns != '{}' and site_private_id = any('{74931313,74933311,74934475}')] 
2023-11-16 08:59:44.919 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_WITH_PART_SET_99446_1100997
2023-11-16 08:59:44.919 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1276]: Time taken : 51ms : for query : select distinct ss.site_private_id as site_id, unnest(ss.total_cpns) as customer_part_number_id, tenant_id from site_summary ss where is_deleted = false and tenant_id = %s and total_cpns != '{}' and site_private_id = any('{%s}')
2023-11-16 08:59:44.919 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:44.927 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [26, with SITEID as( select * from ( select unnest(array[1208224,46719674,3616947,3611810]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:44.927 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 14ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:44.927 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 26ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:44.930 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 248170 
2023-11-16 08:59:44.933 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_545592
2023-11-16 08:59:44.933 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1607]: Time taken : 32ms : for Sparkview : EVENT_PARTNER_SITE_ACTIVITY_SET_99446_545592
2023-11-16 08:59:44.936 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [43, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868337 and tenant_id = 1210151] 
2023-11-16 08:59:44.937 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 44ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:44.946 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_PARTNER_VIEW_99446_545592
2023-11-16 08:59:44.947 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createFinalViewForPartner:1621]: Time taken : 13ms : for query : SELECT DISTINCT EPD.TENANT_ID, ED.EVENT_ID, EPD.SITE_ID, EPD.COMPANY_ID,EPD.SITE_ANCHOR_ID,EPD.DOWN_TIME_UNIT, EPD.created_by_id, EPD.LAST_MODIFIED_BY_ID, EPD.IMPACT_STATUS,EPD.IMPACT_NOTIFICATION_STATUS,EPD.AFFECTED_COMPANY_ID, EPSAD.RECOVERY_TIME AS DOWN_TIME, downtimeupdate as downTimeUpdate FROM EVENT_PARTNER_DATA_SET_%s_%s AS EPD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON EPD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_PARTNER_SITE_ACTIVITY_SET_%s_%s EPSAD ON EPSAD.SITE_ID = EPD.SITE_ID
2023-11-16 08:59:44.947 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1542]: Done : create 'event_site' dataset & view for Partners for tenant_id : 545592 
2023-11-16 08:59:44.947  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicatePartnerEntities:730]: PartnerDetail Exist : true for this customer : 99446 and event : 545592
2023-11-16 08:59:44.967 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [47, with SITEID as( select * from ( select unnest(array[74931313,74933311,74934475]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id] 
2023-11-16 08:59:44.968 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createDownTimeDs:1324]: Time taken : 48ms : for query : with SITEID as( select * from ( select unnest(array[%s]::bigint[]) site_private_id) tmp) select MAX(GET_DOWN_TIME_IN_WEEKS(SA.RECOVERY_TIME, SA.RECOVERY_TIME_UNIT, true)) as RECOVERY_TIME, SBP.site_private_id as site_id from SITE_BY_PATH SBP inner join SITEID on SBP.is_deleted = false and SITEID.site_private_id = SBP.site_private_id left join SITE_ACTIVITY SA on SA.is_deleted = false and SA.PRIMARY_SITE_ID = SBP.ID and SA.TENANT_ID = SBP.TENANT_ID and SA.BEST_ORIGINAL_ROW = true group by sbp.site_private_id
2023-11-16 08:59:44.973 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_SITE_ACTIVITY_SET_99446_1100997
2023-11-16 08:59:44.973 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1286]: Time taken : 53ms : for Sparkview : EVENT_SITE_ACTIVITY_SET_99446_1100997
2023-11-16 08:59:44.985 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : FINAL_CUSTOMER_VIEW_99446_1100997
2023-11-16 08:59:44.986 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1299]: Time taken : 12ms : for query : SELECT DISTINCT ECD.TENANT_ID, ED.EVENT_ID, ECD.SITE_ID, ECD.COMPANY_ID,ECD.SITE_ANCHOR_ID,ECD.DOWN_TIME_UNIT, ECD.created_by_id, ECD.LAST_MODIFIED_BY_ID, ECD.IMPACT_STATUS,ECD.IMPACT_NOTIFICATION_STATUS,ECD.AFFECTED_COMPANY_ID, ESPD.CUSTOMER_PART_NUMBER_ID, ESAD.RECOVERY_TIME AS DOWN_TIME, ECD.downtimeupdate as downTimeUpdate FROM EVENT_CUSTOMER_DATA_SET_%s_%s AS ECD INNER JOIN EVENT_DETAIL_%s_%s AS ED ON ECD.TENANT_ID = ED.TENANT_ID LEFT JOIN EVENT_SITE_WITH_PART_SET_%s_%s ESPD ON ESPD.TENANT_ID = ECD.TENANT_ID AND ESPD.SITE_ID = ECD.SITE_ID LEFT JOIN EVENT_SITE_ACTIVITY_SET_%s_%s ESAD ON ESAD.SITE_ID = ECD.SITE_ID
2023-11-16 08:59:44.986 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalView:1302]: Done : Creating Views required for all entities of Customer for tenant_id : 1100997
2023-11-16 08:59:44.990 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1210151
2023-11-16 08:59:44.990 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 4ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1210151
2023-11-16 08:59:44.995 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createCustomerFinalDsAndView:1152]: Done : Creating final Ds and Views of 'event_company' & 'event_site' for Customer for tenant_id : 1100997 
2023-11-16 08:59:44.996 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateCustomerEntities:1077]: Done : Replicating Customer entities for tenant_id : 1100997 
2023-11-16 08:59:44.996 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1341]: Creating 'event_company' Dataset for tenant_id : 1100997 
2023-11-16 08:59:44.996 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:45.001 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1210151
2023-11-16 08:59:45.001 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 11ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:45.010 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 8ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:45.012 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1491]: Creating 'event_site' Dataset for Partner for tenant_id : 545592 
2023-11-16 08:59:45.012 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1210151 
2023-11-16 08:59:45.021 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1501]: Time taken : 8ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_PARTNER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:45.021 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForPartner:1504]: Done : final dataset for 'event_site' for Partner for tenant_id : 545592 
2023-11-16 08:59:45.024 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = 19868334 and tenant_id = 1100997] 
2023-11-16 08:59:45.025 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1397]: Time taken : 28ms : for query : select distinct tenant_id, event_id, company_private_id, overwritten_down_time, down_time, impact_status, down_time_unit from event_company ec where is_deleted = false and event_id = %s and tenant_id = %s
2023-11-16 08:59:45.033 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:602]: Writing records into 'event_site' -- for Customer tenant_id -- 545592
2023-11-16 08:59:45.075 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 158224
2023-11-16 08:59:45.076  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 158224
2023-11-16 08:59:45.077 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 158224 
2023-11-16 08:59:45.077 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:45.091 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : GET_EVENT_COMPANY_UPDATE_99446_1100997
2023-11-16 08:59:45.091 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1406]: Time taken : 5ms : for Sparkview : GET_EVENT_COMPANY_UPDATE_99446_1100997
2023-11-16 08:59:45.107 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SPARK_QUERY_EVENT_COMPANY_VIEW_99446_1100997
2023-11-16 08:59:45.107 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1422]: Time taken : 15ms : for query : select tenant_id as tenantId, event_id as eventId, company_id as companyId, cast(NULL AS INT) as eventCompanyId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime, downtimeupdate as downTimeUpdate from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, company_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status, downTimeUpdate
2023-11-16 08:59:45.119 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [42, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 158224 and es.event_id = 19868332 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:45.120 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 42ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:45.123 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyDsForUpateCustomer:1435]: Time taken : 15ms : for query : select distinct GEC.company_private_id as eventCompanyId, FCV.companyId as companyId, FCV.eventId as eventId, FCV.tenantId as tenantId, FCV.sharedCustomers as sharedCustomers, FCV.sourceId as sourceId, FCV.userId as userId, FCV.impactNotificationStatus as impactNotificationStatus, case when GEC.company_private_id is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then GEC.impact_status when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.impactstatus when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.impact_status else FCV.impactstatus end else FCV.impactstatus end as impactStatus, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.down_time > FCV.downTime then GEC.down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.down_time else FCV.downTime end when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then case when GEC.impact_status = 'Potential' and FCV.impactstatus = 'Potential' then case when GEC.overwritten_down_time > FCV.downTime then GEC.overwritten_down_time else FCV.downTime end when GEC.impact_status = 'No Impact' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Restored' and FCV.impactstatus = 'Potential' then FCV.downTime when GEC.impact_status = 'Confirmed' and FCV.impactstatus = 'Potential' then GEC.overwritten_down_time else FCV.downTime end else FCV.downTime end as downTime, case when GEC.company_private_id is not null and GEC.overwritten_down_time is null then 'downTime' when GEC.company_private_id is not null and GEC.overwritten_down_time is not null then 'overWrittenDownTime' else 'downTime' end as downTimeUpdate from SPARK_QUERY_EVENT_COMPANY_VIEW_%s_%s as FCV left join GET_EVENT_COMPANY_UPDATE_%s_%s as GEC on FCV.companyId = GEC.company_private_id and FCV.tenantId = GEC.tenant_id and FCV.eventId = GEC.event_id
2023-11-16 08:59:45.125 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_158224
2023-11-16 08:59:45.125 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 5ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_158224
2023-11-16 08:59:45.126 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [?:?] : [createEventCompanyDsForCustomer:1349]: Done : final dataset for 'event_company' for tenant_id : 1100997 
2023-11-16 08:59:45.132 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 6ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:45.132 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 158224 
2023-11-16 08:59:45.832  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 158224
2023-11-16 08:59:45.832 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 158224 
2023-11-16 08:59:45.839 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 158224 
2023-11-16 08:59:45.839  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:45.839 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 158224 
2023-11-16 08:59:45.839 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 158224
2023-11-16 08:59:46.018 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[5357]
2023-11-16 08:59:46.018 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 178ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:46.018 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [?:?] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 1 for customer 158224
2023-11-16 08:59:46.018 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [?:?] : <[5357]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158224
2023-11-16 08:59:46.071 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[5357]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}158224
2023-11-16 08:59:46.071 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 52ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:46.071 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 158224 99446 user with No pref [5357]
2023-11-16 08:59:46.072 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:46.072 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1008]: no user found with pref for this tenant Id 158224 and eventId 99446
2023-11-16 08:59:46.072 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 158224 99446
2023-11-16 08:59:46.072 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 158224
2023-11-16 08:59:46.072  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 158224
2023-11-16 08:59:46.072 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:46.073 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [158224] 
2023-11-16 08:59:46.076 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:46.076 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:46.076  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 158224, isUpdateAlert : true
2023-11-16 08:59:46.076  INFO 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:46.077 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:46.077  INFO 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [?:?] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:46.078 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"91f65dbb-4003-4a7b-8003-d2f19522a4ea","eventId":19868332,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:46.080  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868332, tenantId : 158224
2023-11-16 08:59:46.080 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"91f65dbb-4003-4a7b-8003-d2f19522a4ea","eventId":19868332,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41786
2023-11-16 08:59:46.080  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:46.080  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [642574, 642637, 642461, 637569, 643946, 629777, 641724, 644259, 645550, 632913, 635986] 
2023-11-16 08:59:46.080 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.119 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [38, select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = 99446 and tenant_id in (642574,642637,642461,637569,643946,629777,641724,644259,645550,632913,635986)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp] 
2023-11-16 08:59:46.119 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:550]: Time taken : 39ms : for query : select distinct on(event_id) tmp.tenant_id as TENANTID, event_id as EVENTID, max as downTime, 'weeks' as downTimeUnit, impact_status as impactStatus from ( select tenant_id, event_id, max(GET_DOWN_TIME_IN_WEEKS(down_time, down_time_unit, false)), impact_status, case when impact_status = 'Confirmed' then 3 when impact_status = 'Potential' then 2 when impact_status = 'No Impact' then 1 end as status_order from event_site where event_id in ( select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and is_deleted = false group by 1, 2, 4, 5 order by 5 desc) tmp
2023-11-16 08:59:46.577 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.605 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [28, select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = 99446 and tenant_id in (642574,642637,642461,637569,643946,629777,641724,644259,645550,632913,635986)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3] 
2023-11-16 08:59:46.606 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:562]: Time taken : 29ms : for query : select tmp.tenant_id as TENANTID, tmp.id as companyPrivateId, tmp.userId as userId, array_agg(distinct affected_customer) as affectedCompaniesId from(select distinct cp.tenant_id, cp.id, unnest(affected_companies_id) affected_customer, 1::bigint as userId from event_site es inner join company_private cp on es.is_deleted = false and cp.is_deleted = false and es.event_id in (select id from event_shareable where event_details_id = %s and tenant_id in (%s)) and cp.tenant_id = es.tenant_id and cp.owner_tenant_id = cp.tenant_id) tmp group by 1,2,3
2023-11-16 08:59:46.612 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158224
2023-11-16 08:59:46.613 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:572]: Time taken : 6ms : for Sparkview : EXISITING_EVENT_SITE_FOR_PARTNER_99446_158224
2023-11-16 08:59:46.618 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158224
2023-11-16 08:59:46.619 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:582]: Time taken : 5ms : for Saprkview : AFFECTED_CUSTOMERS_EVENT_SITE_99446_158224
2023-11-16 08:59:46.625 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventCompanyForPartner:593]: Time taken : 6ms : for query : SELECT distinct v1.TENANTID as tenantId, v1.EVENTID as eventId, v1.downTime as downTime, v1.impactStatus as impactStatus,companyPrivateId as companyId, companyPrivateId as eventCompanyId, v1.tenantId as sourceId, affectedCompaniesId as sharedCustomers, V2.userId as userId, 'Pending' as impactNotificationStatus, 'weeks' as downTimeUpdate  FROM EXISITING_EVENT_SITE_FOR_PARTNER_%s_%s AS V1 INNER JOIN AFFECTED_CUSTOMERS_EVENT_SITE_%s_%s AS V2 ON V1.TENANTID = V2.TENANTID
2023-11-16 08:59:46.719 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 248170
2023-11-16 08:59:46.740 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventSite:607]: Done Writing records into 'event_site' -- for Customer tenant_id -- 545592
2023-11-16 08:59:46.742  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:387]: Done replicating event_site for partner for tenant_id : 545592
2023-11-16 08:59:46.742 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1210151
2023-11-16 08:59:46.743 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1682]: Creating 'event_customer_part_number' Dataset for tenant_id : 545592 
2023-11-16 08:59:46.743 DEBUG 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.760 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 248170
2023-11-16 08:59:46.761  INFO 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 248170
2023-11-16 08:59:46.761 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 248170 
2023-11-16 08:59:46.769 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 7ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:46.769 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 248170 
2023-11-16 08:59:46.769  INFO 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 248170
2023-11-16 08:59:46.769 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 248170 
2023-11-16 08:59:46.769 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 248170 
2023-11-16 08:59:46.769 DEBUG 1 --- [6_103335_248170] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.790 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1210151
2023-11-16 08:59:46.791  INFO 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1210151
2023-11-16 08:59:46.791 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1210151 
2023-11-16 08:59:46.873 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [130, with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = 545592 and es.event_id = 19868333 group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null] 
2023-11-16 08:59:46.875 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1743]: Time taken : 131ms : for query : with cpn_data as( select distinct es.tenant_id as internal_tenant_id, es.event_id, unnest(total_cpns) as customer_part_number_id, case when MAX(ES.OVERWRITTEN_DOWN_TIME) is not null then MAX(ES.OVERWRITTEN_DOWN_TIME) else coalesce(MAX(ES.DOWN_TIME), 52) end as DOWN_TIME, 'weeks'::time_unit as DOWN_TIME_UNIT, 'Potential'::EVENT_IMPACT_STATUS as impact_status, false as is_deleted, es.created_by_id as internal_created_by_id, es.last_modified_by_id as internal_last_modified_by_id from site_summary ss inner join event_site es on es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id and ss.total_cpns != '{}' and es.tenant_id = %s and es.event_id = %s group by 1, 2, 3, 5, 6, 8, 9) select distinct cd.internal_tenant_id as tenantId, cd.internal_created_by_id as userId, cd.customer_part_number_id as customerPartId, cd.event_id as eventId, cd.impact_status as impactStatus, cd.DOWN_TIME :: numeric as downTime from cpn_data cd left join event_customer_part_number ecpn on cd.customer_part_number_id = ecpn.customer_part_number_id and ecpn.event_id = cd.event_id and ecpn.tenant_id = cd.internal_tenant_id where ecpn.event_id is null or ecpn.customer_part_number_id is null
2023-11-16 08:59:46.877 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 85ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:46.877 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1210151 
2023-11-16 08:59:46.877  INFO 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1210151
2023-11-16 08:59:46.877 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1210151 
2023-11-16 08:59:46.877 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1210151 
2023-11-16 08:59:46.877 DEBUG 1 --- [_103335_1210151] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.883 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : SELECT_EVENT_CPN_UPDATE_99446_545592
2023-11-16 08:59:46.884 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1754]: Time taken : 8ms : for sparkView : SELECT_EVENT_CPN_UPDATE_99446_545592
2023-11-16 08:59:46.889 DEBUG 1 --- [6_103335_248170] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [119, with SITE_IDS as(select unnest('{7122092,7143028}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[248170] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:46.890 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 120ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:46.890 DEBUG 1 --- [6_103335_248170] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 248170
2023-11-16 08:59:46.891 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createECPNDsForUpdate:1766]: Time taken : 6ms : for query : select tenantId as tenantId, eventId as eventId, customerPartId as customerPartId, userId as userId, impactStatus as impactStatus, MAX(downTime) as downTime from SELECT_EVENT_CPN_UPDATE_%s_%s where customerPartId is not null group by tenantId, eventId, customerPartId, userId, impactStatus
2023-11-16 08:59:46.891 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [replicateEventCustomerPart:1690]: Done : final dataset for 'event_customer_part_number' for tenant_id : 545592 
2023-11-16 08:59:46.909 DEBUG 1 --- [_103335_1210151] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [31, with SITE_IDS as(select unnest('{87257753,87257983,87258003,87258005,87258183,87258212,87258248}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,157408::bigint as created_by_id,157408::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[1210151] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id] 
2023-11-16 08:59:46.910 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1571]: Time taken : 32ms : for query : with SITE_IDS as(select unnest('{%s}'::bigint[]) as site_private_id, false as IS_DELETED) select DISTINCT SBP.SITE_PRIVATE_ID as site_id, CP.id as company_id, sbp.site_anchor_id as site_anchor_id, sbp.tenant_id as tenant_id, sbp.tenant_id as owner_tenant_id, 'weeks'::time_unit as down_time_unit,%s::bigint as created_by_id,%s::bigint as last_modified_by_id,'Potential'::event_impact_status as impact_status,'Pending'::impact_notification_status as impact_notification_status, ARRAY[%s] as affected_company_id, 'downTime' as downTimeUpdate from SITE_IDS inner join SITE_BY_PATH SBP on SITE_IDS.IS_DELETED = false and SBP.IS_DELETED = false and SBP.SITE_PRIVATE_ID = SITE_IDS.SITE_PRIVATE_ID inner join SITE_SHAREABLE SS on SS.IS_DELETED = false and ss.site_anchor_id = sbp.site_anchor_id and ss.tenant_id = sbp.tenant_id and case when SS.source_id = 1 then true else SS.best_original_row = true end and SS.PROTECTED_BY_EVENTWATCH = true inner join COMPANY_BY_PATH CBP on CBP.IS_DELETED = false and CBP.ID = SBP.COMPANY_ID and CBP.TENANT_ID = SBP.TENANT_ID inner join company_private cp on cp.is_deleted = false and cp.tenant_id = cbp.tenant_id and cp.id = cbp.company_private_id
2023-11-16 08:59:46.910 DEBUG 1 --- [_103335_1210151] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1574]: Done : executing query of getting Partner anchor Ids Dataset for tenant_id : 1210151
2023-11-16 08:59:46.953 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:444]: Writing Customer details to 'event_company' -- for Customer tenant_id -- 1100997
2023-11-16 08:59:46.985  INFO 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:518]: Done replicating event_company for partner with tenant_id : 158224
2023-11-16 08:59:46.985 DEBUG 1 --- [6_103335_158224] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:46.989  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:393]: Done replicating event_customer_part_number for tenant_id : 545592
2023-11-16 08:59:46.989 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1837]: Dropping Spark Views & Datasets for tenant_id : 545592 
2023-11-16 08:59:46.992 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [dropSparkViews:1853]: Done : Dropping Spark Views & Datasets for tenant_id : 545592 
2023-11-16 08:59:46.992  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:339]: After replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:46.992 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:912]: Creating a data Set for event_user for this event_id 99446 and tenant_id 545592 
2023-11-16 08:59:46.992 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1409]: Calculating user with no pref for customer 545592
2023-11-16 08:59:47.008 DEBUG 1 --- [_103335_1100997] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventCompanyForCustomer:449]: Done Writing Customer details to 'event_company' -- for Customer tenant_id -- 1100997
2023-11-16 08:59:47.009  INFO 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:372]: Done replicating event_company for customer for tenant_id : 1100997
2023-11-16 08:59:47.009 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1461]: Creating 'event_site' Dataset for tenant_id : 1100997 
2023-11-16 08:59:47.010 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1435]: Calculating user with no pref user[285024, 262864, 254208, 88018, 192051, 199939]
2023-11-16 08:59:47.010 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithNoPref:1437]: Time taken : 17ms : for query : select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( select distinct US.USER_ANCHOR_ID from USER_PART_CATEGORY as UPC inner join PART_CATEGORY_SHAREABLE PCS on UPC.is_deleted = false and PCS.is_deleted = false and upc.tenant_id = ? and upc.tenant_id = pcs.tenant_id and PCS.ID = UPC.PART_CATEGORY_ID inner join PART_CATEGORY as PC on PC.is_deleted = false and pc.tenant_id = pcs.tenant_id and UPC.PART_CATEGORY_ID = PC.PART_CATEGORY_SHAREABLE_ID inner join user_shareable US on US.is_deleted = false and us.tenant_id = pc.tenant_id and US.USER_ANCHOR_ID = UPC.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and us.tenant_id = USER_ROLES.tenant_id and US.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect select distinct up.user_anchor_id as user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in( with uta_data as ( select distinct UTA.USER_ANCHOR_ID USER_ANCHOR_ID, uta.tenant_id, uta.is_deleted from USER_TENANT_ACCESS UTA inner join company_summary as cs on UTA.is_deleted = false and cs.is_deleted = false and uta.tenant_id = ? and cs.tenant_id = uta.tenant_id and Cs.OWNER_TENANT_ID = UTA.ALLOWED_TENANT_ID) select distinct ud.USER_ANCHOR_ID from USER_SHAREABLE US inner join uta_data ud on US.is_deleted = false and ud.is_deleted = false and US.USER_ANCHOR_ID = ud.USER_ANCHOR_ID and ud.tenant_id = us.tenant_id and us.best_original_row = true inner join PUBLIC.USER_ROLES on PUBLIC.USER_ROLES.is_deleted = false and ud.tenant_id = USER_ROLES.tenant_id and ud.USER_ANCHOR_ID = USER_ROLES.USER_ANCHOR_ID inner join PUBLIC.ROLES on PUBLIC.ROLES.is_deleted = false and USER_ROLES.ROLE_ID = ROLES.ID and ROLE_NAME in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and USER_ROLE.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM' and value ->> 'eventTypes' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'WARROOM_USER_SETTING' and module = 'EVENTWAR_ROOM')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE' and value ->> 'countries' = '[]' inner join USER_PRIVATE UP on UP.is_deleted = false and UP.tenant_id = US.tenant_id and up.user_anchor_id = us.user_anchor_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and module = 'USER_PREFERENCE')) intersect (select distinct us.user_anchor_id as user_anchor_id from app_config inner join user_shareable US on app_config.is_deleted = false and US.is_deleted = false and us.tenant_id = ? and us.tenant_id = app_config.tenant_id and US.USER_ANCHOR_ID = app_config.USER_ANCHOR_ID inner join PUBLIC.USER_ROLES as USER_ROLE on USER_ROLE.is_deleted = false and user_role.tenant_id = us.tenant_id and US.USER_ANCHOR_ID = USER_ROLE.USER_ANCHOR_ID inner join PUBLIC.ROLES as role on role.is_deleted = false and USER_ROLE.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE' and value = '{}' inner join USER_PRIVATE UP on UP.is_deleted = false and up.user_anchor_id = us.user_anchor_id and UP.tenant_id = US.tenant_id and UP.active = true union select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.is_deleted = false and ur.is_deleted = false and up.active = true and up.tenant_id = ? and up.tenant_id = ur.tenant_id and up.user_anchor_id = ur.user_anchor_id inner join PUBLIC.ROLES as role on role.is_deleted = false and UR.ROLE_ID = ROLE.ID and ROLE_name in ('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and up.user_anchor_id not in ( select USER_ANCHOR_ID from app_config where (is_deleted = false or is_deleted is null) and tenant_id = ? and category = 'CUSTOM_ATTRIBUTE_SETTING' and module = 'USER_PREFERENCE'));
2023-11-16 08:59:47.010 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:916]: Done Calculating user with no pref size 6 for customer 545592
2023-11-16 08:59:47.010 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[285024, 262864, 254208, 88018, 192051, 199939]> [insertEventUserForCustomers:1503]: inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}545592
2023-11-16 08:59:47.015 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1473]: Time taken : 5ms : for query : select tenant_id as tenantId, event_id as eventId, site_id as siteId, site_id as eventSiteId, affected_company_id as sharedCustomers, created_by_id as userId, tenant_id as sourceId, impact_status as impactStatus, impact_notification_status as impactNotificationStatus, MAX(down_time) as downTime from FINAL_CUSTOMER_VIEW_%s_%s group by tenant_id, event_id, site_id, affected_company_id, created_by_id, down_time_unit, impact_status, impact_notification_status
2023-11-16 08:59:47.015 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventSiteDsForCustomer:1476]: Done : final dataset for 'event_site' for tenant_id : 1100997 
2023-11-16 08:59:47.015  INFO 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicationProcess:377]: Done replicating event_site for customer for tenant_id : 1100997
2023-11-16 08:59:47.015 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerFinalDsAndView:1518]: create 'event_site' dataset & view for Partners for tenant_id : 1100997 
2023-11-16 08:59:47.015 DEBUG 1 --- [_103335_1100997] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createPartnerAnchorIdDs:1560]: executing query of getting Partner anchor Ids Dataset for tenant_id : 1100997 
2023-11-16 08:59:47.015 DEBUG 1 --- [_103335_1100997] c.r.s.streaming.helper.LoggingHelper     [logDebug:53] : Executing Query from queryDataset2
2023-11-16 08:59:47.021 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ReplicationHelper         [queryDataset:121] : Time taken(ms) for query: [36, select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, 157408::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =99446 and E.tenant_id in (642574,642637,642461,637569,643946,629777,641724,644259,645550,632913,635986) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID] 
2023-11-16 08:59:47.022 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : <[285024, 262864, 254208, 88018, 192051, 199939]> [insertEventUserForCustomers:1524]: Done inserting records into 'event_user' -- for tenantId {} --  userWithoutPref {}545592
2023-11-16 08:59:47.022 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserForCustomers:1528]: Time taken : 12ms : for query : with NEW_VALUES as( select distinct es.tenant_id as TENANT_ID, es.id as event_id, ? as created_by_id, ? as last_modified_by_id, ?::bigint[] as user_anchor_id from event_shareable es where es.tenant_id = ? and es.event_details_id = ?) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, event_notification_status) select EVENT_ID, unnest(USER_ANCHOR_ID), CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, ? from NEW_VALUES on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = '{}'::bigint[], affected_categories = '{}'::bigint[], event_notification_status = ?;
2023-11-16 08:59:47.022 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:942]: Creating user setting with prefernce 545592 99446 user with No pref [285024, 262864, 254208, 88018, 192051, 199939]
2023-11-16 08:59:47.024 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:959]: Time taken : 1ms : for query : select distinct up.user_anchor_id from user_private up inner join user_roles ur on up.tenant_id = ?::BIGINT and ur.tenant_id = up.tenant_id and ur.is_deleted = false and up.is_deleted = false and up.user_anchor_id = ur.user_anchor_id and up.active = true %s inner join roles r on r.is_deleted = false and r.role_name in('EVENT_LEAD', 'COMMODITY_MANAGER', 'EXECUTIVE') and r.id = ur.role_id;
2023-11-16 08:59:47.024 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:964]: user with pref details 545592 99446 [172497, 172498, 175036, 175037, 175039, 230530]
2023-11-16 08:59:47.024 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1125]: Calculate user setting data on basis of Event-Type  545592 99446 
2023-11-16 08:59:47.024 DEBUG 1 --- [     Thread-393] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1233]: Calculate user setting data on basis of UDA Setting 545592 99446 [172497, 172498, 175036, 175037, 175039, 230530]
2023-11-16 08:59:47.026 DEBUG 1 --- [6_103335_158224] c.r.s.s.helper.ApplicationHelper         [logDebug:407] : EVENT_USER_FOR_PARTNER_99446_158224
2023-11-16 08:59:47.026 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:671]: Time taken : 40ms : for query : select distinct on(US.USER_ANCHOR_ID,ec.tenant_id) US.USER_ANCHOR_ID as USERID, ec.tenant_id as tenant_id, ec.event_id as event_id, %s::bigint as id from EVENT_SHAREABLE as E inner join USER_SHAREABLE as US on E.is_deleted = false and US.is_deleted = false and E.TENANT_ID = US.TENANT_ID and E.event_details_id =%s and E.tenant_id in (%s) and US.TENANT_ID = US.OWNER_TENANT_ID and US.BEST_ORIGINAL_ROW = true inner join USER_ROLES as UR on UR.is_deleted = false and UR.TENANT_ID = US.TENANT_ID and UR.USER_ANCHOR_ID = US.USER_ANCHOR_ID and US.USER_ANCHOR_ID is not null inner join ROLES on ROLES.is_deleted = false and UR.ROLE_ID = ROLES.ID and ROLES.ROLE_NAME in ('CRISIS_MANAGER') inner join EVENT_COMPANY as EC on EC.is_deleted = false and E.ID = EC.EVENT_ID inner join COMPANY_BY_PATH as CBP on CBP.is_deleted = false and CBP.COMPANY_PRIVATE_ID = EC.company_private_id and CBP.RELATIONSHIP_TYPE = 'self' order by US.USER_ANCHOR_ID
2023-11-16 08:59:47.026 DEBUG 1 --- [     Thread-393] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1256]: Done Calculate user setting data on basis of UDA Setting 545592 99446 [172497, 172498, 175036, 175037, 175039, 230530]
2023-11-16 08:59:47.026 DEBUG 1 --- [     Thread-393] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithUDA:1259]: Time taken : 1ms : for query : with affected_uda_user as(select distinct app.user_anchor_id, app.tenant_id,(select id from event_shareable where event_details_id = ? and tenant_id = ? and is_deleted = false) as event_id from app_config app where app.is_deleted = false and app.tenant_id = ? and app.user_anchor_id = any(?::BIGINT[]) and category = 'CUSTOM_ATTRIBUTE_SETTING') select DISTINCT user_anchor_id, coalesce(filter_by_custom_attribute(tenant_id, user_anchor_id, event_id, (select array_agg(site_private_id) from event_site where event_id = affected_uda_user.event_id and is_deleted= false)), '{}') as affectedSites from affected_uda_user;
2023-11-16 08:59:47.026 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1149]: Done Calculate user setting data on basis of Event-Type  545592 99446 
2023-11-16 08:59:47.026 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithEventType:1152]: Time taken : 2ms : for query : with user_details as( select unnest(?::BIGINT[]) as id, false as is_deleted, ? ::BIGINT as tenant_id) , app_config_details as( select distinct ud.id as user_anchor_id, ud.tenant_id from user_details ud left join app_config app on app.tenant_id = ? and app.is_deleted = false and app.user_anchor_id = ud.id and CATEGORY = 'WARROOM_USER_SETTING' where case when app.value ->> 'eventTypes'::text is null then true when app.value ->> 'eventTypes'::text = '[]'::text then true when app.VALUE @> '{"eventTypes": ["%s"]}' then true else false end) , site_details as( select es.tenant_id, ess.event_id, ARRAY_AGG(distinct ess.site_private_id) as event_sites from event_details ed inner join event_shareable es on ed.is_deleted = false and es.is_deleted = false and ed.id = ? and es.event_details_id = ed.id and es.tenant_id = ? inner join event_site ess on ess.is_deleted = false and ess.tenant_id = es.tenant_id and ess.event_id = es.id inner join site_summary ss on ss.is_deleted = false and ss.tenant_id = ess.tenant_id and ss.site_private_id = ess.site_private_id group by 1, 2 ) select distinct app_config_details.user_anchor_id, event_sites as affectedSites from site_details inner join app_config_details on app_config_details.tenant_id = site_details.tenant_id;	
2023-11-16 08:59:47.026 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1174]: Calculate user setting data on basis of Country Setting 545592 99446 [230530, 172497]
2023-11-16 08:59:47.028 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1203]: Done Calculate user setting data on basis of Country Setting 545592 99446 [172497]
2023-11-16 08:59:47.028 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCountry:1206]: Time taken : 1ms : for query : with affected_country_users as(select replace(replace(coalesce((value -> 'countries')::text, '[]'::text), '[', '{'), ']', '}')::int[] as country_id, user_anchor_id, tenant_id, is_deleted from app_config where (is_deleted = false or is_deleted is null) and app_config.tenant_id = ? and category = 'COUNTRY_SETTING' and app_config.user_anchor_id = any(?::bigint[]) and module = 'USER_PREFERENCE' and coalesce((value ->> 'countries'),'[]'::text) != '[]'), site_user as (select array_agg(distinct ss.site_private_id) as affectedSites, user_anchor_id from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join affected_country_users on ss.country_code_id = any(country_id) group by 2) select affected_country_users.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_country_users left join site_user on affected_country_users.user_anchor_id = site_user.user_anchor_id
2023-11-16 08:59:47.028 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1361]: Calculate user setting data on basis of Partner Setting 545592 99446 [172497]
2023-11-16 08:59:47.028 DEBUG 1 --- [6_103335_158224] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [createEventUserForPartner:680]: Time taken : 2ms : for query : select distinct tenant_id as tenantId, tenant_id as sourceId, event_id as eventId, USERID as userId, id as id from EVENT_USER_FOR_PARTNER_%s_%s
2023-11-16 08:59:47.031 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1390]: Done Calculate user setting data on basis of Partner Setting 545592 99446 [172497]
2023-11-16 08:59:47.031 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithPartner:1393]: Time taken : 2ms : for query : with affected_partner_user as(select distinct user_anchor_id from user_tenant_access uta where is_deleted= false and tenant_id= ? and tenant_id != allowed_tenant_id and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, UTA.USER_ANCHOR_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join company_summary cs on cs.is_deleted = false and cs.tenant_id = ss.tenant_id and cs.id = ss.company_summary_id inner join user_tenant_access uta on uta.is_deleted = false and uta.tenant_id = cs.tenant_id and uta.user_anchor_id in (select affected_partner_user.user_anchor_id from affected_partner_user) and uta.allowed_tenant_id = cs.owner_tenant_id GROUP BY UTA.USER_ANCHOR_ID) select affected_partner_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites from affected_partner_user left join site_user on affected_partner_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:47.031 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1288]: Calculate user setting data on basis of Category Setting 545592 99446 [172497]
2023-11-16 08:59:47.031 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1325]: Done Calculate user setting data on basis of Category Setting 545592 99446 [172497]
2023-11-16 08:59:47.031 DEBUG 1 --- [     Thread-392] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserDetailwithCateogry:1328]: Time taken : 0ms : for query : with affected_category_user as(select distinct user_anchor_id from user_part_category upc where is_deleted= false and tenant_id= ? and user_anchor_id = any(?::bigint[])) , site_user as (SELECT array_agg(DISTINCT ss.site_private_id) AS affectedsites, array_agg(distinct pcs.id) as totalcategories, upc.TENANT_ID, upc.USER_ANCHOR_ID, ES.EVENT_ID from event_details ed inner join event_shareable esh on ed.is_deleted = false and esh.is_deleted = false and ed.id = ? and ed.id = esh.event_details_id and esh.tenant_id = ? inner join event_site es on es.is_deleted = false and es.tenant_id = esh.tenant_id and es.event_id = esh.id inner join site_summary ss on ss.is_deleted = false and es.tenant_id = ss.tenant_id and es.site_private_id = ss.site_private_id inner join part_category_shareable pcs on pcs.is_deleted = false and pcs.tenant_id = ss.tenant_id and pcs.id = any(ss.total_categories) inner join user_part_category upc on upc.is_deleted = false and upc.tenant_id = pcs.tenant_id and pcs.id =upc.part_category_id and upc.user_anchor_id in (select affected_category_user.user_anchor_id from affected_category_user) GROUP BY 3,4,5) select affected_category_user.user_anchor_id, coalesce(site_user.affectedSites, '{}'::bigint[]) as affectedsites, coalesce(site_user.totalcategories, '{}'::bigint[]) as affectedCategories, tenant_id, event_id from affected_category_user left join site_user on affected_category_user.user_anchor_id = site_user.user_anchor_id;
2023-11-16 08:59:47.031 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:995]: Done calculating user final list : user found with pref for this tenant Id 545592 and eventId 99446 and userIds [172497]
2023-11-16 08:59:47.031 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1000]: Time taken : 0ms : for calculating user final list : tenant Id : 545592 and eventId : 99446 
2023-11-16 08:59:47.031 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1062]: Inserting event_user with pref
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1098]: Done Inserting event_user with pref 1
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [insertEventUserPrefWithCustomer:1100]: Time taken : 3ms : for query : with event_detail_data as( select id from event_shareable es where event_details_id = ? and tenant_id = ? and is_deleted = false) insert into EVENT_USER(EVENT_ID, USER_ANCHOR_ID, CREATED_BY_ID, LAST_MODIFIED_BY_ID, TENANT_ID, affected_sites, affected_categories, event_notification_status) values(( select id from event_detail_data), ?, ?, ?, ?, ?::bigint[], ?::bigint[], ?) on conflict(TENANT_ID, EVENT_ID, USER_ANCHOR_ID) do update set affected_sites = ?::bigint[], affected_categories = ?::bigint[], event_notification_status = ?;
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [calculateUserWithPref:1018]: Done user setting with prefernce 545592 99446
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [writeToEventUserForCustomer:922]: Done Creating a data Set for event_users for this event_id 99446 and tenant_id 545592
2023-11-16 08:59:47.035  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendNotifications:476]: Done replicating event_user for customer with tenant_id : 545592
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2201]: updateEventShareable -- input params :: status : 5, metaData : null
2023-11-16 08:59:47.035 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2204]: updateEventShareable -- query params :: eventId : 99446, tenantIds : [545592] 
2023-11-16 08:59:47.038 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2231]: updateEventShareable -- ended with result as : 1
2023-11-16 08:59:47.038 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.EventReplicationHelper    [handleLogs:286] : [updateEventShareable:2234]: Time taken : 3ms : for query : update event_shareable set event_replication_status = ?, event_replication_metadata = ?::jsonb where event_details_id = ? and tenant_id in (%s)
2023-11-16 08:59:47.038  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1914]: Sending Customer Impact Notification for tenantId : 545592, isUpdateAlert : true
2023-11-16 08:59:47.038  INFO 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:47.039 DEBUG 1 --- [6_103335_545592] c.r.s.s.helper.ReplicationHelper         [getUniquieIds:305] : Time taken(ms) for query: [0, SELECT UNIQUE_ID,E.ID FROM TENANT JOIN EVENT_SHAREABLE as E ON TENANT.id=E.tenant_id and e.event_details_id=? AND tenant.ID IN (%s) WHERE (TENANT.is_deleted = false OR TENANT.is_deleted IS NULL) AND (E.is_deleted = false OR E.is_deleted IS NULL)] 
2023-11-16 08:59:47.039  INFO 1 --- [6_103335_545592] c.r.s.streaming.helper.LoggingHelper     [logInfo:21] : Done fetching Unique tenant Ids for eventId - [99446]
2023-11-16 08:59:47.039 DEBUG 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [sendCustomerImpactNotification:1929]: CIN KafkaObject : {"uniqueId":"2c9c4737-b3a5-4655-8f22-e4214cce6d71","eventId":19868333,"emailType":"customerImpactNotification","isUpdate":true}
2023-11-16 08:59:47.041 DEBUG 1 --- [ad | producer-1] c.r.s.s.configuration.KafkaHelper        [handleLogs:286] : [onSuccess:132]: Sent message='{"uniqueId":"2c9c4737-b3a5-4655-8f22-e4214cce6d71","eventId":19868333,"emailType":"customerImpactNotification","isUpdate":true}' partition 0 with offset=41787
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sendCustomerImpactNotification:1936]: Done Sending Customer Impact Notification for eventId : 19868333, tenantId : 545592
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:497]: Starting sentSupplierImapct() with details : CollectionUtils.isNotEmpty(eventDetail.getAffectedPartners()): true, MapUtils.isNotEmpty(replicationService.getEventPartnerCustomerMap()) : true 
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [sentSupplierImapct:514]: supplierIdToSentImpact: [] 
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:444]: Done fetch pending partners: []
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [notificationProcess:446]: Checking for new condtion pending partners: false
2023-11-16 08:59:47.041  INFO 1 --- [6_103335_545592] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:300]: Done Replicating tables for customer with tenant_id : 545592, Took : 4s
2023-11-16 08:59:47.042  INFO 1 --- [6_103335_176350] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [lambda$createParallelStreamOfCustomers$3:291]: Replicating tables for customer with tenant_id : 176350 
2023-11-16 08:59:47.042  INFO 1 --- [6_103335_176350] .EventReplicationServiceWithoutBroadcast [handleLogs:291] : [replicateEventPerCustomer:328]: Before replicationProcess() with details : isUpdateAlert : true, isAlert : true, eventShareable.hasNoSites() : false, CollectionUtils.isEmpty(eventShareable.getAffectedSites()): true, CollectionUtils.isEmpty(eventShareable.getSharedSitesButSubtier()) : false 
2023-11-16 08:59:47.042 DEBUG 1 --- [6_103335_176350] .EventReplicationServiceWithoutBroadcast [handleLogs:286] : [checkForExistingCustomer:892]: Time taken : 0ms : for query : select distinct es.id from event_shareable es inner join event_site esite on esite.is_deleted = false and es.is_deleted = false and es.event_details_id = ? and es.tenant_id = ? and es.id =esite.event_id and es.tenant_id = esite.tenant_id
